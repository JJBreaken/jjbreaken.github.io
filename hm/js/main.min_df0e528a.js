var __reflect=this&&this.__reflect||function(e,t,n){e.__class__=t,n?n.push(t):n=[t],e.__types__=e.__types__?n.concat(e.__types__):n},__extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);n.prototype=t.prototype,e.prototype=new n},__awaiter=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(i,r){function s(e){try{l(o.next(e))}catch(t){r(t)}}function a(e){try{l(o["throw"](e))}catch(t){r(t)}}function l(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,a)}l((o=o.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function n(e){return function(t){return o([e,t])}}function o(n){if(i)throw new TypeError("Generator is already executing.");for(;l;)try{if(i=1,r&&(s=r[2&n[0]?"return":n[0]?"throw":"next"])&&!(s=s.call(r,n[1])).done)return s;switch(r=0,s&&(n=[0,s.value]),n[0]){case 0:case 1:s=n;break;case 4:return l.label++,{value:n[1],done:!1};case 5:l.label++,r=n[1],n=[0];continue;case 7:n=l.ops.pop(),l.trys.pop();continue;default:if(s=l.trys,!(s=s.length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){l=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){l.label=n[1];break}if(6===n[0]&&l.label<s[1]){l.label=s[1],s=n;break}if(s&&l.label<s[2]){l.label=s[2],l.ops.push(n);break}s[2]&&l.ops.pop(),l.trys.pop();continue}n=t.call(e,l)}catch(o){n=[6,o],r=0}finally{i=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,r,s,a,l={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},GameObj=function(){function e(){}return e.prototype.update=function(){},e.prototype.addRemoveFunc=function(e,t){this.removeFunc=e,this.removeFuncObj=t},e.prototype.removeRemoveFunc=function(){this.removeFunc=null,this.removeFuncObj=null},e.prototype.clear=function(){this.isDie=!0,this.removeFunc&&this.removeFuncObj&&(this.removeFunc.call(this.removeFuncObj),this.removeRemoveFunc())},e}();__reflect(GameObj.prototype,"GameObj");var BaseButton=function(e){function t(){var n=e.call(this)||this;return n.soundName="",n.clickParam=null,n.enable=!0,n.soundName=t.audioDefaultName,n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.buttonClick,n),n}return __extends(t,e),t.prototype.buttonClick=function(){0!=this.enable&&null!=this.clickFunc&&this.clickFunc.call(this.clickThis,this.clickParam)},t.prototype.onClick=function(e,t){return this.clickFunc=e,this.clickThis=t,this},t.prototype.onClick2=function(e,t,n){return this.clickParam=n,this.onClick(e,t)},t.audioDefaultName="",t}(eui.Button);__reflect(BaseButton.prototype,"BaseButton");var HttpData=function(){function e(){this.isJson=!0}return Object.defineProperty(e.prototype,"url",{get:function(){return this._url},enumerable:!0,configurable:!0}),e.prototype.init=function(e){this._url=e,this.responsType=egret.HttpResponseType.TEXT,this.method=egret.HttpMethod.GET,this.isJson=!0},e.prototype.onSuccess=function(e,t){return this.sucFunc=e,this.sucObj=t,this},e.prototype.onError=function(e,t){return this.errFunc=e,this.errObj=t,this},e.prototype.tryToJson=function(e){if(1==this.isJson)try{e=JSON.parse(e)}catch(t){}return e},e.prototype.callSuc=function(e){null!=this.sucFunc&&(e=this.tryToJson(e),this.sucFunc.call(this.sucObj,e,this))},e.prototype.callErr=function(e){null!=this.errFunc&&this.errFunc.call(this.errObj,e,this)},e}();__reflect(HttpData.prototype,"HttpData");var ObjectPool=function(){function e(){this._objs=new Array}return e.prototype.pushObj=function(e){this._objs.push(e)},e.prototype.popObj=function(){return this._objs.length>0?this._objs.pop():null},e.prototype.clear=function(){for(;this._objs.length>0;)this._objs.pop()},e.pop=function(t){for(var n=[],o=1;o<arguments.length;o++)n[o-1]=arguments[o];e._content[t]||(e._content[t]=[]);var i=e._content[t];if(i.length)return i.pop();var r,s=egret.getDefinitionByName(t),a=n.length;return 0==a?r=new s:1==a?r=new s(n[0]):2==a?r=new s(n[0],n[1]):3==a?r=new s(n[0],n[1],n[2]):4==a?r=new s(n[0],n[1],n[2],n[3]):5==a&&(r=new s(n[0],n[1],n[2],n[3],n[4])),r.ObjectPoolKey=t,r},e.popWithExtraKey=function(t,n){e._content[t]||(e._content[t]=[]);var o,i=e._content[t];if(i.length)for(var r=0;r<i.length;r++)if(i[r].extraKey==n){o=i[r],i.splice(r,1);break}if(!o){var s=egret.getDefinitionByName(t);o=new s(n),o.extraKey=n,o.ObjectPoolKey=t}return o},e.push=function(t){if(null==t)return!1;var n=t.ObjectPoolKey;return e._content[n]?(e._content[n].push(t),!0):!1},e.clear=function(){e._content={}},e.clearClass=function(t,n){void 0===n&&(n=null);for(var o=e._content[t];o&&o.length;){var i=o.pop();n&&i[n](),i=null}e._content[t]=null,delete e._content[t]},e.dealFunc=function(t,n){var o=e._content[t];if(null!=o){var i=0,r=o.length;for(i;r>i;i++)o[i][n]()}},e._content={},e}();__reflect(ObjectPool.prototype,"ObjectPool");var ObjPos=function(e){function t(){var t=e.call(this)||this;return t.Bodytype=null,t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t}return __extends(t,e),t.prototype.addCreatedFunc=function(e,t){this.createdFunc=e,this.createdFuncObj=t},t.prototype.createObj=function(){this.localToGlobal(this.width/2,this.height/2,t.tmp),this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height/2,this.x=t.tmp.x,this.y=t.tmp.y},t.prototype.onAddToStage=function(){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.createObj(),this.createdFunc&&this.createdFuncObj&&this.createdFunc.call(this.createdFuncObj),this.parent.removeChild(this)},t.tmp=new egret.Point,t}(eui.Rect);__reflect(ObjPos.prototype,"ObjPos");var BaseClass=function(){function e(){}return e.getInstance=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=this;if(!n._instance){var o=e.length;0==o?n._instance=new n:1==o?n._instance=new n(e[0]):2==o?n._instance=new n(e[0],e[1]):3==o?n._instance=new n(e[0],e[1],e[2]):4==o?n._instance=new n(e[0],e[1],e[2],e[3]):5==o&&(n._instance=new n(e[0],e[1],e[2],e[3],e[4]))}return n._instance},e}();__reflect(BaseClass.prototype,"BaseClass");var LevelElementObj=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.init=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},t.prototype.getInitBodyType=function(){return null==this.initBodyType||void 0==this.initBodyType?p2.Body.DYNAMIC:this.initBodyType},t.prototype.createElement=function(e,t,n,o,i,r){this.elementImg=new eui.Image,this.elementImg.source=e,this.elementImg.x=t,this.elementImg.y=n,this.elementImg.width=o,this.elementImg.height=i,this.elementImg.rotation=r,this.elementImg.anchorOffsetX=o/2,this.elementImg.anchorOffsetY=i/2,GameMap.Instance.levelLayer.addChild(this.elementImg)},t.prototype.update=function(){this.elementImg&&this.body&&this.body.shapes[0]&&(this.updateOutBounds(),this.updateDisplay())},t.prototype.updateDisplay=function(){this.elementImg.x=P2World.Instance.p2dX(this.body.position[0]),this.elementImg.y=P2World.Instance.p2dY(this.body.position[1]),this.elementImg.rotation=180*(this.body.angle+this.body.shapes[0].angle)/Math.PI},t.prototype.updateOutBounds=function(){var e,t,n=GameMap.Instance.width,o=GameMap.Instance.height,i=this.body;return e=P2World.Instance.p2dX(i.position[0]),-n>e||e>2*n?void LevelElementManager.Instance.removeElement(this):(t=P2World.Instance.p2dY(i.position[1]),-n>t||t>2*o?void LevelElementManager.Instance.removeElement(this):void 0)},t.prototype.clear=function(){e.prototype.clear.call(this),this.elementImg&&GameMap.Instance.levelLayer.removeChild(this.elementImg),this.body&&P2World.Instance.removeBody(this.body),this.elementImg=null},t}(GameObj);__reflect(LevelElementObj.prototype,"LevelElementObj");var ScalerButton=function(e){function t(){var t=e.call(this)||this;return t.isScale=!1,t.addEventListener(egret.TouchEvent.TOUCH_BEGIN,t.ButtonScalerBegin,t),t.addEventListener(egret.TouchEvent.TOUCH_END,t.ButtonScalerEnd,t),t.addEventListener(egret.TouchEvent.TOUCH_CANCEL,t.ButtonScalerEnd,t),t.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,t.ButtonScalerEnd,t),t}return __extends(t,e),t.prototype.ButtonScalerBegin=function(e){0!=this.enable&&this.childGrp&&1!=this.isScale&&(this.childGrp.scaleX=.9,this.childGrp.scaleY=.9,this.isScale=!0)},t.prototype.ButtonScalerEnd=function(e){this.childGrp&&0!=this.isScale&&(this.childGrp.scaleX=1,this.childGrp.scaleY=1,this.isScale=!1)},t}(BaseButton);__reflect(ScalerButton.prototype,"ScalerButton");var PtEffectItem=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.update=function(){},t}(egret.Bitmap);__reflect(PtEffectItem.prototype,"PtEffectItem");var EffectSystem=function(){function e(e,t,n,o,i,r){void 0===o&&(o=.5),void 0===i&&(i=.5),void 0===r&&(r=egret.BlendMode.NORMAL),this.pi=0,this.max=20,this.arr=[],this.ri=0,this.max=n,this.res=t,this.ax=o,this.ay=i;for(var s=0;n>s;s++){var a=RES.getRes(MCEffectController.atlasName+"#"+this.itemRes()),l=new e;l.blendMode=r,l.texture=a,this.setAnchorOff(l),this.arr.push(l),GameMap.Instance.effectLayer.addChild(l),l.visible=!1}}return e.prototype.setAnchorOff=function(e){e.anchorOffsetX=e.width*this.ax,e.anchorOffsetY=e.height*this.ay},e.prototype.itemRes=function(){return this.res},e.prototype.getItem=function(){var e=this.pi+1;e>this.arr.length-1&&(e=0);var t=this.arr[this.pi];return this.pi=e,t},e.prototype.update=function(){for(var e=0;e<this.arr.length;e++)1==this.arr[e].visible&&this.arr[e].update()},e}();__reflect(EffectSystem.prototype,"EffectSystem");var TimerManager=function(e){function t(){var t=e.call(this)||this;return t._handlers=new Array,t._delHandlers=new Array,t._currTime=Timer.nowTime,t._currFrame=0,t._count=0,t._timeScale=1,App.registerUpdater(t.onEnterFrame,t),t}return __extends(t,e),t.prototype.setTimeScale=function(e){this._timeScale=e},t.prototype.onEnterFrame=function(){this._currFrame++,this._currTime=Timer.nowTime,App.DebugUtils.start("TimerManager:");for(var e=0;e<this._count;e++){var t=this._handlers[e],n=t.userFrame?this._currFrame:this._currTime;n>=t.exeTime&&(App.DebugUtils.start(t.method.toString()),t.method.call(t.methodObj,(this._currTime-t.dealTime)*this._timeScale),App.DebugUtils.stop(t.method.toString()),t.dealTime=this._currTime,t.exeTime+=t.delay,t.repeat||(t.repeatCount>1?t.repeatCount--:(t.complateMethod&&t.complateMethod.apply(t.complateMethodObj),this._delHandlers.push(t))))}for(;this._delHandlers.length;){var t=this._delHandlers.pop();this.remove(t.method,t.methodObj)}App.DebugUtils.stop("TimerManager:")},t.prototype.create=function(e,t,n,o,i,r,s){if(!(0>t||0>n||null==o)){this.remove(o,i);var a=ObjectPool.pop("TimerHandler");a.userFrame=e,a.repeat=0==n,a.repeatCount=n,a.delay=t,a.method=o,a.methodObj=i,a.complateMethod=r,a.complateMethodObj=s,a.exeTime=t+(e?this._currFrame:this._currTime),a.dealTime=this._currTime,this._handlers.push(a),this._count++}},t.prototype.doTimer=function(e,t,n,o,i,r){void 0===i&&(i=null),void 0===r&&(r=null),this.create(!1,e,t,n,o,i,r)},t.prototype.doFrame=function(e,t,n,o,i,r){void 0===i&&(i=null),void 0===r&&(r=null),this.create(!0,e,t,n,o,i,r)},Object.defineProperty(t.prototype,"count",{get:function(){return this._count},enumerable:!0,configurable:!0}),t.prototype.remove=function(e,t){for(var n=0;n<this._count;n++){var o=this._handlers[n];if(o.method==e&&o.methodObj==t){this._handlers.splice(n,1),ObjectPool.push(o),this._count--;break}}},t.prototype.removeAll=function(e){for(var t=0;t<this._count;t++){var n=this._handlers[t];n.methodObj==e&&(this._handlers.splice(t,1),ObjectPool.push(n),this._count--,t--)}},t.prototype.isExists=function(e,t){for(var n=0;n<this._count;n++){var o=this._handlers[n];if(o.method==e&&o.methodObj==t)return!0}return!1},t}(BaseClass);__reflect(TimerManager.prototype,"TimerManager");var TimerHandler=function(){function e(){this.delay=0,this.repeatCount=0,this.exeTime=0,this.dealTime=0}return e.prototype.clear=function(){this.method=null,this.methodObj=null,this.complateMethod=null,this.complateMethodObj=null},e}();__reflect(TimerHandler.prototype,"TimerHandler");var BaseModel=function(){function e(e){this.controller=e}return e.prototype.getController=function(){return this.controller},e}();__reflect(BaseModel.prototype,"BaseModel",["IModel"]);var BaseView=function(e){function t(t,n,o){void 0===n&&(n=null),void 0===o&&(o=-1);var i=e.call(this)||this;return i.viewState=EViewState.NONE,i.resources=null,i.viewID=-1,i.popDownType=0,i._closeOnOpen=-1,i.touchEnabled=!1,i.controller=t,i.myParent=n,o>=0&&App.ViewManager.register(o,i),i}return __extends(t,e),t.prototype.getCloseOnOpen=function(){return this._closeOnOpen},t.prototype.setCloseOnOpen=function(e){this._closeOnOpen=e},t.prototype.$hitTest=function(t,n){return this.touchEnabled||this.touchChildren?e.prototype.$hitTest.call(this,t,n):null},t.prototype.setViewID=function(e){this.viewID=e},t.prototype.getViewID=function(){return this.viewID},t.prototype.initView=function(){this.viewState=EViewState.INITED},t.prototype.setPopDownType=function(e,t){void 0===t&&(t=this),this.popDownType=e,this.popDownObj=t},t.prototype.getPopDownType=function(){return this.popDownType},t.prototype.getPopDownObj=function(){return this.popDownObj},t.prototype.setSkinName=function(e){this.skinName=e,this.setSkinState()},t.prototype.setSkinState=function(){for(var e=this.skin?this.skin.states:[],t=platform.getPlatformName(),n=0,o=e;n<o.length;n++){var i=o[n];if(i.name==t){this.skin.currentState=t;break}}},t.prototype.loadResource=function(e,t){this.viewState=EViewState.INITING},t.prototype.setLayer=function(e){App.ViewLayerManager.setLayer(this,e)},t.prototype.addResource=function(e){null!=e&&(null==this.resources&&(this.resources=[]),this.resources.push(e))},t.prototype.addResources=function(e){null!=e&&(null==this.resources&&(this.resources=[]),this.resources=this.resources.concat(e))},t.prototype.getState=function(){return this.viewState},t.prototype.onResize=function(){},t.prototype.setVisible=function(e){this.visible=e},t.prototype.applyFunc=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return this.controller.applyFunc.apply(this.controller,arguments)},t.prototype.applyControllerFunc=function(e,t){for(var n=[],o=2;o<arguments.length;o++)n[o-2]=arguments[o];return this.controller.applyControllerFunc.apply(this.controller,arguments)},t.prototype.isShow=function(){return null!=this.stage&&this.visible},t.prototype.setParent=function(e){null!=e&&(this.myParent=e)},t.prototype.getParent=function(){return this.parent},t.prototype.addToParent=function(e){void 0===e&&(e=-1),this.myParent.addChild(this)},t.prototype.addToParentAt=function(e){this.myParent.addChildAt(this,e)},t.prototype.removeFromParent=function(){App.DisplayUtils.removeFromParent(this)},t.prototype.open=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.onSafeMode(0==App.GlobalConfigure.GetNumber("tt_safeMode"),3e3)},t.prototype.openAndopen=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},t.prototype.close=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},t.prototype.onSafeMode=function(e,t){},t.prototype.openSelf=function(){App.ViewManager.open(this.getViewID())},t.prototype.closeSelf=function(){App.ViewManager.close(this.getViewID())},t.prototype.destroy=function(){for(var e=0;e<this.resources.length;++e)RES.destroyRes(this.resources[e]);this.controller=null,this.myParent=null,this.viewState=EViewState.DESTORY,this.resources=null},t.prototype.onTopView=function(){},t.prototype.onNotTopView=function(){},t}(eui.Component);__reflect(BaseView.prototype,"BaseView",["IView"]);var AnimEventItem=function(){function e(){}return e.getItem=function(){var t=e.pool.popObj();return null==t&&(t=new e),t},e.recoveryItem=function(t){t.name="",t.callFunc=null,t.target=null,e.pool.pushObj(t)},e.pool=new ObjectPool,e}();__reflect(AnimEventItem.prototype,"AnimEventItem");var Anim=function(){function e(){}return e.prototype.addAniEvent=function(){this.display.addEventListener(dragonBones.EventObject.COMPLETE,this.onComplete,this)},e.prototype.removeAniEvent=function(){this.display.removeEventListener(dragonBones.EventObject.COMPLETE,this.onComplete,this)},e.prototype.onComplete=function(e){},e.prototype.update=function(){},e}();__reflect(Anim.prototype,"Anim");var CollisionEventBase=function(){function e(){this.arr=[];for(var e=0;e<P2World.MAX_BODY_WARNNING_COUNT;e++)this.arr.push(new EventItem)}return e.prototype.checkGroup=function(e){if(e>=this.arr.length){var t=e+1-this.arr.length;t=20*(Math.floor(t/20)+1);for(var n=0;t>n;n++)this.arr.push(new EventItem)}},e.prototype.on=function(e,t,n){this.checkGroup(e);var o=this.arr[e];o.func=t,o.target=n},e.prototype.off=function(e){var t=this.arr[e];t.func=null,t.target=null},e}();__reflect(CollisionEventBase.prototype,"CollisionEventBase");var EventItem=function(){function e(){this.func=null,this.target=null}return e}();__reflect(EventItem.prototype,"EventItem");var ShakeButton=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.start=function(){egret.Tween.get(this,{loop:!0}).wait(1e3).to({rotation:6},100).to({rotation:-5},100).to({rotation:4},100).to({rotation:-3},100).to({rotation:2},100).to({rotation:0},100).wait(1e3)},t.prototype.stop=function(){this.rotation=0,egret.Tween.removeTweens(this)},t}(ScalerButton);__reflect(ShakeButton.prototype,"ShakeButton");var MCEffectItem=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.isShow=!1,t.index=0,t.totleFc=0,t.spt=30,t.pspt=0,t.fs=0,t.ts=0,t}return __extends(t,e),t}(egret.Bitmap);__reflect(MCEffectItem.prototype,"MCEffectItem");var MCEffectController=function(){function e(){this.speed=30,this.preTime=0,this.curCreateIndex=0,e.Instance=this,this.curCreateIndex=0,this.AllMcEffect=new Array(e.maxEffectCount);for(var t,n=0;n<this.AllMcEffect.length;n++)t=new MCEffectItem,this.AllMcEffect[n]=t,GameMap.Instance.effectLayer.addChild(t);this.txtCahce={},this.itemPool=new ObjectPool,this.AllOutMcEffect=[]}return e.prototype.update=function(){if(Timer.nowTime-this.preTime>=this.speed){this.preTime=Timer.nowTime;for(var e=0;e<this.AllMcEffect.length;e++)this.handleEffect(this.AllMcEffect[e]);for(var e=0;e<this.AllOutMcEffect.length;e++)this.handleEffect(this.AllOutMcEffect[e],!0)}},e.prototype.handleEffect=function(e,t){if(void 0===t&&(t=!1),0!=e.isShow){0==e.visible&&(e.visible=!0);var n=e.fs+(e.ts-e.fs)*(e.index/e.totleFc);if(e.scaleX=e.scaleY=n,e.pspt+=Timer.tick,e.pspt>=e.spt){e.index>=e.totleFc&&(0==t&&(e.isShow=!1,e.visible=!1),e.index=0),e.pspt=0;var o=this.getTexture(e.resName+e.index.toString());null!=o&&(e.texture=o),e.index++}}},e.prototype.playeEffect=function(e,t,n,o,i,r,s,a,l,p,h){if(void 0===i&&(i=150),void 0===r&&(r=150),void 0===s&&(s=75),void 0===a&&(a=75),void 0===l&&(l=0),void 0===p&&(p=1),void 0===h&&(h=1),null!=e&&""!=e){var c=this.AllMcEffect[this.curCreateIndex];this.curCreateIndex++,this.curCreateIndex>=this.AllMcEffect.length&&(this.curCreateIndex=0),c.isShow=!0,c.resName=e,c.spt=c.pspt=0,c.x=t,c.y=n,c.index=0,c.totleFc=o,c.width=i,c.height=r,c.anchorOffsetX=s,c.anchorOffsetY=a,c.fs=p,c.ts=h,c.rotation=l}},e.prototype.createEffect=function(e,t,n,o,i,r){void 0===n&&(n=100),void 0===o&&(o=60),void 0===i&&(i=70),void 0===r&&(r=30);var s=this.itemPool.popObj();return null==s&&(s=new MCEffectItem),s.isShow=!0,s.resName=e,s.index=0,s.totleFc=t,s.width=n,s.height=o,s.anchorOffsetX=i,s.anchorOffsetY=r,s.fs=1,s.ts=1,this.AllOutMcEffect.push(s),GameMap.Instance.effectLayer.addChild(s),s},e.prototype.removeEffect=function(e){if(null!=e){var t=this.AllOutMcEffect.indexOf(e);t>=0&&this.AllOutMcEffect.splice(t,1),null!=e.parent&&e.parent.removeChild(e),this.itemPool.pushObj(e)}},e.prototype.getTexture=function(t){var n=this.txtCahce[t];return null==n&&(n=RES.getRes(e.atlasName+"#"+t),this.txtCahce[t]=n),n},e.atlasName="effect_json",e.maxEffectCount=10,e}();__reflect(MCEffectController.prototype,"MCEffectController");var LevelCreator=function(e){function t(){var t=e.call(this)||this;return t.terrainDisVec=new Array,t.terrainP2Vec=new Array,t.bulletNum=0,t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.createTerrin(),this.initBullet()},t.prototype.initBullet=function(){BulletManager.Instance.bulletNum=this.bulletNum,BulletManager.Instance.bulletUseNum=0;var e=App.ViewManager.getView(EViewID.GAME_PLAY_VIEW);e.refreshBullet()},t.prototype.createTerrin=function(){this.terrainDisVec.splice(0),this.terrainP2Vec.splice(0);var e=this.terrain.numChildren,n=[-300,this.height+500];this.terrainP2Vec.push([n[0]*P2World.d2pFactor,n[1]*P2World.d2pFactor]),n=[-300,-300],this.terrainP2Vec.push([n[0]*P2World.d2pFactor,n[1]*P2World.d2pFactor]),n=[0,-300],this.terrainP2Vec.push([n[0]*P2World.d2pFactor,n[1]*P2World.d2pFactor]),n=[-30,this.height+500],this.terrainDisVec.push(n),n=[-30,this.terrain.getChildAt(0).y],this.terrainDisVec.push(n);for(var o,i=0;e>i;i++)o=this.terrain.getChildAt(i),n=[o.x,o.y],this.terrainDisVec.push(n),this.terrainP2Vec.push([n[0]*P2World.d2pFactor,n[1]*P2World.d2pFactor]);if(null!=o&&(n=[o.x+o.width*Math.cos(o.rotation),o.y+o.width*Math.sin(o.rotation)],this.terrainDisVec.push(n),this.terrainP2Vec.push([n[0]*P2World.d2pFactor,n[1]*P2World.d2pFactor]),n[0]=this.width+30,this.terrainDisVec.push(n)),n=[this.width+30,this.height+500],this.terrainDisVec.push(n),n=[this.width,-300],this.terrainP2Vec.push([n[0]*P2World.d2pFactor,n[1]*P2World.d2pFactor]),n=[this.width+300,-300],this.terrainP2Vec.push([n[0]*P2World.d2pFactor,n[1]*P2World.d2pFactor]),n=[this.width+300,this.height+500],this.terrainP2Vec.push([n[0]*P2World.d2pFactor,n[1]*P2World.d2pFactor]),this.terrainDisVec.length<3)return void console.log("地形顶点小于3个，不能构成多变形");null==t.terrainBody&&(t.terrainBody=new p2.Body,t.terrainBody.flag="Terrain",t.terrainBody.type=p2.Body.STATIC),t.terrainBody.fromPolygon(this.terrainP2Vec,{optimalDecomp:!1});for(var i=0;i<t.terrainBody.shapes.length;i++)t.terrainBody.shapes[i].collisionGroup=P2World.TERRAIN_GROUP,t.terrainBody.shapes[i].collisionMask=P2World.TERRAIN_MASK;P2World.Instance.addBody(t.terrainBody),this.terrainP2Vec.splice(0),GameMap.Instance.resetBg(this.width,this.height,this.terrainDisVec)},t.prototype.testresetBg=function(){GameMap.Instance.resetBg(this.width,this.height,this.terrainDisVec)},t.prototype.init=function(){platform.recordStart()},t.prototype.clear=function(){null!=this.terrain&&(P2World.Instance.removeBody(t.terrainBody),t.terrainBody=null)},t.prototype.pass=function(){},t}(eui.Component);__reflect(LevelCreator.prototype,"LevelCreator");var HttpPromiseData=function(e){function t(){var t=e.call(this)||this;return t.req=new egret.HttpRequest,t}return __extends(t,e),t.prototype.start=function(){var e=this;return new Promise(function(t,n){function o(e){var n=null;e.type==egret.Event.COMPLETE&&(n=this.tryToJson(e.currentTarget.response)),e.type==egret.IOErrorEvent.IO_ERROR&&console.log("IO_ERROR____",e),this.req.removeEventListener(egret.Event.COMPLETE,o,this),this.req.removeEventListener(egret.IOErrorEvent.IO_ERROR,o,this),t(n),App.Http.removeServerPromise(this)}e.req.responseType=e.responsType,console.log("egret___http__url",e.url),e.req.open(e.url,e.method),e.req.send(),e.req.addEventListener(egret.Event.COMPLETE,o,e),e.req.addEventListener(egret.IOErrorEvent.IO_ERROR,o,e)})},t.prototype.startByPost=function(e){var t=this;return new Promise(function(n,o){function i(e){var t=null;e.type==egret.Event.COMPLETE&&(t=this.tryToJson(e.currentTarget.response)),this.req.removeEventListener(egret.Event.COMPLETE,i,this),this.req.removeEventListener(egret.IOErrorEvent.IO_ERROR,i,this),n(t),App.Http.removeServerPromise(this)}t.req.responseType=t.responsType,t.req.open(t.url,t.method),t.req.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),t.req.send(e),t.req.addEventListener(egret.Event.COMPLETE,i,t),t.req.addEventListener(egret.IOErrorEvent.IO_ERROR,i,t)})},t}(HttpData);__reflect(HttpPromiseData.prototype,"HttpPromiseData");var WoodBoxObj=function(e){function t(){var t=e.call(this)||this;return t.imgName="woodbox",t.type=ELevelElementType.WOODBOX,t}return __extends(t,e),t.prototype.init=function(t,n,o,i,r){o>=120&&i>=120?this.imgName="woodbox2":this.imgName=App.RandomUtils.limit(0,2)>1?"woodbox":"woodbox1",e.prototype.createElement.call(this,this.imgName,t,n,o,i,r),this.createPhysics()},t.prototype.getBodyType=function(){return p2.Body.DYNAMIC},t.prototype.createPhysics=function(){this.shape=new p2.Box({width:this.elementImg.width*P2World.d2pFactor,height:this.elementImg.height*P2World.d2pFactor}),this.body=P2World.Instance.getBody(),this.body.position=[P2World.Instance.d2pX(this.elementImg.x),P2World.Instance.d2pY(this.elementImg.y)],this.body.flag="woodbox",this.body.type=this.getBodyType(),this.body.angle=0,this.body.mass=5,this.body.addShape(this.shape),this.body.sleepState=p2.Body.AWAKE,P2World.Instance.addBody(this.body),this.shape.collisionGroup=P2World.ITEM_GROUP,this.shape.collisionMask=P2World.ITEM_MASK,BeginContactEvent.Instance.on(this.body.id,this.onBeginContact,this)},t.prototype.onBeginContact=function(e){var t=e.bodyA,n=e.bodyB;2*this.elementImg.width;(t.shapes[0].collisionGroup==P2World.BULLET_GROUP||n.shapes[0].collisionGroup==P2World.BULLET_GROUP)&&(App.Sound.playEffect("hitwood.mp3"),App.vibrateShort(),EffectController.Instance.dust.play(this.elementImg.x,this.elementImg.y,.3*this.elementImg.width,.3*this.elementImg.height,3,3),EffectController.Instance.wood1.play(this.elementImg.x,this.elementImg.y,.3*this.elementImg.width,.3*this.elementImg.height,2,2,2),LevelElementManager.Instance.removeElement(this))},t.prototype.update=function(){null!=this.elementImg&&null!=this.body&&e.prototype.update.call(this)},t.prototype.clear=function(){e.prototype.clear.call(this),BeginContactEvent.Instance.off(this.body.id),this.body=null},t}(LevelElementObj);__reflect(WoodBoxObj.prototype,"WoodBoxObj");var WoodBoxPos=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.createObj=function(){e.prototype.createObj.call(this),this.obj=LevelElementManager.Instance.createElement(ELevelElementType.WOODBOX),this.obj.init(this.x,this.y,this.width,this.height,this.rotation)},t}(ObjPos);__reflect(WoodBoxPos.prototype,"WoodBoxPos"),window.WoodBoxPos=WoodBoxPos;var RoleObj=function(e){function t(){var t=e.call(this)||this;return t.skinData=null,t.originSlot=[],t.curSlot=[],t.headOH=0,t.headOB=0,t}return __extends(t,e),t.prototype.init=function(e){this.changeSkin(e)},t.prototype.clear=function(){this.recoverOriginSlot(),this.recoverBody(),this.anim.removeAniEvent(),this.anim.display=null,this.skinName=null,this.skinData=null,this.dbName=null},t.prototype.createBody=function(){return this.dbFactory=AnimManager.Instance.getDBFactory(this.dbName),this.display=this.dbFactory.buildArmatureDisplay("Armature"),null==this.display?void console.log("RoleObj createBody getDisplay失败 "+this.dbName):(GameMap.Instance.roleLayer.addChild(this.display),this.display.scaleX=this.display.scaleY=this.skinData.scale,this.anim.display=this.display,this.anim.addAniEvent(),void this.recordOriginSlot())},t.prototype.recoverBody=function(){null!=this.display&&(GameMap.Instance.roleLayer.removeChild(this.display),AnimManager.Instance.recoverArmature(this.dbName,this.dbFactory,this.display),this.dbFactory=null,this.display=null)},t.prototype.changeSkin=function(e){if(this.skinName!=e){if(this.skinName=e,this.skinData=SkinData.Instance.getRoleSkinData(this.skinName),null==this.skinData)return void console.log("RoleObj createBody getSkinData失败 "+this.skinName);this.dbName!=this.skinData.dbName&&(this.recoverBody(),this.dbName=this.skinData.dbName,this.createBody()),this.setSlot(),this.setBoneOffset()}},t.prototype.setBoneOffset=function(){var e=this.display.armature.getBone(AnimManager.bone_la),t=this.display.armature.getBone(AnimManager.bone_ra);null==this.skinData.armoff?(null!=e&&(e.offset.x=0,e.offset.y=0),null!=t&&(t.offset.x=0,t.offset.y=0)):(null!=e&&(e.offset.x=-this.skinData.armoff[0],e.offset.y=this.skinData.armoff[1]),null!=t&&(t.offset.x=this.skinData.armoff[0],t.offset.y=this.skinData.armoff[1]));var n=this.display.armature.getBone(AnimManager.bone_head);null==this.skinData.headoff?null!=n&&(n.offset.x=0,n.offset.y=0):null!=n&&(n.offset.x=this.skinData.headoff[0],n.offset.y=this.skinData.headoff[1])},t.prototype.recordOriginSlot=function(){for(var e,t,n=0;n<AnimManager.slotArr.length;n++){if(e=AnimManager.slotArr[n],t=this.display.armature.getSlot(e),null!=t){if(e==AnimManager.slot_mouth){for(var o=[],i=0;i<t.rawDisplayDatas.length;i++)o.push(t.rawDisplayDatas[i].name);this.originSlot.push(o)}else this.originSlot.push(t.rawDisplayDatas[0].name);e==AnimManager.slot_head&&(this.headOH=t.display.height)}else this.originSlot.push("");this.curSlot.push(this.originSlot[n])}},t.prototype.isSameSlot=function(e,t,n){return(e=AnimManager.slot_mouth)?this.isSameMouth(t,n):t==n},t.prototype.isSameMouth=function(e,t){for(var n=0;n<e.length;n++)if(e[n]!=t[n])return!1;return!1},t.prototype.getExchangeBitmap=function(e,t){var n=this.dbFactory.getTextureDisplay(e,this.dbName);return null==n?null:(n.anchorOffsetX=.5*n.width,n.anchorOffsetY=.5*n.height,n.x=t.x,n.y=t.y,n.scaleX=t.scaleX,n.scaleY=t.scaleY,n.rotation=t.rotation,n.alpha=t.alpha,n)},t.prototype.recoverOriginSlot=function(){for(var e,t,n,o,i,r,s=0;s<AnimManager.slotArr.length;s++){if(e=AnimManager.slotArr[s],n=this.curSlot[s],t=this.originSlot[s],this.isSameSlot(e,n,t))return;if(o=this.display.armature.getSlot(e),null!=o)if(o.visible=!0,e==AnimManager.slot_mouth){if(null!=t&&""!=t){for(var a=o.displayList,l=0;l<t.length;l++)i=o.displayList[l],r=this.getExchangeBitmap(t[l],i),null!=r?a[l]=r:o.visible=!1;o.displayList=a}}else if(null!=t&&""!=t){if(i=o.display,r=this.getExchangeBitmap(t,i),null==r){o.visible=!1;continue}o.display=r}}this.originSlot.splice(0),this.curSlot.splice(0)},t.prototype.setSlot=function(){for(var e,t,n,o,i,r,s=0;s<this.skinData.slots.length;s++){if(n=AnimManager.slotArr[s],e=this.curSlot[s],t=this.skinData.slots[s],this.isSameSlot(n,e,t))return;if((""==t||null==t)&&(t=this.originSlot[s]),this.curSlot[s]=t,o=this.display.armature.getSlot(n),null!=o)if(o.visible=!0,n==AnimManager.slot_mouth){var a=o.displayList;if(null!=t&&""!=t){for(var l=0;l<e.length;l++)i=o.displayList[l],r=this.getExchangeBitmap(t[l],i),null!=r?a[l]=r:o.visible=!1;o.displayList=a}}else if(null!=t&&""!=t){if(i=o.display,r=this.getExchangeBitmap(t,i),null==r){o.visible=!1;continue}n==AnimManager.slot_head&&(r.anchorOffsetY+=.5*(r.height-this.headOH)),o.display=r}}},t.prototype.update=function(){e.prototype.update.call(this),this.anim.update()},t}(GameObj);__reflect(RoleObj.prototype,"RoleObj");var BaseEntry=function(){function e(){}return e.prototype.castType=function(e,t){var n=e;return"string"==t?n:("number"==t&&(n=Number(e)),n)},e.prototype.Init=function(e){},e}();__reflect(BaseEntry.prototype,"BaseEntry");var BaseTable=function(){function e(t){this.firstline=0,this.tablecount=0,this.entryIndexList={},this.keyToindexList={};var n=e.resDic[t];if(null==n)return void console.error("tablename = "+t+" no find");this.lines=n;for(var o,i=this.lines.length,r=1;i>r;r++)o=this.lines[r].split("	",1),null==this.keyToindexList[o[0]]&&(this.keyToindexList[o[0]]=new Array),this.keyToindexList[o[0]].push(r);this.tablecount=i-1}return e.reg=function(t){return __awaiter(this,void 0,void 0,function(){var n,o,i,r,s,a,l,p,h;return __generator(this,function(c){for(n=t.split("\r\n"),o=n.length,i=0,r=0;o>i+2;){for(s=n[0+r].split("	",1)+"_txt",a=n[1+r].split("	",1),l=parseInt(a[0]),p=new Array,r+=2,h=0;l>h;h++)p[h]=n[h+r];e.resDic[s]=p,r+=l,i=r}return[2]})})},Object.defineProperty(e.prototype,"count",{get:function(){return this.tablecount},enumerable:!0,configurable:!0}),e.prototype.getBaseEntry=function(e,t){var n=this.keyToindexList[String(t)];
return null==n?null:this.getBaseEntryByIndex(e,n[0])},e.prototype.getBaseIndexsByKey=function(e,t){return this.keyToindexList[String(t)]},e.prototype.getBaseEntryByIndex=function(e,t){if(1>t||t>this.count)return null;var n=this.entryIndexList[t];if(null!=n)return n;var o=this.lines[t];return n=this.parseBaseEntry(e,o),this.entryIndexList[t]=n,this.lines[t]=null,n},e.prototype.parseBaseEntry=function(e,t){if(null==t)return null;var n=new e;return n.Init(t.split("	")),n},e.resDic=new Array,e}();__reflect(BaseTable.prototype,"BaseTable");var BaseSound=function(){function e(){}return e.prototype.getSound=function(t){return __awaiter(this,void 0,void 0,function(){var n,o=this;return __generator(this,function(i){switch(i.label){case 0:return(n=e.resmap[t])?[3,2]:null!=e.loadingmap[t]?[2,null]:(e.loadingmap[t]="l",[4,new Promise(function(n,i){function r(o){e.loadingmap[t]=null,e.resmap[t]=o,n()}RES.getResByUrl("resource/wx/sound/"+t,r,o,RES.ResourceItem.TYPE_SOUND)})]);case 1:i.sent(),n=e.resmap[t],i.label=2;case 2:return[2,n]}})})},e.prototype.getSoundByNet=function(t){return __awaiter(this,void 0,void 0,function(){var n,o=this;return __generator(this,function(i){switch(i.label){case 0:return(n=e.resmap[t])?[3,2]:null!=e.loadingmap[t]?[2,null]:(e.loadingmap[t]="l",[4,new Promise(function(n,i){function r(o){e.loadingmap[t]=null,e.resmap[t]=o,n()}"debug"==platform.getPlatformName()?RES.getResByUrl("/resource/sound/"+t,r,o,RES.ResourceItem.TYPE_SOUND):RES.getResByUrl(App.resourceURL+"/resource/sound/"+t,r,o,RES.ResourceItem.TYPE_SOUND)})]);case 1:i.sent(),n=e.resmap[t],i.label=2;case 2:return[2,n]}})})},e.prototype.onResourceLoadComplete=function(e,t){this.loadedPlay(t)},e.prototype.loadedPlay=function(e){},e.prototype.checkCanClear=function(e){return!0},e.resmap={},e.loadingmap={},e}();__reflect(BaseSound.prototype,"BaseSound");var BreathButton=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.start=function(){egret.Tween.get(this,{loop:!0}).to({scaleX:.95,scaleY:.95},300,egret.Ease.sineIn).to({scaleX:1.05,scaleY:1.05},800,egret.Ease.sineOut).to({scaleX:1,scaleY:1},300,egret.Ease.sineIn)},t.prototype.stop=function(){this.scaleX=this.scaleY=1,egret.Tween.removeTweens(this)},t}(BaseButton);__reflect(BreathButton.prototype,"BreathButton");var EffectButton=function(e){function t(){var n=e.call(this)||this;return n.playing=!1,n.effectType=0,n.effectType=t.defaultEffectType,n}return __extends(t,e),t.prototype.buttonClick=function(){1!=this.playing&&(App.Sound.playEffect(this.soundName),this.playing=!0,egret.Tween.get(this).to({scaleX:.5,scaleY:.5,x:this.x+this.width/4,y:this.y+this.height/4},100,egret.Ease.sineIn).call(this.playEffect,this))},t.prototype.playEffect=function(){1==this.effectType?egret.Tween.get(this).to({scaleX:1,scaleY:1,x:this.x-this.width/4,y:this.y-this.height/4},500,egret.Ease.elasticOut).call(this.onPlayCompleted,this):2==this.effectType?egret.Tween.get(this).to({scaleX:1,scaleY:1,x:this.x-this.width/4,y:this.y-this.height/4},500,egret.Ease.backOut).call(this.onPlayCompleted,this):3==this.effectType&&egret.Tween.get(this).to({scaleX:1,scaleY:1,x:this.x-this.width/4,y:this.y-this.height/4},100).call(this.onPlayCompleted,this)},t.prototype.onPlayCompleted=function(){null!=this.clickFunc&&this.clickFunc.call(this.clickThis,this.clickParam),this.playing=!1},t.defaultEffectType=1,t}(BaseButton);__reflect(EffectButton.prototype,"EffectButton");var NumberGroup=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.totalWidth=0,t.imgWidth=0,t.atlasName="",t.prefixName="",t.offset=0,t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.totalWidth=this.width},t.prototype.setData=function(e,t,n,o){return void 0===o&&(o=0),this.imgWidth=e,this.atlasName=t,this.prefixName=n,this.offset=o,this},t.prototype.getImage=function(e){var n=t.pool.popObj();return null==n&&(n=new eui.Image,n.touchEnabled=!1),n.source=this.atlasName+"."+this.prefixName+e,n.height=this.height,n.width=this.imgWidth,this.addChild(n),n},t.prototype.clearImages=function(){for(var e=this.numChildren-1;e>=0;--e)t.pool.pushObj(this.getChildAt(e));this.removeChildren()},t.prototype.setNumber=function(e){if(this.clearImages(),0==e){var n=this.getImage(0);return void(n.horizontalCenter=0)}for(t.tmpArray.splice(0);0!=e;)t.tmpArray.push(e%10),e=Math.floor(e/10);for(var o=-(t.tmpArray.length-1)/2*this.imgWidth,i=t.tmpArray.length-1;i>=0;--i){var n=this.getImage(t.tmpArray[i]);n.horizontalCenter=o,o+=this.imgWidth}},t.prototype.setImage=function(e){this.clearImages();var t=this.getImage(0);return t.source=e,t.horizontalCenter=0,t},t.prototype.setNubmerAndChangeWidth=function(e){if(this.clearImages(),0==e){var n=this.getImage(0);return this.width=this.imgWidth,void(n.horizontalCenter=0)}for(t.tmpArray.splice(0);0!=e;)t.tmpArray.push(e%10),e=Math.floor(e/10);this.width=(this.imgWidth+this.offset)*t.tmpArray.length+this.offset;for(var o=-(t.tmpArray.length-1)/2*(this.imgWidth+this.offset),i=t.tmpArray.length-1;i>=0;--i){var n=this.getImage(t.tmpArray[i]);n.horizontalCenter=o,o+=this.imgWidth+this.offset}},t.pool=new ObjectPool,t.tmpArray=new Array,t}(eui.Group);__reflect(NumberGroup.prototype,"NumberGroup");var BaseController=function(){function e(){this.controllerID=0,this.msgRegisted={}}return e.prototype.initByLoginAfter=function(){},e.prototype.getModel=function(){return this.model},e.prototype.setControllerID=function(e){this.controllerID=e},e.prototype.getControllerID=function(){return this.controllerID},e.prototype.registerFunc=function(e,t,n){this.msgRegisted[e]=[t,n]},e.prototype.unregisterFunc=function(e){this.msgRegisted[e]=null,delete this.msgRegisted[e]},e.prototype.applyFunc=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var o=this.msgRegisted[e];return o?o[0].apply(o[1],t):(console.error("Can't found listen , key="+e+" controller id = "+this.controllerID),null)},e.prototype.applyControllerFunc=function(e,t){for(var n=[],o=2;o<arguments.length;o++)n[o-2]=arguments[o];return App.ControllerManager.applyFunc.apply(App.ControllerManager,arguments)},e.prototype.executeMessage=function(e,t,n){},e.prototype.registerHttpExecute=function(e){},e.prototype.unregisterHttpExecute=function(e){},e}();__reflect(BaseController.prototype,"BaseController",["IController"]);var Level53=function(e){function t(){var t=e.call(this)||this;return t.bulletNum=3,t.skinName="resource/level/l53.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t}(LevelCreator);__reflect(Level53.prototype,"Level53"),window.Level53=Level53;var GlobalConfigure=function(e){function t(){var t=e.call(this)||this;return t.TextColors={white:16777215,milkWhite:16511407,grayWhite:13547170,yellow:16776960,lightYellow:16765813,orangeYellow:16750848,red:15799040,green:58624,blue:1742039,grayBlue:3101047,purple:15284466,pink:16724016,black:3026221,golden:16766720},t.LabelFontSize={littleSize:12,middleSize:18,normalSize:24,bigSize:36},t.json_value={},t}return __extends(t,e),t.prototype.register=function(e){this.json_value=e,console.log(this.json_value)},t.prototype.GetGlobalValue=function(e){return null==e||"undefined"==typeof this.json_value[e]?"":this.json_value[e]},t.prototype.GetNumber=function(e){return null==e||"undefined"==typeof this.json_value[e]?0:Number(this.json_value[e])},t.prototype.GetNumberArr=function(e,t){return null==e||"undefined"==typeof this.json_value[e]?0:Number(this.json_value[e][t])},t.prototype.GetArray=function(e){return null==e||"undefined"==typeof this.json_value[e]?null:this.json_value[e]},t.prototype.loadLocalData=function(e,t){var n=egret.localStorage.getItem(e);return n?n:(egret.localStorage.setItem(e,t),t)},t.prototype.getLocalTodayNumber=function(e){var t=this.getLocalTodayValue(e);return t&&""!=t?Number(t):0},t.prototype.getLocalTodayValue=function(e){var t=App.DateUtils.getToday(),n=this.loadLocalData(e+"_DATE_","");return n!=t?"":this.loadLocalData(e,"")},t.prototype.setLocalTodayNumber=function(e,t){this.setLocalTodayValue(e,t+"")},t.prototype.setLocalTodayValue=function(e,t){var n=App.DateUtils.getToday();egret.localStorage.setItem(e+"_DATE_",n),egret.localStorage.setItem(e,t)},t}(BaseClass);__reflect(GlobalConfigure.prototype,"GlobalConfigure");var Percent=function(){function e(e,t){this.currentValue=e,this.totalValue=t}return e.prototype.computePercent=function(){return this.currentValue/this.totalValue*100},e.prototype.computeRate=function(){return this.currentValue/this.totalValue},e.prototype.reverse=function(){return this.currentValue=this.totalValue-this.currentValue,this},e.prototype.copy=function(){return new e(this.currentValue,this.totalValue)},e.prototype.computePercentReverse=function(){return(this.totalValue-this.currentValue)/this.totalValue*100},e.prototype.computeRateReverse=function(){return(this.totalValue-this.currentValue)/this.totalValue},e}();__reflect(Percent.prototype,"Percent");var ArrayUtils=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.forEach=function(e,t,n){for(var o=0,i=e.length;i>o;o++)t.apply(n,[e[o]])},t.prototype.deleteRightCount=function(e,t){return e.length<t&&e.splice(e.length,0),e.splice(e.length-t,t),e},t.prototype.deleteLeftCount=function(e,t){return e.length<t&&e.splice(e.length,0),e.splice(t,0),e},t.prototype.clearArray=function(e){if(null!=e)for(;e.length>0;)e.pop()},t}(BaseClass);__reflect(ArrayUtils.prototype,"ArrayUtils");var DateUtils=function(e){function t(){var t=e.call(this)||this;return t.today=null,t}return __extends(t,e),t.prototype.getTimeUnit=function(e){return 6e4>e?"1分钟":36e5>e?Math.floor(e/6e4)+"分钟":Math.floor(e/36e5)+"小时"},t.prototype.getToday=function(){if(this.today)return this.today;var e=new Date(Date.now()),t=e.getFullYear(),n=e.getMonth()+1,o=e.getDate();return this.today=t+"-"+n+"-"+o,this.today},t.prototype.getFormatBySecond=function(e,t){void 0===t&&(t=1);var n="";switch(t){case 1:n=this.getFormatBySecond1(e);break;case 2:n=this.getFormatBySecond2(e);break;case 3:n=this.getFormatBySecond3(e);break;case 4:n=this.getFormatBySecond4(e);break;case 5:n=this.getFormatBySecond5(e)}return n},t.prototype.getFormatBySecond1=function(e){void 0===e&&(e=0);var t,n=Math.floor(e/3600);t=0==n?"00":10>n?"0"+n:""+n;var o,i,r=Math.floor((e-3600*n)/60),s=Math.floor((e-3600*n)%60);return o=0==r?"00":10>r?"0"+r:""+r,i=0==s?"00":10>s?"0"+s:""+s,t+":"+o+":"+i},t.prototype.getFormatBySecond3=function(e){void 0===e&&(e=0);var t,n,o=Math.floor(e/3600),i=Math.floor((e-3600*o)/60),r=Math.floor((e-3600*o)%60);return t=0==i?"00":10>i?"0"+i:""+i,n=0==r?"00":10>r?"0"+r:""+r,t+":"+n},t.prototype.getFormatBySecond2=function(e){var t=new Date(e),n=t.getFullYear(),o=t.getMonth()+1,i=t.getDate(),r=t.getHours(),s=t.getMinutes(),a=t.getSeconds();return n+"-"+o+"-"+i+" "+r+":"+s+":"+a},t.prototype.getFormatBySecond4=function(e){var t=Math.floor(e/3600);return t>0?t>24?Math.floor(t/24)+"天前":t+"小时前":Math.floor(e/60)+"分钟前"},t.prototype.getFormatBySecond5=function(e){var t=86400,n=3600,o=60,i=Math.floor(e/t),r=Math.floor(e%t/n),s=Math.floor((e-r*n)/o),a=Math.floor((e-r*n)%o),l="",p="",h="",c="";return e>0?0==i?(l="",0==r?(p="",0==s?(h="",c=0==a?"":10>a?"0"+a+"秒":""+a+"秒"):(h=""+s+"分",c=0==a?"":10>a?"0"+a+"秒":""+a+"秒",h+c)):(p=r+"小时",0==s?(h="",c=0==a?"":10>a?"0"+a+"秒":""+a+"秒"):(h=10>s?"0"+s+"分":""+s+"分",p+h))):(l=i+"天",p=0==r?"":10>r?"0"+r+"小时":""+r+"小时",l+p):""},t}(BaseClass);__reflect(DateUtils.prototype,"DateUtils");var DebugUtils=function(e){function t(){var t=e.call(this)||this;return t.thresholdTime=3,t.startTimes={},t}return __extends(t,e),t.prototype.setDebugOpen=function(e){this.debugOpen=e},Object.defineProperty(t.prototype,"isDebugOpen",{get:function(){return this.debugOpen},enumerable:!0,configurable:!0}),t.prototype.setThresholdTime=function(e){this.thresholdTime=e},t.prototype.start=function(e){this.debugOpen&&(this.startTimes[e]=Timer.nowTime)},t.prototype.stop=function(e){if(!this.debugOpen)return 0;if(!this.startTimes[e])return 0;var t=Timer.nowTime-this.startTimes[e];return t>this.thresholdTime,t},t.prototype.systemType=function(){var e=window.navigator.userAgent.toLowerCase();""+e.match(/MicroMessenger/i);return""+e.match(/windows nt/i)=="windows nt"?"windows":""+e.match(/iphone/i)=="iphone"?"ios":""+e.match(/android/i)=="android"?"android":""+e.match(/ipad/i)=="ipad"?"ipad":""+e.match(/linux/i)=="linux"?"linux":""+e.match(/mac/i)=="mac"?"mac":""+e.match(/ucbrower/i)=="ucbrower"?"ucbrower":void console.log("未知系统类型")},t.prototype.platformType=function(){var e=window.navigator.userAgent.toLowerCase();return""+e.match(/micromessenger/i)=="micromessenger"?"micromessenger":""+e.match(/qzone/i)=="qzone"?"qzone":""+e.match(/weibo/i)=="weibo"?"weibo":""+e.match(/qq/i)=="qq"?"qq":""+e.match(/renren/i)=="renren"?"renren":""+e.match(/txmicroblog/i)=="txmicroblog"?"txmicroblog":""+e.match(/douban/i)=="douban"?"douban":"other"},t}(BaseClass);__reflect(DebugUtils.prototype,"DebugUtils");var DeviceUtils=function(e){function t(){return e.call(this)||this}return __extends(t,e),Object.defineProperty(t.prototype,"IsHtml5",{get:function(){return egret.Capabilities.runtimeType==egret.RuntimeType.WEB},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"IsNative",{get:function(){return egret.Capabilities.runtimeType==egret.RuntimeType.NATIVE},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"IsMobile",{get:function(){return egret.Capabilities.isMobile},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"IsPC",{get:function(){return!egret.Capabilities.isMobile},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"IsQQBrowser",{get:function(){return this.IsHtml5&&-1!=navigator.userAgent.indexOf("MQQBrowser")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"IsIEBrowser",{get:function(){return this.IsHtml5&&-1!=navigator.userAgent.indexOf("MSIE")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"IsFirefoxBrowser",{get:function(){return this.IsHtml5&&-1!=navigator.userAgent.indexOf("Firefox")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"IsChromeBrowser",{get:function(){return this.IsHtml5&&-1!=navigator.userAgent.indexOf("Chrome")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"IsSafariBrowser",{get:function(){return this.IsHtml5&&-1!=navigator.userAgent.indexOf("Safari")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"IsOperaBrowser",{get:function(){return this.IsHtml5&&-1!=navigator.userAgent.indexOf("Opera")},enumerable:!0,configurable:!0}),t}(BaseClass);__reflect(DeviceUtils.prototype,"DeviceUtils");var DisplayUtils=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.createBitmapByName=function(e){var t=new egret.Bitmap,n=RES.getRes(e);return t.texture=n,t},t.prototype.createEuiImage=function(e){var t=new eui.Image,n=RES.getRes(e);return t.source=n,t},t.prototype.removeFromParent=function(e){null!=e.parent&&e.parent.removeChild(e)},t.prototype.DrawBorderLine=function(e,t,n,o,i,r){void 0===o&&(o=0),void 0===i&&(i=0),void 0===r&&(r=1123020);var s=new egret.Shape;return s.graphics.lineStyle(3,65280),s.graphics.beginFill(r,0),s.graphics.drawRect(o,i,e,t),s.graphics.endFill(),n.addChild(s),s},t}(BaseClass);__reflect(DisplayUtils.prototype,"DisplayUtils");var EffectUtils=function(e){function t(){var t=e.call(this)||this;return t.rotationArr=[],t}return __extends(t,e),t.prototype.rockObj=function(e,t,n){void 0===n&&(n=20);var o=function(){if(null!=e){var i=function(){egret.Tween.get(e).to({rotation:-n},t).call(o,this)};egret.Tween.get(e).to({rotation:n},t).call(i,this)}};o()},t.prototype.flyObj=function(e,t,n){void 0===n&&(n=50);var o=function(){if(null!=e){var i=function(){egret.Tween.get(e).to({y:e.y-n},t).call(o,this)};egret.Tween.get(e).to({y:e.y+n},t).call(i,this)}};o()},t.prototype.playScaleEffect=function(e){var t=function(){if(null!=e){var n=function(){e.scaleX=1,e.scaleY=1,egret.Tween.get(e).to({alpha:1},1e3).call(t,self)};e.alpha=1,egret.Tween.get(e).to({scaleX:1.5,scaleY:1.5,alpha:0},1e3).call(n,self)}};t()},t.prototype.rotationEffect=function(e,t){if(void 0===t&&(t=1e3),null==this.rotationArr&&(this.rotationArr=[]),!this.rotationArr[e.hashCode]){null!=this.rotationArr[e.hashCode]&&this.rotationArr[e.hashCode]||(this.rotationArr[e.hashCode]=!0);var n=function(){this.rotationArr[e.hashCode]&&null!=e&&(e.rotation=0,egret.Tween.get(e).to({rotation:360},t).call(n,this))};e.rotation=0,egret.Tween.get(e).to({rotation:360},t).call(n,this)}},t.prototype.removeRotationEffect=function(e){null==this.rotationArr&&(this.rotationArr=[]),this.rotationArr[e.hashCode]=!1},t.prototype.shakeObj=function(e){var t=80,n=e.x;egret.Tween.get(e).to({x:e.x-10},t),App.Timer.doTimer(2*t,1,function(){egret.Tween.get(e).to({x:e.x+20},t)},this),App.Timer.doTimer(3*t,1,function(){egret.Tween.get(e).to({x:e.x-20},t)},this),App.Timer.doTimer(4*t,1,function(){egret.Tween.get(e).to({x:e.x+20},t)},this),App.Timer.doTimer(5*t,1,function(){egret.Tween.get(e).to({x:n},t)},this)},t.prototype.shakeScreen=function(e){void 0===e&&(e=1);var t=App.MainSprite,n=40,o=t.x,i=t.y;1==e?(egret.Tween.get(t).to({x:t.x-10},n),App.Timer.doTimer(2*n,1,function(){egret.Tween.get(t).to({x:t.x+20},n)},this),App.Timer.doTimer(3*n,1,function(){egret.Tween.get(t).to({x:t.x-20},n)},this),App.Timer.doTimer(4*n,1,function(){egret.Tween.get(t).to({x:t.x+20},n)},this),App.Timer.doTimer(5*n,1,function(){egret.Tween.get(t).to({x:o},n)},this)):(egret.Tween.get(t).to({x:t.x-10,y:t.y},n),App.Timer.doTimer(2*n,1,function(){egret.Tween.get(t).to({x:t.x+20,y:t.y},n)},this),App.Timer.doTimer(3*n,1,function(){egret.Tween.get(t).to({x:t.x,y:t.y+15},n)},this),App.Timer.doTimer(4*n,1,function(){egret.Tween.get(t).to({x:t.x,y:t.y-20},n)},this),App.Timer.doTimer(5*n,1,function(){egret.Tween.get(t).to({x:t.x,y:t.y+10},n)},this),App.Timer.doTimer(6*n,1,function(){egret.Tween.get(t).to({x:o,y:i},n)},this))},t.prototype.startFlicker=function(e,t){e.alpha=1,egret.Tween.get(e).to({alpha:0},t).to({alpha:1},t).call(this.startFlicker,this,[e,t])},t.prototype.stopFlicker=function(e){egret.Tween.removeTweens(e)},t}(BaseClass);__reflect(EffectUtils.prototype,"EffectUtils");var GlobalEvent=function(e){function t(t,n,o,i){return void 0===n&&(n=null),void 0===o&&(o=!1),void 0===i&&(i=!1),e.call(this,t,o,i,n)||this}return __extends(t,e),t}(egret.Event);__reflect(GlobalEvent.prototype,"GlobalEvent");var GlobalDispatcher=function(e){function t(){return e.call(this)||this}return __extends(t,e),Object.defineProperty(t,"Instance",{get:function(){return null==this.instance&&(this.instance=new t),this.instance},enumerable:!0,configurable:!0}),t}(egret.EventDispatcher);__reflect(GlobalDispatcher.prototype,"GlobalDispatcher");var MathUtils=function(e){function t(){var t=e.call(this)||this;return t.DEG2RAD=2*Math.PI/360,t.RAD2DEG=1/(2*Math.PI/360),t.PI=Math.PI,t.PI2=2*Math.PI,t.HalfPI=Math.PI/2,t.grayFilters=[new egret.ColorMatrixFilter([.3,.6,0,0,0,.3,.6,0,0,0,.3,.6,0,0,0,0,0,0,1,0])],t}return __extends(t,e),t.getAngle=function(e){return 180*e/Math.PI},t.getRadian=function(e){return e/180*Math.PI},t.prototype.getRadian2=function(e,t,n,o){var i=n-e,r=o-t;return Math.atan2(r,i)},t.prototype.getDistance=function(e,t,n,o){var i=n-e,r=o-t,s=i*i+r*r;return Math.sqrt(s)},t.prototype.angleDistance=function(e,t){var n=e-t;return-180>n?e+360:n>180?e-360:e},t.prototype.clamp01=function(e){return 0>e?0:e>1?1:e},t.prototype.clamp=function(e,t,n){return t>e?e=t:e>n&&(e=n),e},t.prototype.rectIsHit=function(e,t){return e.right<t.left||t.right<e.left||e.bottom<t.top||t.bottom<e.top?!1:!0},t}(BaseClass);__reflect(MathUtils.prototype,"MathUtils");var PopUpUtils=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.viewPopUp=function(e,t,n,o,i){if(void 0===t&&(t=0),void 0===n&&(n=0),void 0===o&&(o=0),void 0===i&&(i=!1),e.x=0,e.y=0,e.alpha=1,e.scaleX=1,e.scaleY=1,egret.Tween.removeTweens(e),!(0>=o)){0!=t?(e.x=App.MainSprite.width/2-t/2,e.y=App.MainSprite.height/2-n/2):(t=e.width,n=e.height);var r=App.MainSprite.width/2-t/2,s=App.MainSprite.width/2-n/2;1==o?(e.alpha=0,e.scaleX=.5,e.scaleY=.5,e.x=e.x+t/4,e.y=e.y+n/4,egret.Tween.get(e).to({alpha:1,scaleX:1,scaleY:1,x:e.x-t/4,y:e.y-n/4},300,egret.Ease.backOut)):2==o?(e.alpha=0,e.scaleX=.5,e.scaleY=.5,e.x=e.x+t/4,e.y=e.y+n/4,egret.Tween.get(e).to({alpha:1,scaleX:1,scaleY:1,x:e.x-t/4,y:e.y-n/4},600,egret.Ease.elasticOut)):3==o?i?(e.x=-t,egret.Tween.get(e).to({x:r},500,egret.Ease.cubicOut)):(e.x=-t,egret.Tween.get(e).to({x:0},500,egret.Ease.cubicOut)):4==o?i?(e.x=t,egret.Tween.get(e).to({x:r},500,egret.Ease.cubicOut)):(e.x=t,egret.Tween.get(e).to({x:0},500,egret.Ease.cubicOut)):5==o?i?(e.y=-n,egret.Tween.get(e).to({y:s},500,egret.Ease.cubicOut)):(e.y=-n,egret.Tween.get(e).to({y:0},500,egret.Ease.cubicOut)):6==o?i?(e.y=App.MainSprite.height,egret.Tween.get(e).to({y:s},500,egret.Ease.cubicOut)):(e.y=n,egret.Tween.get(e).to({y:0},500,egret.Ease.cubicOut)):7==o&&(e.horizontalCenter=e.width,egret.Tween.get(e).to({horizontalCenter:0},200,egret.Ease.cubicOut))}},t.prototype.viewPopDown=function(e){var t=e.getPopDownType();if(0>=t)return void e.removeFromParent();var n=e.getPopDownObj();switch(t){case 1:egret.Tween.get(n).to({alpha:0,scaleX:0,scaleY:0,x:e.x+e.width/2,y:e.y+e.height/2},300);break;case 2:break;case 3:egret.Tween.get(n).to({x:e.width},500,egret.Ease.cubicOut);break;case 4:egret.Tween.get(n).to({x:-e.width},500,egret.Ease.cubicOut);break;case 5:egret.Tween.get(n).to({y:e.height},500,egret.Ease.cubicOut);break;case 6:egret.Tween.get(n).to({y:-e.height},500,egret.Ease.cubicOut);break;case 7:egret.Tween.get(n).to({horizontalCenter:e.width},500,egret.Ease.cubicOut)}egret.Tween.get(n).wait(500).call(function(){0==App.ViewManager.isShow(e.getViewID())&&e.removeFromParent()},this)},t}(BaseClass);__reflect(PopUpUtils.prototype,"PopUpUtils");var RandomUtils=function(e){function t(){var t=e.call(this)||this;return t.randSeed=0,t.resetSeed(),t}return __extends(t,e),t.prototype.limit=function(e,t){e=Math.min(e,t),t=Math.max(e,t);var n=t-e;return e+Math.random()*n},t.prototype.limitInteger=function(e,t){return Math.floor(this.limit(e,t))},t.prototype.randomArray=function(e){var t=Math.floor(Math.random()*e.length);return e[t]},t.prototype.resetSeed=function(){this.randSeed=Math.floor(1e5*Math.random())},t.prototype.random=function(){return this.randSeed=2045*this.randSeed+1,this.randSeed=this.randSeed-1048576*Math.floor(this.randSeed/1048576),this.randSeed/1048576},t.prototype.frand=function(e,t){if(e==t)return e;e=Math.min(e,t),t=Math.max(e,t);var n=t-e;return e+this.random()*n},t.prototype.irand=function(e,t){return e==t?e:Math.floor(this.frand(e,t))},t}(BaseClass);__reflect(RandomUtils.prototype,"RandomUtils");var ControllerManager=function(e){function t(){var t=e.call(this)||this;return t.modules={},t}return __extends(t,e),t.prototype.initByLoginAfter=function(){for(var e in this.modules)this.modules[e].initByLoginAfter()},t.prototype.register=function(e,t){return this.isExists(e)?void console.error("the module is registed.key="+e):void(this.modules[e]=t)},t.prototype.unregister=function(e){this.isExists(e)&&(this.modules[e]=null,delete this.modules[e])},t.prototype.isExists=function(e){return null!=this.modules[e]},t.prototype.applyFunc=function(e,t){for(var n=[],o=2;o<arguments.length;o++)n[o-2]=arguments[o];var i=this.modules[e];if(i){for(var r=[],s=1;s<arguments.length;s++)r[s-1]=arguments[s];return i.applyFunc.apply(i,r)}return console.error("module "+e+" not exists."),null},t.prototype.getControllerModel=function(e){var t=this.modules[e];return t?t.getModel():null},t.prototype.getController=function(e){return this.modules[e]},t}(BaseClass);__reflect(ControllerManager.prototype,"ControllerManager");var GameLevelController=function(){function e(){}return e.prototype.init=function(){App.LoginInfo.level=Number(App.LoginInfo.level),App.LoginInfo.maxlevel=Number(App.LoginInfo.maxlevel),App.LoginInfo.extralevel=Number(App.LoginInfo.extralevel),this.realLevel=App.LoginInfo.level,App.LoginInfo.maxlevel&&0!=App.LoginInfo.maxlevel||(App.LoginInfo.maxlevel=this.realLevel),App.LoginInfo.extralevel&&0!=App.LoginInfo.extralevel||(App.LoginInfo.extralevel=this.realLevel),this.maxLevel=App.LoginInfo.maxlevel,this.extraLevel=App.LoginInfo.extralevel},e.prototype.calcGameOver=function(){this.realLevel++,this.maxLevel<App.GlobalConfigure.GetNumber("maxLevel")?(this.extraLevel==this.maxLevel&&this.extraLevel++,this.maxLevel++,this.nowLevel=this.maxLevel):this.extraLevel==this.maxLevel?(this.extraLevel=this.extraLevel%this.maxLevel+1,this.nowLevel=this.extraLevel):this.nowLevel=++this.extraLevel,App.LoginInfo.level=this.realLevel,App.LoginInfo.maxlevel=this.maxLevel,App.LoginInfo.extralevel=this.extraLevel,ServerDataQueue.Instance.needUploadLevel=!0},e.prototype.gameSuccess=function(){App.ControllerManager.getControllerModel(EControllerID.MAIN);this.calcGameOver()},e.prototype.getNowLevel=function(){return this.nowLevel?this.nowLevel+1:this.maxLevel<App.GlobalConfigure.GetNumber("maxLevel")?(this.nowLevel=this.maxLevel,this.nowLevel+1):(this.nowLevel=this.extraLevel,this.nowLevel+1)},e}();__reflect(GameLevelController.prototype,"GameLevelController");var EViewLayer;!function(e){e[e.MAP=0]="MAP",e[e.BACK=10]="BACK",e[e.NORMAL=20]="NORMAL",e[e.LOADING=30]="LOADING",e[e.MASK=40]="MASK",e[e.TIPS=50]="TIPS"}(EViewLayer||(EViewLayer={}));var ViewLayerManager=function(e){function t(){var t=e.call(this)||this;return t.layers={},t.registerLayer(EViewLayer.MAP),t.registerLayer(EViewLayer.BACK),t.registerLayer(EViewLayer.NORMAL),t.registerLayer(EViewLayer.LOADING),t.registerLayer(EViewLayer.MASK),t.registerLayer(EViewLayer.TIPS),t}return __extends(t,e),t.prototype.registerLayer=function(e){if(this.layers[e])return void console.error("the layer is registed.");var t=new eui.UILayer;t.touchThrough=!0,t.touchEnabled=!1,App.MainSprite.addChild(t),this.layers[e]=t},t.prototype.setLayer=function(e,t){return this.layers[t]?void e.setParent(this.layers[t]):void console.error("can't found layer.")},t.prototype.getLayer=function(e){return this.layers[e]},t}(BaseClass);__reflect(ViewLayerManager.prototype,"ViewLayerManager");var GameMap=function(e){function t(){var n=e.call(this)||this;n.cloudImgs=[],n.tmp=new egret.Point,n.zoom=1,n.zoomX=0,n.zoomY=0,n.tz=0,t.Instance=n,n.levelLayer=new egret.Sprite,n.addChild(n.levelLayer);var o=new eui.Image("logo_bg_png");o.width=App.MainSprite.width+60,o.height=App.MainSprite.height+60,o.scale9Grid==new egret.Rectangle(3,3,3,3),n.levelLayer.addChild(o);var i=new eui.Image;return i.source="cloud",i.x=100,i.y=100,n.levelLayer.addChild(i),i=new eui.Image,i.source="cloud",i.x=800,i.y=300,n.levelLayer.addChild(i),i=new eui.Image,i.source="cloud",i.x=500,i.y=230,n.levelLayer.addChild(i),i=new eui.Image,i.source="cloud",i.x=300,i.y=400,n.levelLayer.addChild(i),i=new eui.Image,i.source="cloud",i.x=650,i.y=350,n.levelLayer.addChild(i),n.terrainBG=new eui.Image,n.terrainBG.source="terrainbg",n.terrainBG.fillMode="repeat",n.terrainBG.x=n.terrainBG.y=-30,n.terrainBG.width=App.MainSprite.width+60,n.terrainBG.height=App.MainSprite.height+60,n.levelLayer.addChild(n.terrainBG),n.terrainMask=new egret.Sprite,n.levelLayer.addChild(n.terrainMask),n.terrainBG.mask=n.terrainMask,n.darkRec=new eui.Rect(App.MainSprite.width+100,App.MainSprite.height+100,0),n.darkRec.alpha=0,n.darkRec.x=n.darkRec.y=-50,n.levelLayer.addChild(n.darkRec),n.roleLayer=new egret.Sprite,n.addChild(n.roleLayer),n.effectLayer=new egret.Sprite,n.addChild(n.effectLayer),new MCEffectController,new EffectController,n}return __extends(t,e),t.prototype.update=function(e){MCEffectController.Instance.update(),EffectController.Instance.update()},t.prototype.clear=function(){null!=this.lc&&(this.levelLayer.removeChild(this.lc),this.lc.clear()),EffectController.Instance.clear()},t.prototype.setLevel=function(e){var t="Level"+e,n=egret.getDefinitionByName(t);return null==n?(console.log("找不到关卡 "+e),!1):(console.log("setLevel----",t),this.clear(),this.lc=new n,this.levelLayer.addChild(this.lc),this.lc.init(),App.Sound.playEffect("reload.mp3"),P2World.Instance.run(),void(2==App.bNewPlayer&&(App.ViewManager.open(EViewID.GUIDE_VIEW),App.bNewPlayer=0)))},t.prototype.resetBg=function(e,t,n){this.width=this.lc.width,this.height=this.lc.height;var o=n.length,i=n[0];this.terrainMask.graphics.clear(),this.terrainMask.graphics.beginFill(0,1),this.terrainMask.graphics.moveTo(i[0],i[1]);for(var r=1;o>=r;r++)i=n[r%o],this.terrainMask.graphics.lineTo(i[0],i[1]);this.terrainMask.graphics.endFill()},t.prototype.shake=function(){egret.Tween.removeTweens(this);var e=egret.Tween.get(this);e.to({x:30,y:30},30,egret.Ease.bounceOut),e.to({x:-23,y:23},30,egret.Ease.bounceOut),e.to({x:16,y:-16},40,egret.Ease.bounceIn),e.to({x:-10,y:-10},50,egret.Ease.bounceOut),e.to({x:10,y:-10},60,egret.Ease.bounceIn),e.to({x:5,y:5},70,egret.Ease.bounceOut),e.to({x:-5,y:-5},80,egret.Ease.bounceOut),e.to({x:0,y:0},90,egret.Ease.bounceIn)},t.prototype.dark=function(e,t){egret.Tween.removeTweens(this.darkRec);var n=egret.Tween.get(this.darkRec);n.to({alpha:e},150,egret.Ease.cubicOut),n.to({alpha:0},t,egret.Ease.cubicIn)},t.prototype.playZoom=function(e,t,n,o){this.zoomX=e,this.zoomY=t,this.tz=n-1,egret.Tween.removeTweens(this);var i=egret.Tween.get(this);i.to({Zoom:n},.3*o,egret.Ease.cubicOut),i.to({Zoom:1},.7*o,egret.Ease.cubicIn)},Object.defineProperty(t.prototype,"Zoom",{get:function(){return this.zoom},set:function(e){this.zoom=e;var t=(this.width*this.zoom,this.height*this.zoom,.5*this.width-this.zoomX*this.zoom),n=.5*this.height-this.zoomY*this.zoom;this.x=t*((this.zoom-1)/this.tz),this.y=n*((this.zoom-1)/this.tz),this.scaleX=this.scaleY=this.zoom},enumerable:!0,configurable:!0}),t}(eui.Component);__reflect(GameMap.prototype,"GameMap");var ViewManager=function(e){function t(){var t=e.call(this)||this;return t.views={},t.opens=[],t}return __extends(t,e),t.prototype.register=function(e,t){return null==t||0==e?void console.error("registe failed, the view is null."):this.views[e]?void console.error("registe failed, the view is registed."):(t.setViewID(e),void(this.views[e]=t))},t.prototype.unregister=function(e){this.views[e]&&(this.views[e]=null,delete this.views[e])},t.prototype.getView=function(e){return this.views[e]},t.prototype.destroy=function(e,t){void 0===t&&(t=null);var n=this.getView(e);n&&(this.unregister(e),n.destroy(),n=null),this.register(e,t)},t.prototype.open=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var o=this.getView(e);return null==o?void console.error("can't not exists view."+e):this.isShow(e)?(o.openAndopen.apply(o,t),o):o.getState()==EViewState.INITING?o:(null!=this.nowTopView&&this.nowTopView.onNotTopView(),this.nowTopView=o,o.onTopView(),this.opens.push(e),o.getState()==EViewState.INITED?(o.addToParent(),o.open.apply(o,t)):(o.loadResource(null,null),o.initView(),o.addToParent(),o.open.apply(o,t)),o)},t.prototype.openAttach=function(e,t){for(var n=[],o=2;o<arguments.length;o++)n[o-2]=arguments[o];this.closeView(t);var i=this.open.apply(this,[e].concat(n));return i&&i.setCloseOnOpen(t),i},t.prototype.closeView=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(!this.isShow(e))return null;var o=this.getView(e);if(null==o)return null;var i=this.opens.indexOf(e);return i>=0&&this.opens.splice(i,1),o instanceof BaseView?App.PopUpUtils.viewPopDown(o):o.removeFromParent(),o==this.nowTopView&&this.nowTopView.onNotTopView(),o.close.apply(o,t),this.opens.length>0?(this.nowTopView=this.getView(this.opens[this.opens.length-1]),this.nowTopView.onTopView()):this.nowTopView=null,o},t.prototype.close=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var o=this.closeView.apply(this,[e].concat(t));if(o){var i=o.getCloseOnOpen();
i>0&&(this.open(i),o.setCloseOnOpen(-1))}},t.prototype.closeAll=function(){for(;this.opens.length;)this.close(this.opens[0])},t.prototype.currOpenNum=function(){return this.opens.length},t.prototype.isShow=function(e){return-1!=this.opens.indexOf(e)},t.prototype.clear=function(){this.closeAll(),this.views={}},t}(BaseClass);__reflect(ViewManager.prototype,"ViewManager");var OperationPanel=function(e){function t(){var n=e.call(this)||this;n.ca=["player02","player03","player04","player05","player06","player07","player08","player09","player10","player11","player12","player13","player14","player01"],n.ci=0,n.ga=["gun_01_1","gun_01_2","gun_02","gun_03","gun_01"],n.gi=0,t.Instance=n;var o=new eui.Rect;return o.alpha=0,o.percentWidth=o.percentHeight=100,n.addChild(o),n.rayImg=new eui.Image,n.rayImg.source="ray",n.rayImg.scale9Grid=new egret.Rectangle(2,2,2,2),n.rayImg.width=2e3,n.rayImg.height=6,n.rayImg.anchorOffsetY=3,n.addChild(n.rayImg),n.rayImg.touchEnabled=!1,n.rayImg.visible=!1,n.targetImg=new eui.Image,n.targetImg.source="target",n.targetImg.width=n.targetImg.height=150,n.targetImg.anchorOffsetX=n.targetImg.anchorOffsetY=75,n.addChild(n.targetImg),n.targetImg.touchEnabled=!1,n.targetImg.visible=!1,n.percentHeight=n.percentWidth=100,n.addEventListener(egret.TouchEvent.TOUCH_BEGIN,n.onBegin,n),n.addEventListener(egret.TouchEvent.TOUCH_MOVE,n.onMove,n),n.addEventListener(egret.TouchEvent.TOUCH_END,n.onEnd,n),n.openKeyTest(),n}return __extends(t,e),t.prototype.fixX=function(e){return e-GameMap.Instance.x},t.prototype.fixY=function(e){return e-GameMap.Instance.x},t.prototype.updateRay=function(e,t,n){this.rayImg.x=GameMap.Instance.x+e,this.rayImg.y=GameMap.Instance.y+t,this.rayImg.rotation=n},t.prototype.onBegin=function(e){App.Sound.playEffect("aim.mp3"),this.rayImg.visible=!0,this.targetImg.visible=!0,this.targetImg.x=e.localX,this.targetImg.y=e.localY,PlayerObj.Instance.aim(this.fixX(e.localX),this.fixX(e.localY));var t=App.ViewManager.getView(EViewID.GAME_PLAY_VIEW);t.hideContent()},t.prototype.onMove=function(e){this.targetImg.x=e.localX,this.targetImg.y=e.localY,PlayerObj.Instance.aim(this.fixX(e.localX),this.fixX(e.localY))},t.prototype.onEnd=function(e){this.rayImg.visible=!1,this.targetImg.visible=!1,RoleManager.Instance.player.fire();var t=App.ViewManager.getView(EViewID.GAME_PLAY_VIEW);t.showContent()},t.prototype.openKeyTest=function(){document.addEventListener("keydown",function(e){81==e.keyCode&&(Timer.slow(2e3,.1),GameMap.Instance.dark(.5,2e3)),87==e.keyCode&&(Energy.Instance.energy+=10),69==e.keyCode&&t.Instance.testChangeGun(),82==e.keyCode&&SkipController.Instance.showView(ESkipViewType.BIGLIKESIX),84==e.keyCode&&App.ViewManager.open(EViewID.GOLD_BOX_VIEW),console.log(e.keyCode)})},t.prototype.testChangeskin=function(){PlayerObj.Instance.changeSkin(this.ca[this.ci]),this.ci++,this.ci>=this.ca.length&&(this.ci=0)},t.prototype.testChangeGun=function(){PlayerObj.Instance.changeGun(this.ga[this.gi]),this.gi++,this.gi>=this.ga.length&&(this.gi=0)},t}(eui.Component);__reflect(OperationPanel.prototype,"OperationPanel");var p2DebugDraw=function(){function e(e,t){this.COLOR_D_SLEEP=16711680,this.COLOR_D_WAKE=65280,this.COLOR_K=65535,this.COLOR_S=255,this.COLOR_BLACK=0,this.COLOR_RED=16711680,this.isDrawAABB=!1,this.factor=50,this.factor=P2World.p2dFactor,this.world=e,this.sprite=t}return e.prototype.drawDebug=function(){this.sprite.graphics.clear();for(var e=this.world.bodies.length,t=0;e>t;t++)for(var n=this.world.bodies[t],o=0;o<n.shapes.length;o++){var i=n.shapes[o];this.drawShape(i,n),this.isDrawAABB&&this.drawAABB(n)}e=this.world.constraints.length;e=this.world.springs.length;for(var r,s=0;e>s;s++)r=this.world.springs[s],r instanceof p2.LinearSpring?this.drawLinearSpring(r):r instanceof p2.RotationalSpring&&this.drawRotationalSpring(r)},e.prototype.drawAABB=function(e){var t=new Array,n=e.aabb.lowerBound[0],o=e.aabb.lowerBound[1],i=e.aabb.upperBound[0],r=e.aabb.upperBound[1];isFinite(n)&&isFinite(o)&&isFinite(i)&&isFinite(r)&&(t.push([n,o],[i,o],[i,r],[n,r]),this.drawConvex(t,this.COLOR_S,1,!1))},e.prototype.drawDistanceJoint=function(e){var t,n=new Array,o=new Array;t=e.distance,e.upperLimitEnabled&&e.upperLimit>t&&(t=e.upperLimit),e.bodyA.toWorldFrame(n,e.localAnchorA),e.bodyB.toWorldFrame(o,e.localAnchorB);var i=p2.vec2.subtract([],o,n);p2.vec2.normalize(i,i),p2.vec2.scale(i,i,t);var r=p2.vec2.add([],n,i);this.drawSegment(n,e.bodyA.position,this.COLOR_S),this.drawSegment(o,e.bodyB.position,this.COLOR_S),this.drawVecAt(i,n,this.COLOR_BLACK),e.position>t&&this.drawSegment(o,r,this.COLOR_RED),this.drawCircle(n,3/this.factor,this.COLOR_BLACK),this.drawCircle(r,3/this.factor,this.COLOR_BLACK),e.lowerLimitEnabled&&(p2.vec2.normalize(i,i),p2.vec2.scale(i,i,e.lowerLimit),r=p2.vec2.add([],n,i),this.drawCircle(r,2/this.factor,this.COLOR_BLACK))},e.prototype.drawRevoluteJoint=function(e){var t=new Array,n=new Array;e.bodyA.toWorldFrame(t,e.pivotA),e.bodyB.toWorldFrame(n,e.pivotB),this.drawSegment(e.bodyA.position,t,this.COLOR_S),this.drawSegment(e.bodyB.position,n,this.COLOR_S),this.drawSegment(t,n,this.COLOR_RED),this.drawCircle(t,3/this.factor,this.COLOR_BLACK)},e.prototype.drawGearJoint=function(e){var t=e.bodyA.position,n=e.bodyB.position,o=new Array,i=new Array;e.bodyA.toWorldFrame(o,[20/this.factor,0]),e.bodyB.toWorldFrame(i,[20/this.factor,0]);var r=p2.vec2.subtract([],t,o),s=p2.vec2.subtract([],n,i);this.drawVecAt(r,t,this.COLOR_BLACK,!0),this.drawVecAt(s,n,this.COLOR_BLACK,!0),e.bodyB.toWorldFrame(s,[10*(e.bodyB.angle-e.bodyA.angle-e.angle)/this.factor,0]),this.drawSegment(s,n,this.COLOR_RED)},e.prototype.drawPrismaticJoint=function(e){var t=(e.bodyA.position,e.bodyB.position,new Array),n=new Array;e.bodyA.toWorldFrame(t,e.localAnchorA),e.bodyB.toWorldFrame(n,e.localAnchorB);var o=new Array;o=this.toWorldVector(e.localAxisA,e.bodyA);var i=p2.vec2.copy([],o),r=p2.vec2.copy([],o);e.lowerLimitEnabled?p2.vec2.scale(i,o,e.lowerLimit):p2.vec2.scale(i,o,5e3),e.upperLimitEnabled?p2.vec2.scale(r,o,e.upperLimit):p2.vec2.scale(r,o,5e3),this.drawVecAt(i,t,this.COLOR_BLACK,!0),this.drawVecAt(r,t,this.COLOR_BLACK,!0),p2.vec2.add(i,i,t),this.drawCircle(i,2/this.factor,this.COLOR_BLACK,1,!0),p2.vec2.add(r,r,t),this.drawCircle(r,2/this.factor,this.COLOR_BLACK,1,!0)},e.prototype.drawLockJoint=function(e){var t=new Array;new Array;e.bodyA.toWorldFrame(t,e.localOffsetB),this.drawSegment(t,e.bodyA.position,this.COLOR_S),this.drawSegment(t,e.bodyB.position,this.COLOR_RED),this.drawCircle(t,3/this.factor,this.COLOR_BLACK);var n=new Array;e.bodyA.toWorldFrame(n,[20/this.factor,0]),this.drawSegment(n,e.bodyA.position,this.COLOR_BLACK),e.bodyB.toWorldFrame(n,[20/this.factor,0]),this.drawSegment(n,e.bodyB.position,this.COLOR_BLACK)},e.prototype.drawLinearSpring=function(e){var t=new Array,n=new Array;e.bodyA.toWorldFrame(t,e.localAnchorA),e.bodyB.toWorldFrame(n,e.localAnchorB);var o=p2.vec2.subtract([],n,t);p2.vec2.normalize(o,o),p2.vec2.scale(o,o,e.restLength);var i=p2.vec2.add([],e.bodyA.position,o);this.drawSegment(i,e.bodyB.position,this.COLOR_RED),this.drawVecAt(o,t,this.COLOR_BLACK),this.drawCircle(t,3/this.factor,this.COLOR_RED),this.drawCircle(i,3/this.factor,this.COLOR_RED)},e.prototype.drawRotationalSpring=function(e){var t=new Array,n=new Array;t=e.bodyA.position,n=e.bodyB.position;var o=new Array,i=new Array;e.bodyA.toWorldFrame(o,[20/this.factor,0]),e.bodyB.toWorldFrame(i,[10*(e.bodyB.angle-e.bodyA.angle-e.restAngle+2)/this.factor,0]);var r=p2.vec2.subtract([],o,t),s=p2.vec2.subtract([],i,n);this.drawVecAt(r,t,this.COLOR_RED,!0),this.drawVecAt(s,n,this.COLOR_RED,!0),e.bodyB.toWorldFrame(i,[20/this.factor,0]),this.drawCircle(o,2/this.factor,this.COLOR_RED),this.drawCircle(i,2/this.factor,this.COLOR_RED)},e.prototype.drawShape=function(e,t,n,o){var n=void 0==n?this.getColor(t):n,o=void 0==o?!0:o;e instanceof p2.Convex?this.drawConvexShape(e,t,n,o):e instanceof p2.Plane?this.drawPlaneShape(e,t,n,o):e instanceof p2.Circle?this.drawCircleShape(e,t,n,o):e instanceof p2.Capsule?this.drawCapsule(e,t,n):e instanceof p2.Particle?this.drawParticle(e,t,n):e instanceof p2.Line?this.drawLine(e,t,n):e instanceof p2.Heightfield&&this.drawHeightfeild(e,t,n)},e.prototype.drawConvexShape=function(e,t,n,o){var i=(t.shapes.indexOf(e),e.position),r=e.angle,s=[],a=this.transformVec(e.vertices[0],i,r);t.toWorldFrame(s,i),t.toWorldFrame(a,a),this.drawSegment(s,a,n);for(var l=new Array,p=e.vertices.length,h=0;p>h;h++)a=this.transformVec(e.vertices[h],i,r),t.toWorldFrame(a,a),l.push(a);this.drawConvex(l,n,.5,o)},e.prototype.drawParticle=function(e,t,n){this.drawCircle(t.position,1/this.factor,n,.5),this.drawCircle(t.position,5/this.factor,n,1,!1)},e.prototype.drawLine=function(e,t,n){var o=e.length,i=new Array,r=new Array;t.toWorldFrame(i,[-o/2,0]),t.toWorldFrame(r,[o/2,0]),this.drawSegment(i,r,n)},e.prototype.drawHeightfeild=function(e,t,n){var o=this.sprite.graphics;o.lineStyle(1,n),o.beginFill(n,.5);var i,r=e.heights,s=e.elementWidth,a=new Array,l=new Array;r.forEach(function(e,n){i=n*s,a=new Array,t.toWorldFrame(a,[i,e]),l.push(a)}),a=new Array,t.toWorldFrame(a,[i,-500]),l.push(a),a=new Array,t.toWorldFrame(a,[0,-500]),l.push(a),a=new Array,t.toWorldFrame(a,[0,0]),l.push(a),this.drawConvex(l,n,.5)},e.prototype.drawCapsule=function(e,t,n){var o=e.length,i=e.radius,r=new Array,s=new Array,a=new Array,l=new Array,p=new Array,h=new Array;t.toWorldFrame(r,[-o/2,-i]),t.toWorldFrame(s,[o/2,-i]),t.toWorldFrame(a,[o/2,i]),t.toWorldFrame(l,[-o/2,i]),t.toWorldFrame(p,[o/2,0]),t.toWorldFrame(h,[-o/2,0]),this.drawCircle(p,i,n,.5),this.drawCircle(h,i,n,.5),this.drawConvex([r,s,a,l],n,.5)},e.prototype.drawCircleShape=function(e,t,n,o){var i=e.position,r=e.angle,s=new Array;t.toWorldFrame(s,i),this.drawCircle(s,e.radius,n,.5,o);var a=this.transformVec([e.radius,0],i,r);t.toWorldFrame(a,a),this.drawSegment(s,a,n)},e.prototype.drawPlaneShape=function(e,t,n,o){var i=new Array,r=new Array;t.shapes.indexOf(e);t.toWorldFrame(i,[1e3,0]),i=this.transformVec(i,e.position,e.angle),r.push(i),i=new Array,t.toWorldFrame(i,[1e3,-1e5]),i=this.transformVec(i,e.position,e.angle),r.push(i),i=new Array,t.toWorldFrame(i,[-1e3,-1e5]),i=this.transformVec(i,e.position,e.angle),r.push(i),i=new Array,t.toWorldFrame(i,[-1e3,0]),i=this.transformVec(i,e.position,e.angle),r.push(i),this.drawConvex(r,n,.5,o)},e.prototype.getColor=function(e){var t=this.COLOR_D_SLEEP;return e.type==p2.Body.KINEMATIC?t=this.COLOR_K:e.type==p2.Body.STATIC?t=this.COLOR_S:e.sleepState==p2.Body.AWAKE&&(t=this.COLOR_D_WAKE),t},e.prototype.drawVecAt=function(e,t,n,o){void 0===o&&(o=!1);var i=p2.vec2.copy([],t),r=p2.vec2.add([],e,t);o&&this.drawCircle(i,3/this.factor,n),this.drawSegment(i,r,n)},e.prototype.drawVecTo=function(e,t,n,o){void 0===o&&(o=!1);var i=p2.vec2.copy([],t),r=p2.vec2.subtract([],t,e);o&&this.drawCircle(i,3/this.factor,n),this.drawSegment(i,r,n)},e.prototype.drawSegment=function(e,t,n){this.sprite.graphics.lineStyle(3,n),this.sprite.graphics.moveTo(e[0]*this.factor,e[1]*this.factor),this.sprite.graphics.lineTo(t[0]*this.factor,t[1]*this.factor)},e.prototype.drawCircle=function(e,t,n,o,i){void 0===o&&(o=1),this.sprite.graphics.lineStyle(1,n),(i||void 0==i)&&this.sprite.graphics.beginFill(n,o),this.sprite.graphics.drawCircle(e[0]*this.factor,e[1]*this.factor,t*this.factor),this.sprite.graphics.endFill()},e.prototype.drawConvex=function(e,t,n,o){void 0===n&&(n=1),void 0===o&&(o=!0),this.sprite.graphics.lineStyle(1,t),o&&this.sprite.graphics.beginFill(t,n);var i=e.length,r=e[0];this.sprite.graphics.moveTo(r[0]*this.factor,r[1]*this.factor);for(var s=1;i>=s;s++)r=e[s%i],this.sprite.graphics.lineTo(r[0]*this.factor,r[1]*this.factor);this.sprite.graphics.endFill()},e.prototype.toWorldVector=function(e,t){var n=new Array;return p2.vec2.rotate(n,e,t.angle),n},e.prototype.transformVec=function(e,t,n){var o=new Array;return p2.vec2.rotate(o,e,n),p2.vec2.add(o,o,t),o},e.prototype.drawDotLine=function(e,t,n,o){if(void 0===t&&(t=0),void 0===n&&(n=!1),void 0===o&&(o=50),!(e.length<2)){var i=2/this.factor,r=[];p2.vec2.copy(r,e[0]),this.drawCircle(r,i,t,1,!1);for(var s=0;s<e.length-2;s++){var a=e[s];if(n)for(var l=p2.vec2.distance(r,a);l>o/this.factor;){var p=[];p2.vec2.subtract(p,a,r),p2.vec2.scale(p,p,o/this.factor/l),p2.vec2.add(r,r,p),this.drawCircle(r,i,t,1,!1),l=p2.vec2.distance(r,a)}else this.drawCircle(a,i,t,1,!1)}}},e}();__reflect(p2DebugDraw.prototype,"p2DebugDraw");var P2World=function(){function e(){this.isRun=!1,this.bodyPool=new ObjectPool,this.removeBodys=[],this.removeConstraints=[],this.isTestBall=!1,e.Instance=this,this.world=new p2.World,this.world.gravity=[0,10],this.world.sleepMode=p2.World.BODY_SLEEPING,this.world.defaultContactMaterial.friction=2,this.itemMat=new p2.Material(1e3),this.boomMat=new p2.Material(1010);var t=new p2.ContactMaterial(this.itemMat,this.boomMat,{stiffness:700});this.world.addContactMaterial(t);var n=this.getBody();n.flag="UpperTerrain",n.type=p2.Body.STATIC,n.position[0]=this.d2pX(.5*App.MainSprite.width),n.position[1]=this.d2pY(-250);var o=new p2.Box({width:1.5*App.MainSprite.width*e.d2pFactor,height:300*e.d2pFactor});o.collisionGroup=e.TERRAIN_GROUP,o.collisionMask=e.TERRAIN_MASK,n.addShape(o),this.addBody(n)}return e.prototype.run=function(){1!=this.isRun&&(this.isRun=!0)},e.prototype.stop=function(){0!=this.isRun&&(this.isRun=!1)},e.prototype.update=function(e){0!=this.isRun&&(this.updateRemoveConstraint(),this.updateRemoveBody(),this.updateOutBounds(),this.world.step(1.3*Timer.tick/1e3),null!=this.debugDraw&&this.debugDraw.drawDebug())},e.prototype.getBody=function(t){void 0===t&&(t="");var n=this.bodyPool.popObj();return null==n&&(n=new p2.Body,n.id>e.MAX_BODY_WARNNING_COUNT&&console.log("===MAX_BODY_WARNNING_COUNT=="+n.id)),n.fixedX=n.fixedY=n.fixedRotation=!1,n.sleepState=p2.Body.AWAKE,n.gravityScale=1,n.velocity[0]=n.velocity[1]=0,n.force[0]=n.force[1]=0,n.angle=0,n.angularVelocity=0,n.flag=t,n},e.prototype.recoverBody=function(e){for(;e.shapes.length>0;)e.removeShape(e.shapes[e.shapes.length-1]);null!=e.displays&&e.displays.splice(0),e.mass=0,e.damping=.1,e.angularDamping=.1,e.fixedX=!1,e.fixedY=!1,e.fixedRotation=!1,e.type=p2.Body.STATIC,e.gravityScale=1,e.velocity[0]=e.velocity[1]=0,e.force[0]=e.force[1]=0,e.angle=0,e.angularVelocity=0,this.bodyPool.pushObj(e)},e.prototype.addBody=function(e){if(null!=e){var t=this.removeBodys.indexOf(e);t>=0&&this.removeBodys.splice(t,1),this.world.addBody(e)}},e.prototype.removeBody=function(e){if(null!=e&&this.removeBodys.indexOf(e)<0){this.removeBodys.push(e);for(var t=0;t<this.world.constraints.length;t++)(this.world.constraints[t].bodyA==e||this.world.constraints[t].bodyB==e)&&this.removeConstraint(this.world.constraints[t])}},e.prototype.updateRemoveBody=function(){for(var e,t=0;t<this.removeBodys.length;t++)e=this.removeBodys[t],this.world.removeBody(e),this.recoverBody(e);this.removeBodys.splice(0)},e.prototype.removeAllBody=function(){for(;this.world.bodies.length>0;)this.world.removeBody(this.world.bodies[this.world.bodies.length-1]);this.removeBodys.splice(0)},e.prototype.addConstraint=function(e){var t=this.removeConstraints.indexOf(e);t>=0&&this.removeConstraints.splice(t,1),this.world.addConstraint(e)},e.prototype.removeConstraint=function(e){this.removeConstraints.indexOf(e)<0&&this.removeConstraints.push(e)},e.prototype.updateRemoveConstraint=function(){for(var e,t=0;t<this.removeConstraints.length;t++)e=this.removeConstraints[t],this.world.removeConstraint(e);this.removeConstraints.splice(0)},e.prototype.removeAllConstraints=function(){for(;this.world.constraints.length>0;)this.world.removeConstraint(this.world.constraints[this.world.constraints.length-1]);this.removeConstraints.splice(0)},e.prototype.updateOutBounds=function(){for(var e,t,n=GameMap.Instance.width,o=GameMap.Instance.height,i=this.world.bodies.length,r=0;i>r;r++){var s=this.world.bodies[r];e=this.p2dX(s.position[0]),-n>e||e>2*n?this.removeBody(s):(t=this.p2dY(s.position[1]),(-n>t||t>2*o)&&this.removeBody(s))}},e.prototype.updateDisplay=function(){for(var e,t,n=(GameMap.Instance.width,GameMap.Instance.height,this.world.bodies.length),o=0;n>o;o++){var i=this.world.bodies[o];if(!(null==i.displays||i.displays.length<=0)){var r=i.displays[0];r&&(r.x=e,r.y=t,r.rotation=360-180*(i.angle+i.shapes[0].angle)/Math.PI)}}},e.prototype.d2pX=function(t){return t*e.d2pFactor},e.prototype.d2pY=function(t){return t*e.d2pFactor},e.prototype.p2dX=function(t){return t*e.p2dFactor},e.prototype.p2dY=function(t){return t*e.p2dFactor},e.prototype.openDebug=function(){this.debugSpr=new egret.Sprite,GameMap.Instance.addChild(this.debugSpr),this.debugDraw=new p2DebugDraw(this.world,this.debugSpr),document.addEventListener("keydown",function(t){e.Instance.isTestBall=!0}),document.addEventListener("keyup",function(t){e.Instance.isTestBall=!1}),GameMap.Instance.stage.addEventListener(egret.TouchEvent.TOUCH_TAP,this.testBall,this)},e.prototype.testBall=function(e){0==this.isTestBall},e.MAX_BODY_WARNNING_COUNT=100,e.TERRAIN_GROUP=Math.pow(2,1),e.BULLET_GROUP=Math.pow(2,2),e.ITEM_GROUP=Math.pow(2,3),e.BODY_GROUP=Math.pow(2,5),e.BOOM_GROUP=Math.pow(2,6),e.TERRAIN_MASK=e.BULLET_GROUP|e.ITEM_GROUP|e.BODY_GROUP,e.BULLET_MASK=e.TERRAIN_GROUP|e.ITEM_GROUP|e.BODY_GROUP,e.ITEM_MASK=e.TERRAIN_GROUP|e.ITEM_GROUP|e.BULLET_GROUP|e.BODY_GROUP|e.BOOM_GROUP,e.LINE_MASK=0,e.BODY_MASK=e.TERRAIN_GROUP|e.ITEM_GROUP|e.BULLET_GROUP|e.BOOM_GROUP,e.BOOM_MASK=e.ITEM_MASK|e.BODY_MASK,e.p2dFactor=50,e.d2pFactor=.02,e}();__reflect(P2World.prototype,"P2World");var SceneManager=function(){function e(){this.deadEnemy=0,this.isSuccess=!1,this.isLastTime=!1,this.isRun=!1,e.Instance=this,App.ViewLayerManager.getLayer(EViewLayer.MAP).addChild(new GameMap),App.ViewLayerManager.getLayer(EViewLayer.MAP).addChild(new OperationPanel),new SkinData,new P2World,new CollisionEventManager,new AnimManager,new RoleManager,new BulletManager,new LevelElementManager,this.gameLevelCtrl=new GameLevelController,App.registerUpdater(this.update,this)}return e.prototype.update=function(e){P2World.Instance.update(e),GameMap.Instance.update(e),RoleManager.Instance.update(e),BulletManager.Instance.update(e),LevelElementManager.Instance.update(e)},e.prototype.enterLevel=function(t){this.isRun=!0,e.Instance.deadEnemy=0,GameMap.Instance.setLevel(t)},e.prototype.clear=function(){LevelElementManager.Instance.clear(),RoleManager.Instance.removeAllEnemy()},e.prototype.judgeGame=function(){if(1!=e.Instance.isSuccess){if(e.Instance.deadEnemy==RoleManager.Instance.enemys.length&&0!=RoleManager.Instance.enemys.length)return e.Instance.isSuccess=!0,App.Timer.doTimer(2e3,1,this.onSuccess,this),App.Timer.remove(this.lastJudge,this),Timer.slow(2e3,.2),void GameMap.Instance.dark(.6,1500);if(1!=e.Instance.isLastTime&&0!=this.isRun){var t=BulletManager.Instance.bulletUseNum,n=BulletManager.Instance.bulletNum;return t==n||0==RoleManager.Instance.enemys.length&&t==n?(this.isLastTime=!0,void App.Timer.doTimer(500,6,this.lastJudge,this,this.onFailed,this)):void 0}}},e.prototype.lastJudge=function(){this.isSuccess||(1==LevelElementManager.Instance.judgeSleep()&&this.onFailed(),this.judgeGame())},e.prototype.onSuccess=function(){this.isRun=!1,this.isSuccess=!1,this.isLastTime=!1,App.ViewManager.open(EViewID.SUCCESS_VIEW),platform.recordStop(),App.ControllerManager.applyFunc(EControllerID.GAME,EGameMessage.GAME_OVER)},e.prototype.onFailed=function(){this.isRun=!1,this.isLastTime=!1,App.Timer.remove(this.lastJudge,this),platform.recordStop(),App.ViewManager.open(EViewID.GAME_FAIL_VIEW)},e}();__reflect(SceneManager.prototype,"SceneManager");var SkinData=function(){function e(){e.Instance=this,this.skinData=RES.getRes("skin_json")}return e.prototype.getRoleSkinData=function(e){return this.skinData.role[e]},e.prototype.getGunSkinData=function(e){return this.skinData.gun[e]},e}();__reflect(SkinData.prototype,"SkinData");var App=function(){function e(){}return e.initConfigure=function(t){e.GlobalConfigure.register(t),e.Http.init()},e.init=function(t){e.mainSprite=t},Object.defineProperty(e,"Http",{get:function(){return HttpSystem.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"DebugUtils",{get:function(){return DebugUtils.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"Timer",{get:function(){return TimerManager.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"Sound",{get:function(){return SoundManager.getInstance()},enumerable:!0,configurable:!0}),e.mergeSort=function(e){var t=e.length;if(2>t)return e;var n=Math.floor(t/2),o=e.slice(0,n),i=e.slice(n);return this.merge(this.mergeSort(o),this.mergeSort(i))},e.merge=function(e,t){for(var n=[];e.length&&t.length;)e[0]<=t[0]?n.push(e.shift()):n.push(t.shift());for(;e.length;)n.push(e.shift());for(;t.length;)n.push(t.shift());return n},Object.defineProperty(e,"ArrayUtils",{get:function(){return ArrayUtils.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"DateUtils",{get:function(){return DateUtils.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"DeviceUtils",{get:function(){return DeviceUtils.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"MathUtils",{get:function(){return MathUtils.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"RandomUtils",{get:function(){return RandomUtils.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"EffectUtils",{get:function(){return EffectUtils.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"Dispacher",{get:function(){return GlobalDispatcher.Instance},enumerable:!0,configurable:!0}),Object.defineProperty(e,"GlobalConfigure",{get:function(){return GlobalConfigure.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ControllerManager",{get:function(){return ControllerManager.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"DisplayUtils",{get:function(){return DisplayUtils.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ViewManager",{get:function(){return ViewManager.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ViewLayerManager",{get:function(){return ViewLayerManager.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"PopUpUtils",{get:function(){return PopUpUtils.getInstance()},enumerable:!0,configurable:!0}),e.onPause=function(){egret.ticker.pause(),Timer.Pause(),e.Sound.bgPause()},e.onResume=function(){egret.ticker.resume(),Timer.Resume(),e.Sound.bgResume()},Object.defineProperty(e,"MainSprite",{get:function(){return e.mainSprite},enumerable:!0,configurable:!0}),e.registerUpdater=function(t,n){(null==t||null==n)&&console.error("register update failed."),e.updaters.push(t),e.updaterObjects.push(n)},e.unregisterUpdater=function(t,n){(null==t||null==n)&&console.error("unregister update failed.");var o=e.updaters.indexOf(t);return 0>o?void console.error("can't found index on unregister update."):(e.updaters.splice(o,1),void e.updaterObjects.splice(o,1))},e.registerLateUpdate=function(t,n){(null==t||null==n)&&console.error("register late update failed."),e.lateUpdaters.push(t),e.lateUpdaterObjects.push(n)},e.doFrame=function(t){e.Http.doFrame();for(var n=e.updaters.length-1;n>=0;--n)e.updaters[n].apply(e.updaterObjects[n],[t]);for(var o=e.lateUpdaters.length,n=0;o>n;++n)e.lateUpdaters[n].apply(e.lateUpdaterObjects[n],[t])},e.vibrateShort=function(){var t="1"==e.GlobalConfigure.loadLocalData("openAudio","1");1==t&&window.platform.vibrateShort()},e.sleep=function(e){var t=this;return new Promise(function(n,o){var i=new egret.Timer(e,1);i.addEventListener(egret.TimerEvent.TIMER_COMPLETE,function(){n()},t),i.start()})},e.SafeMode=!0,e.appVersion="",e.isAutoSetting=!0,e.bNewPlayer=0,e.updaters=new Array,e.updaterObjects=new Array,e.lateUpdaters=new Array,e.lateUpdaterObjects=new Array,e}();__reflect(App.prototype,"App");var AnimManager=function(){function e(){this.animFactoryTab={},this.displayPools={},e.Instance=this,this.skinAtlas=RES.getRes("allRoleTex_tex_png"),this.skinAtlasData=RES.getRes("allRoleTex_tex_json")}return e.prototype.getDBFactory=function(e){var t=this.animFactoryTab[e];if(null==t){var n=RES.getRes(e);null!=n&&(t=new dragonBones.EgretFactory,t.parseDragonBonesData(n,e),t.parseTextureAtlasData(this.skinAtlasData,this.skinAtlas,e),this.animFactoryTab[e]=t)}return t},e.prototype.recoverArmature=function(e,t,n){n.dispose()},e.bone_trunk="trunk",e.bone_head="head",e.bone_la="la",e.bone_la0="la0",e.bone_la1="la1",e.bone_ra="ra",e.bone_ra0="ra0",e.bone_ra1="ra1",e.bone_ll="ll",e.bone_ll0="ll0",e.bone_ll1="ll1",e.bone_rl="rl",e.bone_rl0="rl0",e.bone_rl1="rl1",e.slot_trunk="trunk",e.slot_head="head",e.slot_la="la",e.slot_la0="la0",e.slot_la1="la1",e.slot_ra="ra",e.slot_ra0="ra0",e.slot_ra1="ra1",e.slot_ll="ll",e.slot_ll0="ll0",e.slot_ll1="ll1",e.slot_rl="rl",e.slot_rl0="rl0",e.slot_rl1="rl1",e.slot_mouth="mouth",e.slot_gun="gun",e.slotArr=[e.slot_trunk,e.slot_head,e.slot_la,e.slot_la0,e.slot_la1,e.slot_ra,e.slot_ra0,e.slot_ra1,e.slot_ll,e.slot_ll0,e.slot_ll1,e.slot_rl,e.slot_rl0,e.slot_rl1,e.slot_mouth],e}();__reflect(AnimManager.prototype,"AnimManager");var EnemyAnim=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.update=function(){null==this.display},t.prototype.idel=function(){this.display.animation.fadeIn("idel",.1,-1)},t.prototype.scare=function(){this.display.animation.fadeIn("scare1",.1,-1)},t.prototype.cheer=function(){var e=RandomUtils.getInstance().limitInteger(1,3);this.display.animation.fadeIn("cheer"+e,.5,-1)},t.prototype.rag=function(){this.display.animation.play("rag")},t}(Anim);__reflect(EnemyAnim.prototype,"EnemyAnim");var PlayerAnim=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.isAim=!1,t.fireState=null,t.aimState=null,t.faceDir=1,t.aimDir=0,t.aimR=0,t.tp=new egret.Point,t}return __extends(t,e),t.prototype.update=function(){null!=this.display&&this.updateAim()},t.prototype.clearAnimState=function(){null!=this.aimState&&(this.aimState.weight=0),null!=this.fireState&&(this.fireState.weight=0),this.aimDir=0},t.prototype.changeGunEnd=function(){this.idel()},t.prototype.changeGun=function(){this.display.animation.fadeIn("changegun",.1,1),App.Timer.doTimer(870,1,this.changeGunEnd,this)},t.prototype.playerCheer=function(){var e=App.RandomUtils.limitInteger(0,6);this.display.animation.fadeIn("cheer"+e,.1,-1)},t.prototype.idel=function(){this.isAim=!1,this.display.animation.fadeIn("idel",-1,-1,0,t.NORMAL_ANIMATION_GROUP,4)},t.prototype.aim=function(){this.isAim=!0,this.display.animation.fadeIn("aimhor",-1,-1,0,t.NORMAL_ANIMATION_GROUP,2),this.updateAim()},t.prototype.fire=function(){this.display.animation.fadeIn("attackhor",.01,1,0,t.NORMAL_ANIMATION_GROUP,2),this.aimDir>=0?this.fireState=this.display.animation.fadeIn("attackup",.01,1,0,t.AIM_ANIMATION_GROUP,2):this.fireState=this.display.animation.fadeIn("attackdown",.01,1,0,t.AIM_ANIMATION_GROUP,2);var e=this.aimR/Math.PI*2;this.fireState.weight=Math.abs(e),App.Timer.doTimer(200,1,this.fireEnd,this)},t.prototype.fireEnd=function(){this.aimDir*=-1,this.aim()},t.prototype.updateAim=function(){if(0!=this.isAim&&0!=this.aimDir){var e=PlayerObj.Instance.target,n=PlayerObj.Instance.gunPos,o=PlayerObj.Instance.firePos,i=PlayerObj.Instance.fireDir;this.faceDir=e.x>this.display.x?1:-1,this.display.scaleX*this.faceDir<0&&(this.display.scaleX*=-1);var r=this.display.armature.getBone("gun"),s=this.display.x+r.global.x*this.display.scaleX,a=this.display.y+r.global.y*this.display.scaleY;n.x=s,n.y=a;var l=e.x-s,p=e.y-a,h=Math.sqrt(l*l+p*p);i.x=l/h,i.y=p/h,o.x=s+i.x*PlayerObj.Instance.gunData.len,o.y=a+i.y*PlayerObj.Instance.gunData.len,PlayerObj.Instance.aimR=this.aimR=Math.atan2(e.y-a,e.x-s),OperationPanel.Instance.updateRay(o.x,o.y,180*this.aimR/Math.PI),this.faceDir>0||(this.aimR=Math.PI-Math.atan2(p,l),this.aimR>Math.PI&&(this.aimR-=2*Math.PI));var c=0;c=this.aimR>0?-1:1,this.aimDir!=c&&(this.aimDir=c,this.aimDir>=0?this.aimState=this.display.animation.fadeIn("aimup",.05,1,0,t.AIM_ANIMATION_GROUP,2):this.aimState=this.display.animation.fadeIn("aimdown",.05,1,0,t.AIM_ANIMATION_GROUP,2));var u=this.aimR/Math.PI*2;this.aimState.weight=Math.abs(u)}},t.prototype.onComplete=function(e){0==e.animationState.name.indexOf("cheer")&&this.idel()},t.NORMAL_ANIMATION_GROUP="normal",t.AIM_ANIMATION_GROUP="aim",t.ATTACK_ANIMATION_GROUP="attack",t}(Anim);__reflect(PlayerAnim.prototype,"PlayerAnim");var Bullet=function(e){function t(){var t=e.call(this)||this;return t.dir=new egret.Point,t.speed=1.8,t.isTrail=!1,t.trailSpeed=15,t.p2do=[0,0],t}return __extends(t,e),t.prototype.init=function(e,t,n,o,i,r,s,a,l){void 0===a&&(a=!1),void 0===l&&(l=null),this.source=e,this.dir.copyFrom(r),this.width=t,this.height=n,this.anchorOffsetX=.5*t,this.x=o,this.y=i,this.rotation=180*s/Math.PI+90,GameMap.Instance.effectLayer.addChild(this),this.body=P2World.Instance.getBody("Bullet"),this.body.type=p2.Body.DYNAMIC,this.body.mass=.5,this.body.angle=s,this.body.gravityScale=0;var p=3*t,h=t;this.p2do[0]=.5*(p-t)*P2World.d2pFactor,this.p2do[1]=0,this.shap=new p2.Box({width:p*P2World.d2pFactor,height:h*P2World.d2pFactor}),this.shap.collisionGroup=P2World.BULLET_GROUP,this.shap.collisionMask=P2World.BULLET_MASK,this.body.addShape(this.shap),this.body.position[0]=P2World.Instance.d2pX(o),this.body.position[1]=P2World.Instance.d2pY(i),this.body.velocity[0]=1e3*P2World.Instance.d2pX(this.dir.x)*this.speed,this.body.velocity[1]=1e3*P2World.Instance.d2pY(this.dir.y)*this.speed,P2World.Instance.addBody(this.body),this.isTrail=a,this.isTrail&&(this.scale9Grid=l),BeginContactEvent.Instance.on(this.body.id,this.onBeginContact,this)},t.prototype.clear=function(){BeginContactEvent.Instance.off(this.body.id),this.scale9Grid=null,GameMap.Instance.effectLayer.removeChild(this),P2World.Instance.removeBody(this.body),this.body=null},t.prototype.update=function(){this.updatePos()},t.prototype.updatePos=function(){var e=this.checkOuBounds();return 1==e?void BulletManager.Instance.removeBullet(this):(this.body.toWorldFrame(t.tmp,this.p2do),this.x=P2World.Instance.p2dX(t.tmp[0]),this.y=P2World.Instance.p2dY(t.tmp[1]),void(1==this.isTrail&&this.height<300&&(this.height+=this.trailSpeed*Timer.scale)))},t.prototype.checkOuBounds=function(){var e=GameMap.Instance.width,t=GameMap.Instance.height;return this.x<-300||this.x>e+300?!0:this.y<-300||this.y>t+300?!0:!1},t.prototype.onBeginContact=function(e){var t=e.bodyA,n=e.bodyB,o=this.body.id==t.id?n:t;o.shapes[0].collisionGroup==P2World.TERRAIN_GROUP&&App.Sound.playEffect("hitrock.mp3",.5),BulletManager.Instance.removeBullet(this)},t.tmp=[0,0],t}(eui.Image);__reflect(Bullet.prototype,"Bullet");var BulletManager=function(){function e(){this.pool=new ObjectPool,this.bullets=[],this.removes=[],this.bulletNum=0,this.bulletUseNum=0,e.Instance=this}return e.prototype.addBullet=function(e,t,n,o,i,r,s,a,l){void 0===a&&(a=!1),void 0===l&&(l=null);var p=this.pool.popObj();return null==p&&(p=new Bullet),p.init(e,t,n,o,i,r,s,a,l),this.bullets.push(p),p},e.prototype.removeBullet=function(e){this.removes.indexOf(e)<0&&(this.removes.push(e),SceneManager.Instance.judgeGame())},e.prototype.update=function(e){this.updateRemove();for(var t=0;t<this.bullets.length;t++)this.bullets[t].update()},e.prototype.updateRemove=function(){for(var e,t,n=0;n<this.removes.length;n++)e=this.removes[n],t=this.bullets.indexOf(e),e.clear(),this.bullets.splice(t,1),this.pool.pushObj(e);this.removes.splice(0)},e}();__reflect(BulletManager.prototype,"BulletManager");var BeginContactEvent=function(e){function t(){var n=e.call(this)||this;return P2World.Instance.world.on("beginContact",n.onWorldBeginContact,n),t.Instance=n,n}return __extends(t,e),t.prototype.onWorldBeginContact=function(e){var t=e.bodyA,n=e.bodyB,o=this.arr[t.id];if(null==o)return void console.log("onWorldBeginContact item is null id = "+t.id);if(t.shapes[0].collisionGroup!=P2World.BULLET_GROUP&&n.shapes[0].collisionGroup!=P2World.BULLET_GROUP){null!=o.func&&o.func.apply(o.target,[e]);
var i=this.arr[n.id];null!=i.func&&i.func.apply(i.target,[e])}else if(t.shapes[0].collisionGroup==P2World.BULLET_GROUP){var r=this.arr[n.id];null!=r.func&&r.func.apply(r.target,[e]),null!=o.func&&o.func.apply(o.target,[e])}else{null!=o.func&&o.func.apply(o.target,[e]);var s=this.arr[n.id];null!=s.func&&s.func.apply(s.target,[e])}},t}(CollisionEventBase);__reflect(BeginContactEvent.prototype,"BeginContactEvent");var CollisionEventManager=function(){function e(){e.Instance=this,new BeginContactEvent}return e}();__reflect(CollisionEventManager.prototype,"CollisionEventManager");var BloodEjection=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.pet=0,t.est=0,t.net=0,t.isM=1,t.addParticle=!1,t}return __extends(t,e),t.prototype.update=function(){var e=Timer.nowTime,t=e-this.spt,n=e-this.pft;if(t>this.dur)return null!=this.endFunc&&this.endFunc.apply(this.endTarget,[this]),void EffectController.Instance.bloodEjection.removeEjection(this);var o=MCEffectController.Instance.getTexture(this.resName+this.index.toString());null!=o&&(this.texture=o);var i=.05*this.dur,r=.1*this.dur,s=this.dur-r;if(t>=0&&i>t?this.cs=t/i:t>s?this.cs=1-(t-s)/r:this.cs=1,this.scaleX=this.cs*this.s,this.scaleY=this.cs*this.s*this.isM,n>60&&(this.pft=e,this.index++,this.index>=this.totleFc&&(this.index=RandomUtils.getInstance().limitInteger(0,5),this.isM*=-1)),this.addParticle){var a=e-this.pet;a>this.net&&(this.pet=e,this.net=this.est*(.5+.5*Math.random()),EffectController.Instance.bloodEjection.play(this.x,this.y,this.rotation/180*Math.PI,.2,1,1,.5))}},t}(MCEffectItem);__reflect(BloodEjection.prototype,"BloodEjection");var BloodFly2=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.update=function(){var e=Timer.nowTime,t=e-this.st;if(t>this.dur)return void(this.visible=!1);var n=t/this.dur;n=egret.Ease.quadOut(n),this.scaleX=this.scaleY=this.s,this.alpha=1-n,this.x+=this.vx*Timer.tick,this.vy+=.0015*Timer.tick,this.y+=this.vy*Timer.tick},t}(egret.Bitmap);__reflect(BloodFly2.prototype,"BloodFly2");var BloodEjectionSystem=function(e){function t(){var t=e.call(this,BloodFly2,["blood1"],40)||this;return t.pool=new ObjectPool,t.beArr=[],t.beRemoveArr=[],t}return __extends(t,e),t.prototype.itemRes=function(){var e=this.res[this.ri];return this.ri++,this.ri>=this.res.length&&(this.ri=0),e},t.prototype.addEjection=function(e,t,n){void 0===e&&(e=null),void 0===t&&(t=null),void 0===n&&(n=!1);var o=this.pool.popObj();return null==o&&(o=new BloodEjection,GameMap.Instance.effectLayer.addChild(o)),o.addParticle=n,o.width=102,o.height=47,o.anchorOffsetX=22,o.anchorOffsetY=24,o.spt=Timer.nowTime,o.pft=o.spt,o.resName="be",o.totleFc=6,o.index=0,o.dur=2e3+2e3*Math.random(),o.endFunc=e,o.endTarget=t,o.est=50,o.visible=!0,this.beArr.push(o),o},t.prototype.removeAll=function(){for(var e=0;e<this.beArr.length;e++)this.removeEjection(this.beArr[e])},t.prototype.removeEjection=function(e){this.beRemoveArr.indexOf(e)>=0||this.beRemoveArr.push(e)},t.prototype.play=function(e,t,n,o,i,r,s,a){void 0===o&&(o=.5),void 0===i&&(i=1),void 0===r&&(r=.3),void 0===s&&(s=.1),void 0===a&&(a=800);for(var l,p=0;i>p;p++){l=this.getItem();var h=RandomUtils.getInstance().limit(-o,o);h+=n;var c=.3+.7*Math.random();r*=c;var u=Math.cos(h)*r,d=Math.sin(h)*r;l.s=s*(1.5-c),l.vx=u,l.vy=d,l.x=e,l.y=t,l.st=Timer.nowTime,l.dur=a*(1+.5*Math.random()),l.visible=!0}},t.prototype.updateBeRemove=function(){for(var e,t=0;t<this.beRemoveArr.length;t++)this.beRemoveArr[t].visible=!1,this.beRemoveArr[t].endFunc=null,this.beRemoveArr[t].endTarget=null,this.pool.pushObj(this.beRemoveArr[t]),e=this.beArr.indexOf(this.beRemoveArr[t]),e>=0&&this.beArr.splice(e,1);this.beRemoveArr.splice(0)},t.prototype.update=function(){e.prototype.update.call(this),this.updateBeRemove();for(var t=0;t<this.beArr.length;t++)this.beArr[t].update()},t}(EffectSystem);__reflect(BloodEjectionSystem.prototype,"BloodEjectionSystem");var BloodFly=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.update=function(){var e=Timer.nowTime,t=e-this.st;if(t>this.dur)return void(this.visible=!1);var n=t/this.dur;n=egret.Ease.quadOut(n),this.scaleX=this.s*(1+8*(1-n)),this.scaleY=this.s,this.x=this.fx+n*(this.tx-this.fx),this.y=this.fy+n*(this.ty-this.fy)},t}(egret.Bitmap);__reflect(BloodFly.prototype,"BloodFly");var BloodFlySystem=function(e){function t(){return e.call(this,BloodFly,["blood0","blood1"],10)||this}return __extends(t,e),t.prototype.itemRes=function(){var e=this.res[this.ri];return this.ri++,this.ri>=this.res.length&&(this.ri=0),e},t.prototype.play=function(e,t,n,o,i,r){void 0===n&&(n=8),void 0===o&&(o=150),void 0===i&&(i=.4),void 0===r&&(r=350);for(var s,a=0;n>a;a++){s=this.getItem();var l=RandomUtils.getInstance().limit(0,2)*Math.PI,p=Math.cos(l)*o,h=Math.sin(l)*o,c=e+.2*p*Math.random(),u=t+.2*h*Math.random(),d=e+p*(.8*Math.random()+1),y=t+h*(.8*Math.random()+1);s.x=c,s.y=u,s.rotation=180*l/Math.PI,s.st=Timer.nowTime,s.fx=c,s.fy=u,s.tx=d,s.ty=y,s.s=i,s.dur=r*(1+.5*Math.random()),s.visible=!0}},t}(EffectSystem);__reflect(BloodFlySystem.prototype,"BloodFlySystem");var BulletCase=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.vx=0,t.vy=0,t}return __extends(t,e),t.prototype.update=function(){var e=Timer.nowTime,t=e-this.st;if(t>this.dur)return void(this.visible=!1);var n=t/this.dur;n=egret.Ease.quartIn(n),this.alpha=1-n,this.x+=this.vx*Timer.tick,this.vy+=.0015*Timer.tick,this.y+=this.vy*Timer.tick,this.rotation+=10},t}(egret.Bitmap);__reflect(BulletCase.prototype,"BulletCase");var BulletCaseSystem=function(e){function t(){return e.call(this,BulletCase,"bulletshell",5)||this}return __extends(t,e),t.prototype.play=function(e,t,n,o){void 0===o&&(o=1500);var i;i=this.getItem(),i.x=e,i.y=t,i.rotation=0,i.st=Timer.nowTime,i.dur=o*(.5+Math.random()),i.visible=!0;var r=.3+.3*Math.random();i.vx=r*-n.x,i.vy=r*-n.y},t}(EffectSystem);__reflect(BulletCaseSystem.prototype,"BulletCaseSystem");var DeadWordEffect=function(){function e(){e.Instance=this,this.pool=new ObjectPool}return e.prototype.playEffect=function(t,n){var o=this.pool.popObj();null==o&&(o=new egret.Bitmap),"bullet"==t?o.texture=RES.getRes("deadword1"):"boom"==t?o.texture=RES.getRes("deadword"):"other"==t&&(o.texture=RES.getRes("deadword2")),o.x=n.x-n.width,o.y=n.y-n.height,o.alpha=1;var i=o.y;GameMap.Instance.effectLayer.addChild(o),egret.Tween.get(o).to({y:i-100,alpha:0},800).call(function(){GameMap.Instance.effectLayer.removeChild(o),e.Instance.pool.pushObj(o)})},e}();__reflect(DeadWordEffect.prototype,"DeadWordEffect");var DustFloat=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.disIn=!0,t}return __extends(t,e),t.prototype.update=function(){var e=Timer.nowTime,t=e-this.st;if(t>this.dur+this.startDur)return void(this.visible=!1);var n;t<this.startDur?(n=t/this.startDur,n=egret.Ease.quartOut(n),this.scaleX=this.s*(1+2.5*n)*this.isM,this.scaleY=this.s*(1+2.5*n),this.alpha=n):(n=(t-this.startDur)/this.dur,this.alpha=1-n,n=1==this.disIn?egret.Ease.quartIn(n):egret.Ease.cubicOut(n),this.scaleX=this.s*(1+2.5*(1-n))*this.isM,this.scaleY=this.s*(1+2.5*(1-n)),this.x=this.fx+n*(this.tx-this.fx),this.y=this.fy+n*(this.ty-this.fy))},t}(egret.Bitmap);__reflect(DustFloat.prototype,"DustFloat");var DustFloatSystem=function(e){function t(){return e.call(this,DustFloat,["dust1","dust3","dust0","dust3","dust1","dust3"],30)||this}return __extends(t,e),t.prototype.itemRes=function(){var e=this.res[this.ri];return this.ri++,this.ri>=this.res.length&&(this.ri=0),e},t.prototype.play=function(e,t,n,o,i,r,s,a,l,p){void 0===i&&(i=2),void 0===r&&(r=2),void 0===s&&(s=-100),void 0===a&&(a=.6),void 0===l&&(l=1200),void 0===p&&(p=300);for(var h,c=1,u=1>=i?0:2*n/(i-1),d=1>=r?0:2*o/(r-1),y=0;i>y;y++)for(var f=0;r>f;f++){h=this.getItem();var g=e-n+y*u+RandomUtils.getInstance().limit(.2*-u,.2*u),m=t-o+f*d+RandomUtils.getInstance().limit(.2*-d,.2*d),v=g+RandomUtils.getInstance().limit(.4*s,.4*-s),w=m+s*(.5+.5*Math.random());h.disIn=!0,h.x=g,h.y=m,h.rotation=0,h.st=Timer.nowTime,h.fx=g,h.fy=m,h.tx=v,h.ty=w,h.s=a*(.5+Math.random()),h.startDur=p*(.5+.5*Math.random()),h.dur=l*(.5+Math.random()),h.visible=!0,c*=-1,h.isM=c}},t.prototype.play2=function(e,t,n,o,i,r,s,a,l,p){void 0===i&&(i=2),void 0===r&&(r=2),void 0===s&&(s=150),void 0===a&&(a=1.4),void 0===l&&(l=1600),void 0===p&&(p=200);for(var h,c=1,u=1>=i?0:2*n/(i-1),d=1>=r?0:2*o/(r-1),y=0;i>y;y++)for(var f=0;r>f;f++){h=this.getItem(),h.disIn=!1;var g=e-n+y*u+RandomUtils.getInstance().limit(.2*-u,.2*u),m=t-o+f*d+RandomUtils.getInstance().limit(.2*-d,.2*d),v=Math.atan2(m-t,g-e);h.rotation=v/Math.PI*180+90;var w=s*(.5+.5*Math.random()),E=g+w*Math.cos(v),I=m+w*Math.sin(v);h.x=g,h.y=m,h.st=Timer.nowTime,h.fx=g,h.fy=m,h.tx=E,h.ty=I,h.s=a*(.7+.3*Math.random()),h.startDur=p*(.5+.5*Math.random()),h.dur=l*(.5+Math.random()),h.visible=!0,c*=-1,h.isM=c}},t}(EffectSystem);__reflect(DustFloatSystem.prototype,"DustFloatSystem");var EffectController=function(){function e(){this.attachBloodPool=new ObjectPool,e.Instance=this;RES.getRes(MCEffectController.atlasName+"#light");this.fireLight=new FireLightSystem("light"),this.explodRing=new FireLightSystem("explode"),this.explod=new FireLightSystem("tnt_03",.5,.4),this.wood1=new WoodPieceSystem(["wbb0","wbb1"]),this.wood2=new WoodPieceSystem(["wpb0","wpb1","wpb2"]),this.dust=new DustFloatSystem,this.spark=new SparkFlySystem,this.blood=new BloodFlySystem,this.explodSpark=new ExplodSparkSystem,this.explodSparkFly=new ExplodSparkFlySystem,this.explodFlame=new ExplodFlameSystem,this.explodDust=new explodDustSystem,this.bloodEjection=new BloodEjectionSystem,this.bulletCase=new BulletCaseSystem,new DeadWordEffect}return e.prototype.playFireLight=function(e,t,n,o){void 0===n&&(n=20),void 0===o&&(o=250),this.fireLight.play(e,t,n,o)},e.prototype.playExplode=function(e,t,n,o){void 0===n&&(n=30),void 0===o&&(o=250),this.explod.play(e,t,n,o)},e.prototype.playExplodeRing=function(e,t,n,o){void 0===n&&(n=30),void 0===o&&(o=450),this.explodRing.play(e,t,n,o)},e.prototype.update=function(){this.fireLight.update(),this.explodRing.update(),this.explod.update(),this.spark.update(),this.explodSpark.update(),this.explodSparkFly.update(),this.explodFlame.update(),this.explodDust.update(),this.blood.update(),this.bloodEjection.update(),this.dust.update(),this.wood1.update(),this.wood2.update(),this.bulletCase.update()},e.prototype.getAttachBlood=function(){var e=RES.getRes(MCEffectController.atlasName+"#blood4"),t=this.attachBloodPool.popObj();return null==t&&(t=new AttachBlood,GameMap.Instance.effectLayer.addChild(t)),t.texture=e,t.anchorOffsetX=t.width/2,t.anchorOffsetY=t.height/2,t.visible=!0,t},e.prototype.removeAttachBlood=function(e){e.visible=!1,this.attachBloodPool.pushObj(e)},e.prototype.clear=function(){this.bloodEjection.removeAll()},e}();__reflect(EffectController.prototype,"EffectController");var AttachBlood=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(egret.Bitmap);__reflect(AttachBlood.prototype,"AttachBlood");var Timer=function(){function e(){}return e.Pause=function(){e.bPause=!0,e.pauseTime=egret.getTimer()},e.Resume=function(){e.bPause=!1,e.pauseTime=egret.getTimer()-e.pauseTime},e.doFrame=function(t){e.updateSlow(),1!=e.bPause&&(t-=e.pauseTime,t>200&&(t=16),e.pauseTime=0,e.tick=t*e.scale,e.nowTime+=e.tick,App.doFrame(t))},e.slow=function(t,n){void 0===n&&(n=.5),e.isSlow=!0,e.slowDur=t,e.slowSt=egret.getTimer(),e.toS=n,e.isSlowOut=!1,App.Sound.playEffect("slowin.mp3")},e.updateSlow=function(){if(0!=e.isSlow){var t=egret.getTimer(),n=t-e.slowSt;if(n>=e.slowDur)return e.scale=1,void(e.isSlow=!1);var o,i=.5*e.slowDur,r=e.slowDur-i;i>n?(o=n/i,o=egret.Ease.quartOut(o)):(o=2-n/r,0==e.isSlowOut&&(e.isSlowOut=!0,App.Sound.playEffect("slowout.mp3",.4))),e.scale=1+(e.toS-1)*o}},e.nowTime=0,e.tick=0,e.bPause=!1,e.scale=1,e.pauseTime=0,e.isSlow=!1,e.isSlowOut=!1,e}();__reflect(Timer.prototype,"Timer");var explodDust=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.update=function(){var e=Timer.nowTime,t=e-this.spt;if(t>this.dur)return null!=this.endFunc&&this.endFunc.apply(this.endTarget,[this]),void EffectController.Instance.explodDust.removeEjection(this);var n=t/this.dur;this.scaleX=this.s*(.7+.3*n),this.scaleY=this.s*(.7+.3*n)*this.isM;var o=Math.floor(n*this.totleFc);if(o!=this.index){this.index=o;var i=MCEffectController.Instance.getTexture(this.resName+this.index.toString());null!=i&&(this.texture=i)}},t}(MCEffectItem);__reflect(explodDust.prototype,"explodDust");var explodDustSystem=function(){function e(){this.pool=new ObjectPool,this.beArr=[],this.beRemoveArr=[]}return e.prototype.play=function(e,t,n,o,i,r,s,a,l){void 0===o&&(o=270),void 0===i&&(i=4),void 0===r&&(r=.2),void 0===s&&(s=1.6),void 0===a&&(a=null),void 0===l&&(l=null);for(var p=o/i,h=-1,c=0;i>c;c++){var u=this.pool.popObj();null==u&&(u=new explodDust,GameMap.Instance.effectLayer.addChild(u));var d=n-.5*o+c*p,y=d+p*RandomUtils.getInstance().limit(0,.5);u.rotation=y;.8+.2*Math.random();u.x=e,u.y=t,u.width=168,u.height=184,u.anchorOffsetX=0,u.anchorOffsetY=86,u.resName="ec",u.totleFc=10,u.index=-1,u.s=s*(.6+.4*Math.random()),u.spt=Timer.nowTime,u.isM=h,h*=-1,u.scaleX=u.scaleY=u.s,u.dur=300+100*Math.random(),u.endFunc=a,u.endTarget=l,u.visible=!0,this.beArr.push(u)}},e.prototype.removeAll=function(){for(var e=0;e<this.beArr.length;e++)this.removeEjection(this.beArr[e])},e.prototype.removeEjection=function(e){this.beRemoveArr.indexOf(e)>=0||this.beRemoveArr.push(e)},e.prototype.updateBeRemove=function(){for(var e,t=0;t<this.beRemoveArr.length;t++)this.beRemoveArr[t].visible=!1,this.beRemoveArr[t].endFunc=null,this.beRemoveArr[t].endTarget=null,this.pool.pushObj(this.beRemoveArr[t]),e=this.beArr.indexOf(this.beRemoveArr[t]),e>=0&&this.beArr.splice(e,1);this.beRemoveArr.splice(0)},e.prototype.update=function(){this.updateBeRemove();for(var e=0;e<this.beArr.length;e++)this.beArr[e].update()},e}();__reflect(explodDustSystem.prototype,"explodDustSystem");var ExplodFlame=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.update=function(){var e=Timer.nowTime,t=e-this.st;if(t>this.dur)return void(this.visible=!1);var n=t/this.dur;n=egret.Ease.quadOut(n),this.alpha=1-n,this.scaleX=this.scaleY=this.s*(.1+.9*n)},t}(egret.Bitmap);__reflect(ExplodFlame.prototype,"ExplodFlame");var ExplodFlameSystem=function(e){function t(){return e.call(this,ExplodFlame,"tnt_08",20)||this}return __extends(t,e),t.prototype.setAnchorOff=function(e){e.anchorOffsetX=0,e.anchorOffsetY=.5*e.height},t.prototype.play=function(e,t,n,o,i,r,s){void 0===r&&(r=3.5),void 0===s&&(s=350);for(var a=o/i,l=0;i>l;l++){var p=this.getItem();p.st=Timer.nowTime,p.x=e,p.y=t;var h=n-.5*o+l*a,c=h+a*RandomUtils.getInstance().limit(0,.5);p.rotation=c,p.s=r*(.5+.5*Math.random()),p.scaleX=p.scaleY=.1*p.s,p.dur=s,p.visible=!0}},t}(EffectSystem);__reflect(ExplodFlameSystem.prototype,"ExplodFlameSystem");var ExplodSpark=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.update=function(){var e=Timer.nowTime,t=e-this.st;if(t>this.dur)return void(this.visible=!1);var n=t/this.dur;n=egret.Ease.cubicIn(n),this.scaleX=this.scaleY=this.s*(1-n)},t}(egret.Bitmap);__reflect(ExplodSpark.prototype,"ExplodSpark");var ExplodSparkSystem=function(e){function t(){return e.call(this,ExplodSpark,"spark2",60)||this}return __extends(t,e),t.prototype.play=function(e,t,n,o,i){void 0===o&&(o=.5),void 0===i&&(i=500);var r=this.getItem();r.st=Timer.nowTime,r.x=e+RandomUtils.getInstance().limit(-n,n),r.y=t+RandomUtils.getInstance().limit(-n,n),r.s=o*(.5+.5*Math.random()),r.scaleX=r.s,r.dur=i*(1+.5*Math.random()),r.visible=!0},t}(EffectSystem);__reflect(ExplodSparkSystem.prototype,"ExplodSparkSystem");var ExplodSparkFly=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.ss=50,t.ssp=0,t}return __extends(t,e),t.prototype.update=function(){var e=Timer.nowTime,t=e-this.st;if(t>this.dur)return void(this.visible=!1);var n;if(t<this.flydur){n=t/this.flydur,n=egret.Ease.quadOut(n);var o=.1+.9*(1-n);this.cvx=this.vx*o,this.cvy=this.vy*o,this.ssp+=Timer.tick,this.ssp>this.ss&&(this.ssp=0,EffectController.Instance.explodSpark.play(this.x,this.y,10))}else{var i=t-this.flydur;n=i/this.disdur,this.scaleX=this.scaleY=this.s*(1-n),this.alpha=1-n,this.cvy+=5e-4*Timer.tick}this.x+=this.cvx*Timer.tick,this.y+=this.cvy*Timer.tick},t}(egret.Bitmap);__reflect(ExplodSparkFly.prototype,"ExplodSparkFly");var ExplodSparkFlySystem=function(e){function t(){return e.call(this,ExplodSparkFly,"spark2",30)||this}return __extends(t,e),t.prototype.play=function(e,t,n,o,i,r,s,a,l){void 0===o&&(o=1.5),void 0===i&&(i=5),void 0===r&&(r=2.7),void 0===s&&(s=1.3),void 0===a&&(a=500),void 0===l&&(l=1500);for(var p,h=0;i>h;h++){p=this.getItem();var c=RandomUtils.getInstance().limit(-o,o);c+=n;var u=.8+.2*Math.random();r*=u;var d=Math.cos(c)*r,y=Math.sin(c)*r;p.s=s*(1.5-u),p.scaleX=p.scaleY=p.s,p.alpha=1,p.vx=d,p.vy=y,p.x=e,p.y=t,p.st=Timer.nowTime,p.flydur=a*(.7+.7*Math.random()),p.disdur=l,p.dur=a+l,p.visible=!0}},t}(EffectSystem);__reflect(ExplodSparkFlySystem.prototype,"ExplodSparkFlySystem");var FireLight=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.dur=100,t.s=20,t}return __extends(t,e),t.prototype.play=function(e,t){this.x=e,this.y=t,this.visible=!0,this.scaleX=this.scaleY=0,this.alpha=0,this.st=Timer.nowTime},t.prototype.update=function(){if(0!=this.visible){var e=Timer.nowTime,t=e-this.st;t>this.dur&&(this.visible=!1),this.scaleX=this.scaleY=this.s*t/this.dur,this.alpha=1-t/this.dur}},t}(egret.Bitmap);__reflect(FireLight.prototype,"FireLight");var FireLightSystem=function(e){function t(t,n,o){return void 0===n&&(n=.5),void 0===o&&(o=.5),e.call(this,FireLight,t,3,n,o)||this}return __extends(t,e),t.prototype.play=function(e,t,n,o){var i=this.getItem();i.dur=o,i.s=n,i.rotation=360*Math.random(),i.play(e,t)},t}(EffectSystem);__reflect(FireLightSystem.prototype,"FireLightSystem");var SparkFly=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.update=function(){var e=Timer.nowTime,t=e-this.st;if(t>this.dur)return void(this.visible=!1);var n=t/this.dur;n=egret.Ease.quadOut(n),this.scaleX=this.fs+(1-n)*(this.ts-this.fs),this.x=this.fx+n*(this.tx-this.fx),this.y=this.fy+n*(this.ty-this.fy)},t}(PtEffectItem);__reflect(SparkFly.prototype,"SparkFly");var SparkFlySystem=function(e){function t(){return e.call(this,SparkFly,"spark2",30)||this}return __extends(t,e),t.prototype.play=function(e,t,n,o,i,r,s,a){void 0===o&&(o=.5),void 0===i&&(i=4),void 0===r&&(r=150),void 0===s&&(s=.6),void 0===a&&(a=300);for(var l,p=0;i>p;p++){l=this.getItem();var h=RandomUtils.getInstance().limit(-o,o);h+=n;var c=Math.cos(h)*r,u=Math.sin(h)*r,d=e+.5*c*Math.random(),y=t+.5*u*Math.random(),f=e+c*(.7*Math.random()+1),g=t+u*(.7*Math.random()+1);l.x=d,l.y=y,l.rotation=180*h/Math.PI,l.st=Timer.nowTime,l.fx=d,l.fy=y,l.tx=f,l.ty=g,s=(.6+.4*Math.random())*s,l.fs=s,l.ts=10*s,l.scaleY=s,l.dur=a*(1+.5*Math.random()),l.visible=!0}},t}(EffectSystem);__reflect(SparkFlySystem.prototype,"SparkFlySystem");var WoodPiece=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.vr=0,t.vx=0,t.vy=0,t}return __extends(t,e),t.prototype.update=function(){var e=Timer.nowTime,t=e-this.st;if(t>this.dur)return void(this.visible=!1);var n=t/this.dur;n=egret.Ease.quartIn(n),this.alpha=1-n,this.x+=this.vx*Timer.tick,this.vy+=.002*Timer.tick,this.y+=this.vy*Timer.tick,this.rotation+=this.vr*Timer.tick},t}(egret.Bitmap);__reflect(WoodPiece.prototype,"WoodPiece");var WoodPieceSystem=function(e){function t(t){return e.call(this,WoodPiece,t,6)||this}return __extends(t,e),t.prototype.itemRes=function(){var e=this.res[this.ri];return this.ri++,this.ri>=this.res.length&&(this.ri=0),e},t.prototype.play=function(e,t,n,o,i,r,s,a){void 0===s&&(s=1),void 0===a&&(a=800);for(var l,p=1,h=1>=i?0:2*n/(i-1),c=1>=r?0:2*o/(r-1),u=0;i>u;u++)for(var d=0;r>d;d++){l=this.getItem();var y=e-n+u*h+.1*h*(1-2*Math.random()),f=t-o+d*c+.1*c*(1-2*Math.random());l.x=y,l.y=f,l.rotation=0,l.st=Timer.nowTime,l.scaleX=s*p,l.scaleY=s,l.dur=a*(.5+Math.random()),l.visible=!0,l.vr=.3+.2*Math.random()*p,l.vx=(y-e>0?1:-1)*(.2*Math.random()),l.vy=-(.1+.1*Math.random()),p*=-1}},t}(EffectSystem);__reflect(WoodPieceSystem.prototype,"WoodPieceSystem");var Level0=function(e){function t(){var t=e.call(this)||this;return t.bulletNum=5,t.skinName="resource/level/l0.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t.prototype.init=function(){e.prototype.init.call(this)},t.prototype.hitwb=function(){},t}(LevelCreator);__reflect(Level0.prototype,"Level0"),window.Level0=Level0;var Level1=function(e){function t(){var t=e.call(this)||this;return t.bulletNum=5,t.skinName="resource/level/l1.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t}(LevelCreator);__reflect(Level1.prototype,"Level1"),window.Level1=Level1;var Level10=function(e){function t(){var t=e.call(this)||this;return t.bulletNum=3,t.skinName="resource/level/l10.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t}(LevelCreator);__reflect(Level10.prototype,"Level10"),window.Level10=Level10;var Level11=function(e){function t(){var t=e.call(this)||this;return t.bulletNum=5,t.skinName="resource/level/l11.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t}(LevelCreator);__reflect(Level11.prototype,"Level11"),window.Level11=Level11;var Level12=function(e){function t(){var t=e.call(this)||this;return t.bulletNum=5,t.skinName="resource/level/l12.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t}(LevelCreator);__reflect(Level12.prototype,"Level12"),window.Level12=Level12;var Level13=function(e){function t(){var t=e.call(this)||this;return t.bulletNum=5,t.skinName="resource/level/l13.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t}(LevelCreator);__reflect(Level13.prototype,"Level13"),window.Level13=Level13;var Level14=function(e){function t(){var t=e.call(this)||this;return t.bulletNum=3,t.skinName="resource/level/l14.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t}(LevelCreator);__reflect(Level14.prototype,"Level14"),window.Level14=Level14;var Level15=function(e){function t(){var t=e.call(this)||this;return t.bulletNum=5,t.skinName="resource/level/l15.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t}(LevelCreator);__reflect(Level15.prototype,"Level15"),window.Level15=Level15;var Level16=function(e){function t(){var t=e.call(this)||this;return t.bulletNum=5,t.skinName="resource/level/l16.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t}(LevelCreator);__reflect(Level16.prototype,"Level16"),window.Level16=Level16;var Level17=function(e){function t(){var t=e.call(this)||this;return t.bulletNum=5,t.skinName="resource/level/l17.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t}(LevelCreator);__reflect(Level17.prototype,"Level17"),window.Level17=Level17;var Level18=function(e){function t(){var t=e.call(this)||this;return t.bulletNum=5,t.skinName="resource/level/l18.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t.prototype.init=function(){e.prototype.init.call(this),this.woodBox.obj.addRemoveFunc(this.wbRemove,this)},t.prototype.wbRemove=function(){this.enemy1.obj.onDead("")},t}(LevelCreator);__reflect(Level18.prototype,"Level18"),window.Level18=Level18;var Level19=function(e){function t(){var t=e.call(this)||this;return t.bulletNum=5,t.skinName="resource/level/l19.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t}(LevelCreator);__reflect(Level19.prototype,"Level19"),window.Level19=Level19;var Level2=function(e){function t(){var t=e.call(this)||this;return t.bulletNum=3,t.skinName="resource/level/l2.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t}(LevelCreator);__reflect(Level2.prototype,"Level2"),window.Level2=Level2;var Level20=function(e){function t(){var t=e.call(this)||this;return t.bulletNum=5,t.skinName="resource/level/l20.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t}(LevelCreator);__reflect(Level20.prototype,"Level20"),window.Level20=Level20;var Level21=function(e){function t(){var t=e.call(this)||this;return t.bulletNum=5,t.skinName="resource/level/l21.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t.prototype.init=function(){e.prototype.init.call(this),this.ironball.obj.body.mass=10,this.ironball.obj.body.updateMassProperties()},t}(LevelCreator);__reflect(Level21.prototype,"Level21"),window.Level21=Level21;var Level22=function(e){function t(){var t=e.call(this)||this;return t.bulletNum=5,t.skinName="resource/level/l22.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t.prototype.init=function(){e.prototype.init.call(this),this.staticBoom.obj.body.type=p2.Body.STATIC,this.staticBoom.obj.body.updateMassProperties()},t}(LevelCreator);__reflect(Level22.prototype,"Level22"),window.Level22=Level22;var Level23=function(e){function t(){var t=e.call(this)||this;return t.bulletNum=5,t.skinName="resource/level/l23.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t.prototype.init=function(){e.prototype.init.call(this),this.spst.obj.body.mass=.4,this.spst.obj.body.angularDamping=0,this.spst.obj.body.damping=0,this.spst.obj.body.updateMassProperties()},t}(LevelCreator);__reflect(Level23.prototype,"Level23"),window.Level23=Level23;var Level24=function(e){function t(){var t=e.call(this)||this;return t.bulletNum=5,t.skinName="resource/level/l24.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t.prototype.init=function(){e.prototype.init.call(this),this.s0.obj.addRemoveFunc(this.ws0Remove,this),this.s1.obj.addRemoveFunc(this.ws1Remove,this),this.s2.obj.addRemoveFunc(this.ws2Remove,this)},t.prototype.ws0Remove=function(){this.e0.obj.onDead("")},t.prototype.ws1Remove=function(){this.e1.obj.onDead("")},t.prototype.ws2Remove=function(){this.e2.obj.onDead("")},t}(LevelCreator);__reflect(Level24.prototype,"Level24"),window.Level24=Level24;var Level25=function(e){function t(){var t=e.call(this)||this;return t.bulletNum=5,t.skinName="resource/level/l25.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t.prototype.init=function(){e.prototype.init.call(this)},t}(LevelCreator);__reflect(Level25.prototype,"Level25"),window.Level25=Level25;var Level26=function(e){function t(){var t=e.call(this)||this;return t.bulletNum=5,t.skinName="resource/level/l26.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t.prototype.init=function(){e.prototype.init.call(this)},t}(LevelCreator);__reflect(Level26.prototype,"Level26"),window.Level26=Level26;var Level27=function(e){function t(){var t=e.call(this)||this;return t.bulletNum=3,t.skinName="resource/level/l27.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t.prototype.init=function(){e.prototype.init.call(this)},t}(LevelCreator);__reflect(Level27.prototype,"Level27"),window.Level27=Level27;var Level28=function(e){function t(){var t=e.call(this)||this;return t.bulletNum=3,t.skinName="resource/level/l28.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t.prototype.init=function(){e.prototype.init.call(this)},t}(LevelCreator);__reflect(Level28.prototype,"Level28"),window.Level28=Level28;var Level29=function(e){function t(){var t=e.call(this)||this;return t.bulletNum=3,t.skinName="resource/level/l29.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t}(LevelCreator);__reflect(Level29.prototype,"Level29"),window.Level29=Level29;var Level3=function(e){function t(){var t=e.call(this)||this;return t.bulletNum=5,t.skinName="resource/level/l3.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t}(LevelCreator);__reflect(Level3.prototype,"Level3"),window.Level3=Level3;var Level30=function(e){function t(){var t=e.call(this)||this;return t.bulletNum=5,t.skinName="resource/level/l30.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t}(LevelCreator);__reflect(Level30.prototype,"Level30"),window.Level30=Level30;var Level31=function(e){function t(){var t=e.call(this)||this;return t.bulletNum=3,t.skinName="resource/level/l31.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t}(LevelCreator);__reflect(Level31.prototype,"Level31"),window.Level31=Level31;var Level32=function(e){function t(){var t=e.call(this)||this;return t.bulletNum=3,t.skinName="resource/level/l32.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t}(LevelCreator);__reflect(Level32.prototype,"Level32"),window.Level32=Level32;var Level33=function(e){function t(){var t=e.call(this)||this;return t.bulletNum=3,t.skinName="resource/level/l33.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t}(LevelCreator);__reflect(Level33.prototype,"Level33"),window.Level33=Level33;var Level34=function(e){function t(){var t=e.call(this)||this;return t.bulletNum=5,t.skinName="resource/level/l34.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t}(LevelCreator);__reflect(Level34.prototype,"Level34"),window.Level34=Level34;var Level35=function(e){function t(){var t=e.call(this)||this;return t.bulletNum=3,t.skinName="resource/level/l35.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t.prototype.init=function(){e.prototype.init.call(this),this.woodStript.obj.addRemoveFunc(this.remove,this)},t.prototype.remove=function(){this.enemy.obj.onDead("")},t}(LevelCreator);__reflect(Level35.prototype,"Level35"),window.Level35=Level35;var Level36=function(e){function t(){var t=e.call(this)||this;return t.bulletNum=3,t.skinName="resource/level/l36.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t}(LevelCreator);__reflect(Level36.prototype,"Level36"),window.Level36=Level36;var Level37=function(e){function t(){var t=e.call(this)||this;return t.bulletNum=3,t.skinName="resource/level/l37.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t}(LevelCreator);__reflect(Level37.prototype,"Level37"),window.Level37=Level37;var Level38=function(e){function t(){var t=e.call(this)||this;return t.bulletNum=3,t.skinName="resource/level/l38.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t}(LevelCreator);__reflect(Level38.prototype,"Level38"),window.Level38=Level38;
var Level39=function(e){function t(){var t=e.call(this)||this;return t.bulletNum=3,t.skinName="resource/level/l39.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t}(LevelCreator);__reflect(Level39.prototype,"Level39"),window.Level39=Level39;var Level4=function(e){function t(){var t=e.call(this)||this;return t.bulletNum=5,t.skinName="resource/level/l4.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t}(LevelCreator);__reflect(Level4.prototype,"Level4"),window.Level4=Level4;var Level40=function(e){function t(){var t=e.call(this)||this;return t.bulletNum=3,t.skinName="resource/level/l40.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t}(LevelCreator);__reflect(Level40.prototype,"Level40"),window.Level40=Level40;var Level41=function(e){function t(){var t=e.call(this)||this;return t.bulletNum=3,t.skinName="resource/level/l41.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t}(LevelCreator);__reflect(Level41.prototype,"Level41"),window.Level41=Level41;var Level42=function(e){function t(){var t=e.call(this)||this;return t.bulletNum=3,t.skinName="resource/level/l42.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t.prototype.init=function(){e.prototype.init.call(this),this.s0.obj.addRemoveFunc(this.remove0,this),this.s1.obj.addRemoveFunc(this.remove1,this),this.s2.obj.addRemoveFunc(this.remove2,this)},t.prototype.remove0=function(){this.e0.obj.onDead("")},t.prototype.remove1=function(){this.e1.obj.onDead("")},t.prototype.remove2=function(){this.e2.obj.onDead("")},t}(LevelCreator);__reflect(Level42.prototype,"Level42"),window.Level42=Level42;var Level43=function(e){function t(){var t=e.call(this)||this;return t.bulletNum=3,t.skinName="resource/level/l43.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t}(LevelCreator);__reflect(Level43.prototype,"Level43"),window.Level43=Level43;var Level44=function(e){function t(){var t=e.call(this)||this;return t.bulletNum=3,t.skinName="resource/level/l44.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t}(LevelCreator);__reflect(Level44.prototype,"Level44"),window.Level44=Level44;var Level45=function(e){function t(){var t=e.call(this)||this;return t.bulletNum=3,t.skinName="resource/level/l45.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t}(LevelCreator);__reflect(Level45.prototype,"Level45"),window.Level45=Level45;var Level46=function(e){function t(){var t=e.call(this)||this;return t.bulletNum=3,t.skinName="resource/level/l46.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t.prototype.init=function(){e.prototype.init.call(this),this.s0.obj.addRemoveFunc(this.remove0,this),this.s1.obj.addRemoveFunc(this.remove1,this),this.s2.obj.addRemoveFunc(this.remove2,this),this.s3.obj.addRemoveFunc(this.remove3,this)},t.prototype.remove0=function(){this.e0.obj.onDead("")},t.prototype.remove1=function(){this.e1.obj.onDead("")},t.prototype.remove2=function(){this.e2.obj.onDead("")},t.prototype.remove3=function(){this.e3.obj.onDead("")},t}(LevelCreator);__reflect(Level46.prototype,"Level46"),window.Level46=Level46;var Level47=function(e){function t(){var t=e.call(this)||this;return t.bulletNum=5,t.skinName="resource/level/l47.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t}(LevelCreator);__reflect(Level47.prototype,"Level47"),window.Level47=Level47;var Level48=function(e){function t(){var t=e.call(this)||this;return t.bulletNum=5,t.skinName="resource/level/l48.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t}(LevelCreator);__reflect(Level48.prototype,"Level48"),window.Level48=Level48;var Level49=function(e){function t(){var t=e.call(this)||this;return t.bulletNum=3,t.skinName="resource/level/l49.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t}(LevelCreator);__reflect(Level49.prototype,"Level49"),window.Level49=Level49;var Level5=function(e){function t(){var t=e.call(this)||this;return t.bulletNum=5,t.skinName="resource/level/l5.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t.prototype.init=function(){e.prototype.init.call(this),this.swoodStrip.obj.addRemoveFunc(this.wsRemove,this)},t.prototype.wsRemove=function(){this.enemy1.obj.onDead(""),this.enemy2.obj.onDead("")},t}(LevelCreator);__reflect(Level5.prototype,"Level5"),window.Level5=Level5;var Level50=function(e){function t(){var t=e.call(this)||this;return t.bulletNum=3,t.skinName="resource/level/l50.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t}(LevelCreator);__reflect(Level50.prototype,"Level50"),window.Level50=Level50;var Level51=function(e){function t(){var t=e.call(this)||this;return t.bulletNum=3,t.skinName="resource/level/l51.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t.prototype.init=function(){e.prototype.init.call(this),this.s1.obj.addRemoveFunc(this.removeE,this)},t.prototype.removeE=function(){this.e1.obj.onDead(""),this.e2.obj.onDead("")},t}(LevelCreator);__reflect(Level51.prototype,"Level51"),window.Level51=Level51;var Level52=function(e){function t(){var t=e.call(this)||this;return t.bulletNum=3,t.skinName="resource/level/l52.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t.prototype.init=function(){e.prototype.init.call(this)},t}(LevelCreator);__reflect(Level52.prototype,"Level52"),window.Level52=Level52;var DebugPlatform=function(){function e(){}return e.prototype.getPlatformName=function(){return"tt"},e.prototype.loadPackageTEX=function(e){return null},e.prototype.loadPackageIMG=function(e){return null},e.prototype.requestURL=function(e){return null},e.prototype.showCreateUserInfo=function(e){},e.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e.prototype.share=function(e,t,n,o,i,r,s){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,!0]})})},e.prototype.groupOpen=function(e){},e.prototype.showRewardedVedio=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,0]})})},e.prototype.getLaunchInfo=function(){return null},e.prototype.getSystemInfo=function(){return null},e.prototype.toOpenDataCommond=function(e,t){},e.prototype.showBanner=function(){},e.prototype.showBanner2=function(e,t){},e.prototype.hideBanner=function(){},e.prototype.vibrateShort=function(){},e.prototype.getHeadHeight=function(){return 0},e.prototype.linkOtherGame=function(e,t,n,o,i){},e.prototype.removeLocalCache=function(){},e.prototype.onShow=function(e){},e.prototype.onHide=function(e){},e.prototype.listenShareApp=function(e){},e.prototype.openCustomerServiceConversation=function(){},e.prototype.initRewardedVedio=function(e,t){},e.prototype.aldSendEvent=function(e,t){},e.prototype.aldOnStart=function(e){},e.prototype.aldOnRunning=function(e){},e.prototype.aldOnEnd=function(e){},e.prototype.tryShowInsertAd=function(){},e.prototype.getAutoSetting=function(){return null},e.prototype.onBannerError=function(e){this.bannerError=e},e.prototype.createBanner=function(e){},e.prototype.spendBannerShowEvent=function(){},e.prototype.requestSubscribeMessage=function(e,t){},e.prototype.recordStart=function(){},e.prototype.recordStop=function(){},e.prototype.recordResume=function(){},e.prototype.recordPause=function(){},e.prototype.showInterstitial=function(){},e.prototype.showAppBox=function(){},e.prototype.refreshBanner=function(){},e.prototype.showMoreGamesModal=function(e){},e.prototype.isExperience=function(){return!1},e.prototype.gameRecorderOnShare=function(e,t,n){t&&t(),n&&n()},e}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]);var Level54=function(e){function t(){var t=e.call(this)||this;return t.bulletNum=3,t.skinName="resource/level/l54.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t}(LevelCreator);__reflect(Level54.prototype,"Level54"),window.Level54=Level54;var Level55=function(e){function t(){var t=e.call(this)||this;return t.bulletNum=4,t.skinName="resource/level/l55.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t}(LevelCreator);__reflect(Level55.prototype,"Level55"),window.Level55=Level55;var Level56=function(e){function t(){var t=e.call(this)||this;return t.bulletNum=3,t.skinName="resource/level/l56.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t.prototype.init=function(){e.prototype.init.call(this)},t}(LevelCreator);__reflect(Level56.prototype,"Level56"),window.Level56=Level56;var Level57=function(e){function t(){var t=e.call(this)||this;return t.bulletNum=3,t.skinName="resource/level/l57.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t}(LevelCreator);__reflect(Level57.prototype,"Level57"),window.Level57=Level57;var Level58=function(e){function t(){var t=e.call(this)||this;return t.bulletNum=3,t.skinName="resource/level/l58.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t}(LevelCreator);__reflect(Level58.prototype,"Level58"),window.Level58=Level58;var Level59=function(e){function t(){var t=e.call(this)||this;return t.bulletNum=3,t.skinName="resource/level/l59.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t}(LevelCreator);__reflect(Level59.prototype,"Level59"),window.Level59=Level59;var Level6=function(e){function t(){var t=e.call(this)||this;return t.bulletNum=3,t.skinName="resource/level/l6.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t.prototype.init=function(){e.prototype.init.call(this),this.woodBox.obj.addRemoveFunc(this.wsRemove,this)},t.prototype.wsRemove=function(){this.enemy1.obj.onDead(""),this.enemy2.obj.onDead("")},t}(LevelCreator);__reflect(Level6.prototype,"Level6"),window.Level6=Level6;var Level60=function(e){function t(){var t=e.call(this)||this;return t.bulletNum=3,t.skinName="resource/level/l60.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t.prototype.init=function(){e.prototype.init.call(this),this.s1.obj.addRemoveFunc(this.wsRemove,this)},t.prototype.wsRemove=function(){this.e1.obj.onDead("")},t}(LevelCreator);__reflect(Level60.prototype,"Level60"),window.Level60=Level60;var Level61=function(e){function t(){var t=e.call(this)||this;return t.bulletNum=3,t.skinName="resource/level/l61.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t.prototype.init=function(){e.prototype.init.call(this)},t.prototype.wsRemove=function(){},t}(LevelCreator);__reflect(Level61.prototype,"Level61"),window.Level61=Level61;var Level62=function(e){function t(){var t=e.call(this)||this;return t.bulletNum=3,t.skinName="resource/level/l62.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t.prototype.init=function(){e.prototype.init.call(this)},t.prototype.wsRemove=function(){},t}(LevelCreator);__reflect(Level62.prototype,"Level62"),window.Level62=Level62;var Level63=function(e){function t(){var t=e.call(this)||this;return t.bulletNum=3,t.skinName="resource/level/l63.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t.prototype.init=function(){e.prototype.init.call(this),this.s1.obj.addRemoveFunc(this.wsRemove,this)},t.prototype.wsRemove=function(){this.e1.obj.onDead("")},t}(LevelCreator);__reflect(Level63.prototype,"Level63"),window.Level63=Level63;var Level64=function(e){function t(){var t=e.call(this)||this;return t.bulletNum=3,t.skinName="resource/level/l64.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t.prototype.init=function(){e.prototype.init.call(this)},t.prototype.wsRemove=function(){},t}(LevelCreator);__reflect(Level64.prototype,"Level64"),window.Level64=Level64;var Level65=function(e){function t(){var t=e.call(this)||this;return t.bulletNum=3,t.skinName="resource/level/l65.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t.prototype.init=function(){e.prototype.init.call(this),this.s3.obj.addRemoveFunc(this.wsRemove,this)},t.prototype.wsRemove=function(){this.e1.obj.onDead("")},t}(LevelCreator);__reflect(Level65.prototype,"Level65"),window.Level65=Level65;var Level66=function(e){function t(){var t=e.call(this)||this;return t.bulletNum=3,t.skinName="resource/level/l66.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t}(LevelCreator);__reflect(Level66.prototype,"Level66"),window.Level66=Level66;var Level67=function(e){function t(){var t=e.call(this)||this;return t.bulletNum=3,t.skinName="resource/level/l67.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t.prototype.init=function(){e.prototype.init.call(this)},t.prototype.wsRemove=function(){},t}(LevelCreator);__reflect(Level67.prototype,"Level67"),window.Level67=Level67;var Level68=function(e){function t(){var t=e.call(this)||this;return t.bulletNum=3,t.skinName="resource/level/l68.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t.prototype.init=function(){e.prototype.init.call(this)},t.prototype.wsRemove=function(){},t}(LevelCreator);__reflect(Level68.prototype,"Level68"),window.Level68=Level68;var Level69=function(e){function t(){var t=e.call(this)||this;return t.bulletNum=3,t.skinName="resource/level/l69.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t.prototype.init=function(){e.prototype.init.call(this)},t.prototype.wsRemove=function(){},t}(LevelCreator);__reflect(Level69.prototype,"Level69"),window.Level69=Level69;var Level7=function(e){function t(){var t=e.call(this)||this;return t.bulletNum=5,t.skinName="resource/level/l7.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t}(LevelCreator);__reflect(Level7.prototype,"Level7"),window.Level7=Level7;var Level70=function(e){function t(){var t=e.call(this)||this;return t.bulletNum=4,t.skinName="resource/level/l70.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t.prototype.init=function(){e.prototype.init.call(this),this.s0.obj.addRemoveFunc(this.wsRemove,this),this.s2.obj.addRemoveFunc(this.wsRemove2,this)},t.prototype.wsRemove=function(){this.e0.obj.onDead("")},t.prototype.wsRemove2=function(){this.e2.obj.onDead("")},t}(LevelCreator);__reflect(Level70.prototype,"Level70"),window.Level70=Level70;var Level71=function(e){function t(){var t=e.call(this)||this;return t.bulletNum=5,t.skinName="resource/level/l71.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t}(LevelCreator);__reflect(Level71.prototype,"Level71"),window.Level71=Level71;var Level72=function(e){function t(){var t=e.call(this)||this;return t.bulletNum=3,t.skinName="resource/level/l72.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t.prototype.init=function(){e.prototype.init.call(this),this.s2.obj.addRemoveFunc(this.wsRemove,this)},t.prototype.wsRemove=function(){this.e2.obj.onDead("")},t}(LevelCreator);__reflect(Level72.prototype,"Level72"),window.Level72=Level72;var Level73=function(e){function t(){var t=e.call(this)||this;return t.bulletNum=3,t.skinName="resource/level/l73.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t.prototype.init=function(){e.prototype.init.call(this),this.w0.obj.addRemoveFunc(this.wsRemove,this)},t.prototype.wsRemove=function(){this.e0.obj.onDead("")},t}(LevelCreator);__reflect(Level73.prototype,"Level73"),window.Level73=Level73;var Level74=function(e){function t(){var t=e.call(this)||this;return t.bulletNum=3,t.skinName="resource/level/l74.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t}(LevelCreator);__reflect(Level74.prototype,"Level74"),window.Level74=Level74;var Level75=function(e){function t(){var t=e.call(this)||this;return t.bulletNum=3,t.skinName="resource/level/l75.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t}(LevelCreator);__reflect(Level75.prototype,"Level75"),window.Level75=Level75;var Level76=function(e){function t(){var t=e.call(this)||this;return t.bulletNum=3,t.skinName="resource/level/l76.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t}(LevelCreator);__reflect(Level76.prototype,"Level76"),window.Level76=Level76;var Level77=function(e){function t(){var t=e.call(this)||this;return t.bulletNum=3,t.skinName="resource/level/l77.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t}(LevelCreator);__reflect(Level77.prototype,"Level77"),window.Level77=Level77;var Level78=function(e){function t(){var t=e.call(this)||this;return t.bulletNum=3,t.skinName="resource/level/l78.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t}(LevelCreator);__reflect(Level78.prototype,"Level78"),window.Level78=Level78;var Level79=function(e){function t(){var t=e.call(this)||this;return t.bulletNum=3,t.skinName="resource/level/l79.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t.prototype.init=function(){e.prototype.init.call(this),this.woodStrip.obj.addRemoveFunc(this.wsRemove,this)},t.prototype.wsRemove=function(){this.enemy1.obj.onDead(""),this.enemy2.obj.onDead("")},t}(LevelCreator);__reflect(Level79.prototype,"Level79"),window.Level79=Level79;var Level8=function(e){function t(){var t=e.call(this)||this;return t.bulletNum=5,t.skinName="resource/level/l8.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t}(LevelCreator);__reflect(Level8.prototype,"Level8"),window.Level8=Level8;var Level80=function(e){function t(){var t=e.call(this)||this;return t.bulletNum=3,t.skinName="resource/level/l80.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t.prototype.init=function(){e.prototype.init.call(this),this.line.obj.addChipRemoveFunc(this.wsRemove,this)},t.prototype.wsRemove=function(e){"top"==e&&this.enemy.obj.onDead("")},t}(LevelCreator);__reflect(Level80.prototype,"Level80"),window.Level80=Level80;var Level81=function(e){function t(){var t=e.call(this)||this;return t.bulletNum=3,t.skinName="resource/level/l81.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t}(LevelCreator);__reflect(Level81.prototype,"Level81"),window.Level81=Level81;var Level9=function(e){function t(){var t=e.call(this)||this;return t.bulletNum=5,t.skinName="resource/level/l9.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t}(LevelCreator);__reflect(Level9.prototype,"Level9"),window.Level9=Level9;var AssetAdapter=function(){function e(){}return e.prototype.getAsset=function(e,t,n){function o(o){t.call(n,o,e)}if(RES.hasRes(e)){var i=RES.getRes(e);i?o(i):RES.getResAsync(e,o,this)}else RES.getResByUrl(e,o,this,RES.ResourceItem.TYPE_IMAGE)},e}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var BoomBoxObj=function(e){function t(){var t=e.call(this)||this;return t.imgName="boombox",t.boomMass=1,t.boomrange=7,t.isBoom=!1,t.type=ELevelElementType.BOOMBOX,t}return __extends(t,e),t.prototype.init=function(t,n,o,i,r,s){o>=120&&i>=120?this.imgName="boombox2":this.imgName=App.RandomUtils.limit(0,2)>1?"boombox":"boombox1",e.prototype.createElement.call(this,this.imgName,t,n,o,i,r),this.initBodyType=s,this.createPhysics()},t.prototype.createPhysics=function(){this.shape=new p2.Box({width:this.elementImg.width*P2World.d2pFactor,height:this.elementImg.height*P2World.d2pFactor}),this.body=P2World.Instance.getBody(),this.body.position=[P2World.Instance.d2pX(this.elementImg.x),P2World.Instance.d2pY(this.elementImg.y)],this.body.flag="boombox",this.body.type=this.getInitBodyType(),this.body.angle=0,this.body.mass=2,this.body.addShape(this.shape),P2World.Instance.addBody(this.body),this.shape.collisionGroup=P2World.ITEM_GROUP,this.shape.collisionMask=P2World.ITEM_MASK,BeginContactEvent.Instance.on(this.body.id,this.onBeginContact,this)},t.prototype.onBeginContact=function(e){var t=e.bodyA,n=e.bodyB,o=t==this.body?n:t;if(o.shapes[0].collisionGroup==P2World.BULLET_GROUP||o.shapes[0].collisionGroup==P2World.BOOM_GROUP)return void this.boom();var i=this.body.velocity[0]-o.velocity[0],r=this.body.velocity[1]-o.velocity[1],s=i*i+r*r;return s>16?void this.boom():void 0},t.prototype.update=function(){e.prototype.update.call(this)},t.prototype.boom=function(){EffectController.Instance.dust.play2(this.elementImg.x,this.elementImg.y,.5*this.elementImg.width,.5*this.elementImg.height,4,3);var e=LevelElementManager.Instance.createExplosion(3,this.boomrange,this.boomMass,this.elementImg.x,this.elementImg.y);e.boom(),LevelElementManager.Instance.removeElement(this),App.vibrateShort()},t.prototype.clear=function(){e.prototype.clear.call(this),BeginContactEvent.Instance.off(this.body.id)},t}(LevelElementObj);__reflect(BoomBoxObj.prototype,"BoomBoxObj");var BoomBoxPos=function(e){function t(){var t=e.call(this)||this;return t.boommass=1,t.boomrange=7,t}return __extends(t,e),t.prototype.createObj=function(){e.prototype.createObj.call(this),this.obj=LevelElementManager.Instance.createElement(ELevelElementType.BOOMBOX),this.obj.init(this.x,this.y,this.width,this.height,this.rotation,this.Bodytype),this.obj.boomMass=this.boommass,this.obj.boomrange=this.boomrange},t}(ObjPos);__reflect(BoomBoxPos.prototype,"BoomBoxPos"),window.BoomBoxPos=BoomBoxPos;var ExplosionObj=function(){function e(){this.isBoom=!1,this.totalframe=0,this.radius=0,this.mass=0,this.x=0,this.y=0,this.frame=0}return e.prototype.init=function(e,t,n,o,i){this.totalframe=e,this.radius=t,this.mass=n,this.x=o,this.y=i},e.prototype.playEffect=function(){App.Sound.playEffect("explo.mp3"),GameMap.Instance.shake(),GameMap.Instance.dark(.4,700),EffectController.Instance.playExplode(this.x,this.y,5),EffectController.Instance.playFireLight(this.x,this.y,20),EffectController.Instance.playExplodeRing(this.x,this.y,5),EffectController.Instance.explodFlame.play(this.x,this.y,-90,270,5),EffectController.Instance.spark.play(this.x,this.y,-.5*Math.PI,.8*Math.PI,8,200,.7,500),EffectController.Instance.explodSparkFly.play(this.x,this.y,-.5*Math.PI),EffectController.Instance.explodDust.play(this.x,this.y,-90)},e.prototype.createPhysics=function(){this.shape2=new p2.Circle({radius:this.radius}),this.shape2.material=P2World.Instance.boomMat,this.body2=P2World.Instance.getBody(),this.body2.position[0]=P2World.Instance.d2pX(this.x),this.body2.position[1]=P2World.Instance.d2pY(this.y),this.body2.flag="boom",this.body2.type=p2.Body.DYNAMIC,this.body2.fixedX=!0,this.body2.fixedY=!0,this.body2.fixedRotation=!0,this.body2.mass=this.mass,this.body2.addShape(this.shape2),this.shape2.collisionGroup=P2World.BOOM_GROUP,this.shape2.collisionMask=P2World.BOOM_MASK,this.body2.sleepState=p2.Body.AWAKE,P2World.Instance.addBody(this.body2)},e.prototype.boom=function(){this.isBoom=!0},e.prototype.update=function(){if(0!=this.isBoom){if(this.body2&&this.frame>=this.totalframe)return void LevelElementManager.Instance.removeExplosion(this);this.frame++,null==this.body2&&(this.playEffect(),this.createPhysics())}},e.prototype.clear=function(){P2World.Instance.removeBody(this.body2),this.body2=null,this.isBoom=!1},e}();__reflect(ExplosionObj.prototype,"ExplosionObj");var IronBallObj=function(e){function t(){var t=e.call(this)||this;return t.imgName="ironball",t.mass=3,t.type=ELevelElementType.IRONBALL,t}return __extends(t,e),t.prototype.init=function(t,n,o,i,r){this.imgName=App.RandomUtils.limit(0,2)>1?"ironball":"ironball1",e.prototype.createElement.call(this,this.imgName,t,n,o,i,r),this.createPhysics()},t.prototype.createPhysics=function(){this.shape=new p2.Circle({radius:this.elementImg.width/2*P2World.d2pFactor}),this.body=P2World.Instance.getBody(),this.body.angle=0,this.body.position=[P2World.Instance.d2pX(this.elementImg.x),P2World.Instance.d2pY(this.elementImg.y)],this.body.flag="ironball",this.body.sleepState==p2.Body.AWAKE,this.body.allowSleep=!1,this.body.damping=.01,this.body.mass=this.mass,this.body.type=p2.Body.DYNAMIC,this.body.addShape(this.shape),P2World.Instance.addBody(this.body),this.body.updateMassProperties(),this.shape.material=P2World.Instance.itemMat,this.shape.collisionGroup=P2World.ITEM_GROUP,this.shape.collisionMask=P2World.ITEM_MASK,BeginContactEvent.Instance.on(this.body.id,this.onBeginContact,this)},t.prototype.onBeginContact=function(e){var t=e.bodyA,n=e.bodyB,o=this.body.id==t.id?n:t;if(o.shapes[0].collisionGroup==P2World.BULLET_GROUP)App.Sound.playEffect("hitiron.mp3");else if(o.shapes[0].collisionGroup==P2World.TERRAIN_GROUP){var i=this.body.velocity[0]*this.body.velocity[0]+this.body.velocity[1]*this.body.velocity[1];i>16&&App.Sound.playEffect("hitrock.mp3",.8)}},t.prototype.update=function(){e.prototype.update.call(this)},t.prototype.clear=function(){e.prototype.clear.call(this),BeginContactEvent.Instance.off(this.body.id),this.body=null},t}(LevelElementObj);__reflect(IronBallObj.prototype,"IronBallObj");var IronBallPos=function(e){function t(){var t=e.call(this)||this;return t.mass=3,t}return __extends(t,e),t.prototype.createObj=function(){e.prototype.createObj.call(this),this.obj=LevelElementManager.Instance.createElement(ELevelElementType.IRONBALL),this.obj.mass=this.mass,this.obj.init(this.x,this.y,this.width,this.height,this.rotation)},t}(ObjPos);__reflect(IronBallPos.prototype,"IronBallPos"),window.IronBallPos=IronBallPos;var IronBoxObj=function(e){function t(){var t=e.call(this)||this;return t.imgName="ironbox",t.type=ELevelElementType.IRONBOX,t}return __extends(t,e),t.prototype.init=function(t,n,o,i,r){var s=App.RandomUtils.limitInteger(0,4);o>150&&(s=1),this.imgName="ironbox",0!=s&&(this.imgName+=s),e.prototype.createElement.call(this,this.imgName,t,n,o,i,r),this.createPhysics()},t.prototype.createPhysics=function(){this.shape=new p2.Box({width:this.elementImg.width*P2World.d2pFactor,height:this.elementImg.height*P2World.d2pFactor}),this.shape.material=P2World.Instance.itemMat,this.body=P2World.Instance.getBody(),this.body.position=[P2World.Instance.d2pX(this.elementImg.x),P2World.Instance.d2pY(this.elementImg.y)],this.body.flag="ironbox",this.body.mass=2,this.body.damping=.01,this.body.angle=this.elementImg.rotation,this.body.type=p2.Body.DYNAMIC,this.body.addShape(this.shape),P2World.Instance.addBody(this.body),this.shape.collisionGroup=P2World.ITEM_GROUP,this.shape.collisionMask=P2World.ITEM_MASK,BeginContactEvent.Instance.on(this.body.id,this.onBeginContact,this)},t.prototype.onBeginContact=function(e){var t=e.bodyA,n=e.bodyB,o=this.body.id==t.id?n:t;if(o.shapes[0].collisionGroup==P2World.BULLET_GROUP&&App.Sound.playEffect("hitiron.mp3"),o.shapes[0].collisionGroup==P2World.TERRAIN_GROUP){var i=this.body.velocity[0]*this.body.velocity[0]+this.body.velocity[1]*this.body.velocity[1];i>16&&App.Sound.playEffect("hitrock.mp3",.8)}},t.prototype.update=function(){e.prototype.update.call(this)},t.prototype.clear=function(){e.prototype.clear.call(this),BeginContactEvent.Instance.off(this.body.id),this.body=null},t}(LevelElementObj);__reflect(IronBoxObj.prototype,"IronBoxObj");var IronBoxPos=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.createObj=function(){e.prototype.createObj.call(this),this.obj=LevelElementManager.Instance.createElement(ELevelElementType.IRONBOX),this.obj.init(this.x,this.y,this.width,this.height,this.rotation)},t}(ObjPos);__reflect(IronBoxPos.prototype,"IronBoxPos"),window.IronBoxPos=IronBoxPos;var IronStripObj=function(e){function t(){var t=e.call(this)||this;return t.imgName="ironstrip",t.type=ELevelElementType.IRONSTRIP,t}return __extends(t,e),t.prototype.init=function(t,n,o,i,r){e.prototype.createElement.call(this,this.imgName,t,n,o,i,r),this.elementImg.scale9Grid=new egret.Rectangle(21,8,127,5),this.createPhysics()},t.prototype.createPhysics=function(){this.shape=new p2.Box({width:this.elementImg.width*P2World.d2pFactor,height:this.elementImg.height*P2World.d2pFactor}),this.shape.material=P2World.Instance.itemMat,this.body=P2World.Instance.getBody(),this.body.angle=this.elementImg.rotation/180*Math.PI,this.body.angularVelocity=0,this.body.position=[P2World.Instance.d2pX(this.elementImg.x),P2World.Instance.d2pY(this.elementImg.y)],this.body.flag="ironstrip",this.body.type=p2.Body.DYNAMIC,this.body.mass=1,this.body.addShape(this.shape),P2World.Instance.addBody(this.body),this.shape.collisionGroup=P2World.ITEM_GROUP,this.shape.collisionMask=P2World.ITEM_MASK},t.prototype.update=function(){null!=this.elementImg&&null!=this.body&&e.prototype.update.call(this)},t.prototype.clear=function(){this.body.removeShape(this.shape),P2World.Instance.removeBody(this.body),e.prototype.clear.call(this)},t}(LevelElementObj);__reflect(IronStripObj.prototype,"IronStripObj");var IronStripPos=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.createObj=function(){e.prototype.createObj.call(this),this.obj=LevelElementManager.Instance.createElement(ELevelElementType.IRONSTRIP),this.obj.init(this.x,this.y,this.width,this.height,this.rotation)},t}(ObjPos);__reflect(IronStripPos.prototype,"IronStripPos"),window.IronStripPos=IronStripPos;var ELevelElementType;!function(e){e[e.WOODBOX=0]="WOODBOX",e[e.IRONBOX=1]="IRONBOX",e[e.IRONBALL=2]="IRONBALL",e[e.BOOMBOX=3]="BOOMBOX",e[e.WOODSTRIP=4]="WOODSTRIP",e[e.STATICTHORN=5]="STATICTHORN",e[e.STATICWOODSTRIP=6]="STATICWOODSTRIP",e[e.SPINIRONSTRIP=7]="SPINIRONSTRIP",e[e.IRONSTRIP=8]="IRONSTRIP",e[e.STATICIRONSTRIP=9]="STATICIRONSTRIP",e[e.SINGLETERRAIN=10]="SINGLETERRAIN",e[e.THORN=11]="THORN",e[e.LINE=12]="LINE",e[e.STATICWOODBOX=13]="STATICWOODBOX",e[e.length=14]="length"}(ELevelElementType||(ELevelElementType={}));var LevelElementManager=function(){function e(){this.pools=new Array,this.elements=new Array,this.removeElementArray=new Array,this.createFunction=new Array,this.woodBoxs=[],this.ironBoxs=[],this.ironBalls=[],this.boomBoxs=[],this.woodStrips=[],this.staticThorns=[],this.staticWoodStrips=[],this.ironStrips=[],this.staticIronStrips=[],this.spinIronStrips=[],this.singleTerrains=[],this.thorns=[],this.staticWoodBoxPos=[],this.lines=[],this.explosionPool=new ObjectPool,this.explosions=[],this.removeExplosions=[],e.Instance=this,this.register(ELevelElementType.WOODBOX,function(){return new WoodBoxObj},this.woodBoxs),this.register(ELevelElementType.STATICWOODBOX,function(){return new StaticWoodBoxObj
},this.staticWoodBoxPos),this.register(ELevelElementType.IRONBOX,function(){return new IronBoxObj},this.ironBoxs),this.register(ELevelElementType.IRONBALL,function(){return new IronBallObj},this.ironBalls),this.register(ELevelElementType.BOOMBOX,function(){return new BoomBoxObj},this.boomBoxs),this.register(ELevelElementType.WOODSTRIP,function(){return new WoodStripObj},this.woodStrips),this.register(ELevelElementType.STATICTHORN,function(){return new StaticThornObj},this.staticThorns),this.register(ELevelElementType.STATICWOODSTRIP,function(){return new StaticWoodStripObj},this.staticWoodStrips),this.register(ELevelElementType.IRONSTRIP,function(){return new IronStripObj},this.ironStrips),this.register(ELevelElementType.STATICIRONSTRIP,function(){return new StaticIronStripObj},this.staticIronStrips),this.register(ELevelElementType.SPINIRONSTRIP,function(){return new SpinIronStripObj},this.spinIronStrips),this.register(ELevelElementType.SINGLETERRAIN,function(){return new SingleTerrainObj},this.singleTerrains),this.register(ELevelElementType.THORN,function(){return new ThornObj},this.thorns),this.register(ELevelElementType.LINE,function(){return new LineObj},this.lines)}return e.prototype.register=function(e,t,n){this.createFunction[e]=t,this.pools[e]=new ObjectPool,this.elements[e]=n,this.removeElementArray[e]=new Array},e.prototype.update=function(e){this.updateRemove();for(var t=0;t<this.elements.length;t++)for(var n=this.elements[t],o=0;o<n.length;o++)n[o].update();for(var t=0;t<this.explosions.length;t++)this.explosions[t].update()},e.prototype.createElement=function(e){var t=this.pools[e].popObj();return null==t&&(t=this.createFunction[e].call(this)),this.elements[e].push(t),t},e.prototype.removeElement=function(e){var t=this.elements[e.type].indexOf(e);this.removeElementArray[e.type].indexOf(t)<0&&this.removeElementArray[e.type].push(t)},e.prototype.removeAllElement=function(){for(var e,t=0;t<ELevelElementType.length;t++){var n=this.elements[t];null==n&&console.error("关卡元素数组存在错误");for(var o=0;o<n.length;o++)e=n[o],e.removeRemoveFunc(),e.clear(),this.pools[t].pushObj(e);n.splice(0)}for(var i,t=0;t<this.explosions.length;t++)i=this.explosions[t],i.clear(),this.explosionPool.pushObj(i);this.explosions.splice(0)},e.prototype.clear=function(){this.removeAllElement()},e.prototype.updateRemove=function(){for(var e,t,n=0;n<ELevelElementType.length;n++){var o=this.removeElementArray[n];if(null!=o){if(0!=o.length){for(var i=0;i<o.length;i++)t=o[i],e=this.elements[n][t],e.clear(),this.pools[n].pushObj(e);o=App.mergeSort(o);for(var i=o.length-1;i>=0;i--)t=o[i],this.elements[n].splice(t,1);this.removeElementArray[n].splice(0),this.breakSleep()}}else console.error("关卡元素出错了")}for(var r,n=0;n<this.removeExplosions.length;n++)t=this.removeExplosions[n],r=this.explosions[t],r.clear(),this.explosionPool.pushObj(r);this.removeExplosions=App.mergeSort(this.removeExplosions);for(var n=this.removeExplosions.length-1;n>=0;n--)t=this.removeExplosions[n],this.explosions.splice(t,1);this.removeExplosions.splice(0)},e.prototype.breakSleep=function(){for(var e,t=0;t<ELevelElementType.length;t++){var n=this.elements[t];if(null!=n)for(var o=0;o<n.length;o++){if(e=n[o],e instanceof LineObj){e.breakSleep();break}e.body.type==p2.Body.DYNAMIC&&(e.body.sleepState=p2.Body.AWAKE,e.body.velocity=[0,.1],e.body.updateMassProperties())}else console.error("关卡元素出错了")}},e.prototype.judgeSleep=function(){for(var e,t=0;t<ELevelElementType.length;t++){var n=this.elements[t];if(null!=n)for(var o=0;o<n.length;o++){if(e=n[o],e instanceof LineObj){if(e.judgeSleep())return!1;break}if(Math.abs(e.body.velocity[0])>1)return!1;if(Math.abs(e.body.velocity[1])>1)return!1}else console.error("关卡元素出错了")}return!0},e.prototype.createExplosion=function(e,t,n,o,i){var r=this.explosionPool.popObj();return null==r&&(r=new ExplosionObj),this.explosions.push(r),r.init(e,t,n,o,i),r},e.prototype.removeExplosion=function(e){var t=this.explosions.indexOf(e);this.removeExplosions.indexOf(t)<0&&this.removeExplosions.push(t)},e}();__reflect(LevelElementManager.prototype,"LevelElementManager");var EViewState;!function(e){e[e.NONE=0]="NONE",e[e.INITING=1]="INITING",e[e.INITED=2]="INITED",e[e.DESTORY=3]="DESTORY"}(EViewState||(EViewState={}));var LineObj=function(e){function t(){var t=e.call(this)||this;return t.imgName="line",t.mass=0,t.shapeArr=[],t.bodyArr=[],t.constraintArr=[],t.eImgArr=[],t.type=ELevelElementType.LINE,t}return __extends(t,e),t.prototype.init=function(e,t,n,o,i,r){this.createElementObj(e,t,n,o,i,r),this.createLineObj(e,t,n,o,i,r),this.bindLine()},t.prototype.createImg=function(e,t,n,o,i,r){var s=new eui.Image;return s.source=e,s.x=t,s.y=n,s.width=o,s.height=i,s.rotation=r,s.anchorOffsetX=o/2,s.anchorOffsetY=i/2,GameMap.Instance.levelLayer.addChild(s),this.eImgArr.push(s),s},t.prototype.createElementObj=function(e,t,n,o,i,r){null!==r.topType&&void 0!==r.topType&&(this.eObj1=LevelElementManager.Instance.createElement(r.topType),this.eObj1.init(e,t-o/2,r.topWidth,r.topHeight,r.topRotation),this.eObj1.addRemoveFunc(this.chipRemove,this)),null!==r.downType&&void 0!==r.downType&&(this.eObj2=LevelElementManager.Instance.createElement(r.downType),this.eObj2.init(e,t+o/2-2*r.lineLength,r.downWidth,r.downHeight,r.downRotation),this.eObj2.addRemoveFunc(this.chipRemove,this))},t.prototype.addChipRemoveFunc=function(e,t){this.chipRemoveFunc=e,this.chipRemoveObj=t},t.prototype.chipRemove=function(){this.eObj1&&this.eObj1.isDie&&(this.chipRemoveFunc&&this.chipRemoveFunc.call(this.chipRemoveObj,"top"),this.eObj1=null),this.eObj2&&this.eObj2.isDie&&(this.chipRemoveFunc&&this.chipRemoveFunc.call(this.chipRemoveObj,"down"),this.eObj2=null)},t.prototype.createLineObj=function(e,t,n,o,i,r){var s=r.lineLength,a=o/2;o=Math.floor(o/s);for(var l=0;s>l;l++){var p=this.createImg(this.imgName,e,t-a+o*l-2*l,n,o,i),h=P2World.Instance.getBody();h.angle=0,h.sleepState=p2.Body.AWAKE,h.position=[P2World.Instance.d2pX(p.x),P2World.Instance.d2pY(p.y)],h.flag="Line",h.allowSleep=!1,h.damping=.5,h.mass=1,h.type=0!=l||this.eObj1?p2.Body.DYNAMIC:p2.Body.STATIC;var c=new p2.Circle({radius:p.width/2*P2World.d2pFactor});if(h.addShape(c),P2World.Instance.addBody(h),h.updateMassProperties(),c.material=P2World.Instance.itemMat,c.collisionGroup=P2World.ITEM_GROUP,c.collisionMask=P2World.LINE_MASK,this.bodyArr.push(h),this.shapeArr.push(c),BeginContactEvent.Instance.on(h.id,this.onBeginContact,this),0!=l){var u=this.bodyArr[l-1],d=new p2.RevoluteConstraint(u,h,{worldPivot:[(u.position[0]+h.position[0])/2,(u.position[1]+h.position[1])/2]});d.upperLimitEnabled=!0,d.lowerLimitEnabled=!0,P2World.Instance.addConstraint(d),this.constraintArr.push(d)}}},t.prototype.bindLine=function(){if(this.eObj1){var e=this.bodyArr[0],t=new p2.DistanceConstraint(e,this.eObj1.body);P2World.Instance.addConstraint(t),this.constraintArr.push(t)}if(this.eObj2){var e=this.bodyArr[this.bodyArr.length-1],t=new p2.DistanceConstraint(e,this.eObj2.body);P2World.Instance.addConstraint(t),this.constraintArr.push(t)}},t.prototype.update=function(){this.updateOutBounds(),this.updateDisplay()},t.prototype.updateOutBounds=function(){for(var e,t,n=GameMap.Instance.width,o=GameMap.Instance.height,i=this.eImgArr.length,r=0,s=0;i>s;s++){var a=(this.eImgArr[s],this.bodyArr[s]);e=P2World.Instance.p2dX(a.position[0]),-n>e||e>2*n?r++:(t=P2World.Instance.p2dY(a.position[1]),(-n>t||t>2*o)&&r++)}r>=Math.floor(i/2)&&LevelElementManager.Instance.removeElement(this)},t.prototype.breakSleep=function(){for(var e=this.bodyArr.length,t=0;e>t;t++){var n=this.bodyArr[t];n.type==p2.Body.DYNAMIC&&(n.sleepState=p2.Body.AWAKE,n.velocity=[0,.1],n.updateMassProperties())}},t.prototype.judgeSleep=function(){var e=this.bodyArr[Math.floor(this.bodyArr.length/2)];return e?Math.abs(e.velocity[0])>1?!0:Math.abs(e.velocity[1])>1?!0:!1:!1},t.prototype.updateDisplay=function(){for(var e=this.eImgArr.length,t=0;e>t;t++){var n=this.eImgArr[t],o=this.bodyArr[t];n.x=P2World.Instance.p2dX(o.position[0]),n.y=P2World.Instance.p2dY(o.position[1]),o.shapes.length&&(n.rotation=180*(o.angle+o.shapes[0].angle)/Math.PI);var i=this.eImgArr[t-1];if(i){var r=Math.sqrt(Math.pow(Math.abs(i.x-n.x),2)+Math.pow(Math.abs(i.y-n.y),2));i.height=r,i.anchorOffsetY=r/2}}},t.prototype.clear=function(){for(var t=this.eImgArr.length,n=0;t>n;n++){var o=this.eImgArr[n],i=this.bodyArr[n],r=this.shapeArr[n];i.removeShape(r),GameMap.Instance.levelLayer.removeChild(o),P2World.Instance.removeBody(i)}for(var s=0,a=this.constraintArr;s<a.length;s++){var l=a[s];P2World.Instance.removeConstraint(l)}this.eObj1=null,this.eObj2=null,this.chipRemoveFunc=null,this.chipRemoveObj=null,this.eImgArr=[],this.bodyArr=[],this.shapeArr=[],this.constraintArr=[],e.prototype.clear.call(this)},t.prototype.onBeginContact=function(e){e.bodyA,e.bodyB},t}(LevelElementObj);__reflect(LineObj.prototype,"LineObj");var LinePos=function(e){function t(){var t=e.call(this)||this;return t.topType=null,t.topWidth=100,t.topHeight=100,t.topRotation=0,t.downType=ELevelElementType.IRONBOX,t.downWidth=100,t.downHeight=100,t.downRotation=0,t.mass=1,t.lineLength=10,t}return __extends(t,e),t.prototype.createObj=function(){e.prototype.createObj.call(this),this.obj=LevelElementManager.Instance.createElement(ELevelElementType.LINE),this.obj.mass=this.mass,this.obj.init(this.x,this.y,this.width,this.height,this.rotation,{topType:this.topType,topWidth:this.topWidth,topHeight:this.topHeight,topRotation:this.topRotation,downType:this.downType,downWidth:this.downWidth,downHeight:this.downHeight,downRotation:this.downRotation,lineLength:this.lineLength})},t}(ObjPos);__reflect(LinePos.prototype,"LinePos"),window.LinePos=LinePos;var SingleTerrainObj=function(e){function t(){var t=e.call(this)||this;return t.sideWidth=20,t}return __extends(t,e),t.prototype.init=function(e,t,n,o,i){this.bg=new eui.Image("terrainbg"),this.bg.x=e+n/2,this.bg.y=t+o/2,this.bg.width=n,this.bg.height=o,this.bg.rotation=0,this.bg.anchorOffsetX=n/2,this.bg.anchorOffsetY=o/2,this.side1=new eui.Image("terrain"),this.side1.x=e,this.side1.y=t,this.side1.width=this.sideWidth,this.side1.height=o,this.side2=new eui.Image("terrain"),this.side2.x=e,this.side2.y=t,this.side2.width=n,this.side2.height=this.sideWidth,this.side3=new eui.Image("terrain"),this.side3.x=e+n-this.sideWidth,this.side3.y=t,this.side3.width=this.sideWidth,this.side3.height=o,this.side4=new eui.Image("terrain"),this.side4.x=e,this.side4.y=t+o-this.sideWidth,this.side4.width=n,this.side4.height=this.sideWidth,GameMap.Instance.levelLayer.addChild(this.bg),GameMap.Instance.levelLayer.addChild(this.side1),GameMap.Instance.levelLayer.addChild(this.side2),GameMap.Instance.levelLayer.addChild(this.side3),GameMap.Instance.levelLayer.addChild(this.side4),this.createPhysics()},t.prototype.createPhysics=function(){this.shape=new p2.Box({width:this.bg.width*P2World.d2pFactor,height:this.bg.height*P2World.d2pFactor}),this.body=P2World.Instance.getBody(),this.body.position=[P2World.Instance.d2pX(this.bg.x),P2World.Instance.d2pY(this.bg.y)],this.body.flag="terrion",this.body.mass=2,this.body.damping=.01,this.body.type=p2.Body.STATIC,this.body.addShape(this.shape),P2World.Instance.addBody(this.body),this.shape.collisionGroup=P2World.ITEM_GROUP,this.shape.collisionMask=P2World.ITEM_MASK},t.prototype.clear=function(){GameMap.Instance.levelLayer.removeChild(this.bg),GameMap.Instance.levelLayer.removeChild(this.side1),GameMap.Instance.levelLayer.removeChild(this.side2),GameMap.Instance.levelLayer.removeChild(this.side3),GameMap.Instance.levelLayer.removeChild(this.side4),P2World.Instance.removeBody(this.body),this.body=null},t}(LevelElementObj);__reflect(SingleTerrainObj.prototype,"SingleTerrainObj");var SingleTerrainPos=function(e){function t(){var t=e.call(this)||this;return t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t}return __extends(t,e),t.prototype.onAddToStage=function(){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.createObj(),this.parent.removeChild(this)},t.prototype.createObj=function(){this.obj=LevelElementManager.Instance.createElement(ELevelElementType.SINGLETERRAIN),this.obj.init(this.x,this.y,this.width,this.height,this.rotation)},t}(eui.Group);__reflect(SingleTerrainPos.prototype,"SingleTerrainPos"),window.SingleTerrainPos=SingleTerrainPos;var SpinIronStripObj=function(e){function t(){var t=e.call(this)||this;return t.imgName="ironstrip",t.mass=1,t.type=ELevelElementType.SPINIRONSTRIP,t}return __extends(t,e),t.prototype.init=function(t,n,o,i,r,s,a){e.prototype.createElement.call(this,this.imgName,t,n,o,i,r),this.createNail(t,n,o,i,s,a),this.createPhysics()},t.prototype.createNail=function(e,t,n,o,i,r){this.nail=new eui.Image("nail"),this.nail.x=i-n/2+e,this.nail.y=r-o/2+t,this.nail.width=20,this.nail.height=20,this.nail.anchorOffsetX=10,this.nail.anchorOffsetY=10,GameMap.Instance.levelLayer.addChild(this.nail)},t.prototype.clearNail=function(){P2World.Instance.removeBody(this.body2),GameMap.Instance.levelLayer.removeChild(this.nail)},t.prototype.createPhysics=function(){this.shape=new p2.Box({width:this.elementImg.width*P2World.d2pFactor,height:this.elementImg.height*P2World.d2pFactor}),this.body=P2World.Instance.getBody(),this.body.angle=this.elementImg.rotation/180*Math.PI,this.body.angularVelocity=0,this.body.position=[P2World.Instance.d2pX(this.elementImg.x),P2World.Instance.d2pY(this.elementImg.y)],this.body.flag="ironstrip",this.body.type=p2.Body.DYNAMIC,this.body.allowSleep=!1,this.body.mass=this.mass,this.body.addShape(this.shape),this.body2=P2World.Instance.getBody();var e=new p2.Particle;this.body2.addShape(e),this.body2.position=[P2World.Instance.d2pX(this.nail.x),P2World.Instance.d2pY(this.nail.y)],this.constraint=new p2.RevoluteConstraint(this.body2,this.body,{worldPivot:[this.body2.position[0],this.body2.position[1]]}),P2World.Instance.addBody(this.body),P2World.Instance.addBody(this.body2),P2World.Instance.addConstraint(this.constraint),this.shape.collisionGroup=P2World.ITEM_GROUP,this.shape.collisionMask=P2World.ITEM_MASK},t.prototype.onBeginContact=function(e){e.bodyA,e.bodyB},t.prototype.update=function(){null!=this.elementImg&&null!=this.body&&e.prototype.update.call(this)},t.prototype.clear=function(){this.body.removeShape(this.shape),this.clearNail(),P2World.Instance.removeBody(this.body),P2World.Instance.removeConstraint(this.constraint),e.prototype.clear.call(this)},t}(LevelElementObj);__reflect(SpinIronStripObj.prototype,"SpinIronStripObj");var SpinIronStripPos=function(e){function t(){var t=e.call(this)||this;return t.nailX=0,t.nailY=0,t.mass=1,t}return __extends(t,e),t.prototype.createObj=function(){e.prototype.createObj.call(this),this.obj=LevelElementManager.Instance.createElement(ELevelElementType.SPINIRONSTRIP),this.obj.mass=this.mass,this.obj.init(this.x,this.y,this.width,this.height,this.rotation,this.nailX,this.nailY)},t}(ObjPos);__reflect(SpinIronStripPos.prototype,"SpinIronStripPos"),window.SpinIronStripPos=SpinIronStripPos;var StaticIronStripObj=function(e){function t(){var t=e.call(this)||this;return t.imgName="ironstrip",t.type=ELevelElementType.STATICIRONSTRIP,t}return __extends(t,e),t.prototype.init=function(t,n,o,i,r){e.prototype.createElement.call(this,this.imgName,t,n,o,i,r),GameMap.Instance.levelLayer.addChild(this.elementImg),this.createPhysics()},t.prototype.createNail=function(){var e=new eui.Image("nail");this.nail=e,e.x=this.elementImg.x-this.elementImg.width/2+20,e.y=this.elementImg.y,e.width=20,e.height=20,e.anchorOffsetX=10,e.anchorOffsetY=10,GameMap.Instance.levelLayer.addChild(e);var t=new eui.Image("nail");this.nail2=t,t.x=this.elementImg.x+this.elementImg.width/2-20,t.y=this.elementImg.y,t.width=20,t.height=20,t.anchorOffsetX=10,t.anchorOffsetY=10,GameMap.Instance.levelLayer.addChild(t)},t.prototype.createPhysics=function(){this.shape=new p2.Box({width:this.elementImg.width*P2World.d2pFactor,height:this.elementImg.height*P2World.d2pFactor}),this.body=P2World.Instance.getBody(),this.body.angle=this.elementImg.rotation/180*Math.PI,this.body.angularVelocity=0,this.body.position=[P2World.Instance.d2pX(this.elementImg.x),P2World.Instance.d2pY(this.elementImg.y)],this.body.flag="staticironstrip",this.body.type=p2.Body.STATIC,this.body.mass=10,this.body.addShape(this.shape),P2World.Instance.addBody(this.body),this.shape.collisionGroup=P2World.ITEM_GROUP,this.shape.collisionMask=P2World.ITEM_MASK},t.prototype.update=function(){null!=this.elementImg&&null!=this.body&&e.prototype.update.call(this)},t.prototype.clear=function(){this.body.removeShape(this.shape),P2World.Instance.removeBody(this.body),e.prototype.clear.call(this)},t}(LevelElementObj);__reflect(StaticIronStripObj.prototype,"StaticIronStripObj");var StaticIronStripPos=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.createObj=function(){e.prototype.createObj.call(this),this.obj=LevelElementManager.Instance.createElement(ELevelElementType.STATICIRONSTRIP),this.obj.init(this.x,this.y,this.width,this.height,this.rotation)},t}(ObjPos);__reflect(StaticIronStripPos.prototype,"StaticIronStripPos"),window.StaticIronStripPos=StaticIronStripPos;var StaticThornObj=function(e){function t(){var t=e.call(this)||this;return t.imgName="thorn",t.tmpX=[],t.tmpY=[],t.tmpBody=[],t.type=ELevelElementType.STATICTHORN,t}return __extends(t,e),t.prototype.init=function(e,t,n,o,i){this.elementImg=new eui.Image,this.elementImg.source=this.imgName,this.elementImg.fillMode="repeat",this.elementImg.x=e,this.elementImg.y=t,this.elementImg.width=n,this.elementImg.height=o,this.elementImg.anchorOffsetX=n/2,this.elementImg.anchorOffsetY=o/2,this.elementImg.rotation=i,GameMap.Instance.levelLayer.addChild(this.elementImg),this.createPhysics()},t.prototype.createPhysics=function(){this.shape=new p2.Box({width:(this.elementImg.width-20)*P2World.d2pFactor,height:this.elementImg.height*P2World.d2pFactor/2}),this.body=P2World.Instance.getBody(),this.body.position=[P2World.Instance.d2pX(this.elementImg.x),P2World.Instance.d2pY(this.elementImg.y)],this.body.flag="thron",this.body.type=p2.Body.STATIC,this.body.angle=this.elementImg.rotation/180*Math.PI,this.body.angularVelocity=0,this.body.mass=1,this.body.addShape(this.shape),P2World.Instance.addBody(this.body),this.shape.collisionGroup=P2World.ITEM_GROUP,this.shape.collisionMask=P2World.ITEM_MASK,BeginContactEvent.Instance.on(this.body.id,this.onBeginContact,this)},t.prototype.pushObj=function(e){e.type=p2.Body.STATIC,e.velocity=[0,0],e.angularVelocity=0,e.updateMassProperties(),this.tmpBody.push(e),this.tmpX.push(P2World.Instance.p2dX(e.position[0])-this.elementImg.x),this.tmpY.push(P2World.Instance.p2dX(e.position[1])-this.elementImg.y)},t.prototype.onBeginContact=function(e){var t=e.bodyA,n=e.bodyB,o=t==this.body?n:t;if(o.shapes[0].collisionGroup==P2World.BODY_GROUP){var i=o.velocity[0]*o.velocity[0]+o.velocity[1]*o.velocity[1];i>16&&(this.pushObj(o),App.Sound.playEffect("strick.mp3",.3),MCEffectController.Instance.playeEffect("bx",o.position[0]*P2World.p2dFactor,o.position[1]*P2World.p2dFactor,9,192,250,96,125,360*Math.random(),1,1),EffectController.Instance.blood.play(o.position[0]*P2World.p2dFactor,o.position[1]*P2World.p2dFactor))}},t.prototype.update=function(){if(null!=this.elementImg&&null!=this.body){e.prototype.update.call(this);for(var t=0;t<this.tmpBody.length;t++){var n=this.tmpBody[t];n.position[0]=P2World.Instance.d2pX(this.tmpX[t]+this.elementImg.x),n.position[1]=P2World.Instance.d2pX(this.tmpY[t]+this.elementImg.y)}}},t.prototype.test=function(){console.log("test1111"),this.body.position[0]=this.body.position[0]+1},t.prototype.clear=function(){this.body.removeShape(this.shape),P2World.Instance.removeBody(this.body),this.tmpBody.splice(0),this.tmpX.splice(0),this.tmpY.splice(0),e.prototype.clear.call(this)},t}(LevelElementObj);__reflect(StaticThornObj.prototype,"StaticThornObj");var StaticThornPos=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.createObj=function(){e.prototype.createObj.call(this),this.obj=LevelElementManager.Instance.createElement(ELevelElementType.STATICTHORN),this.obj.init(this.x,this.y,this.width,this.height,this.rotation)},t}(ObjPos);__reflect(StaticThornPos.prototype,"StaticThornPos"),window.StaticThornPos=StaticThornPos;var StaticWoodBoxObj=function(e){function t(){var t=e.call(this)||this;return t.type=ELevelElementType.STATICWOODBOX,t}return __extends(t,e),t.prototype.getBodyType=function(){return p2.Body.STATIC},t.prototype.init=function(t,n,o,i,r){e.prototype.init.call(this,t,n,o,i,r)},t}(WoodBoxObj);__reflect(StaticWoodBoxObj.prototype,"StaticWoodBoxObj");var StaticWoodBoxPos=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.createObj=function(){e.prototype.createObj.call(this),this.obj=LevelElementManager.Instance.createElement(ELevelElementType.STATICWOODBOX),this.obj.init(this.x,this.y,this.width,this.height,this.rotation)},t}(ObjPos);__reflect(StaticWoodBoxPos.prototype,"StaticWoodBoxPos"),window.StaticWoodBoxPos=StaticWoodBoxPos;var StaticWoodStripObj=function(e){function t(){var t=e.call(this)||this;return t.imgName="woodstrip",t.type=ELevelElementType.STATICWOODSTRIP,t}return __extends(t,e),t.prototype.init=function(t,n,o,i,r){e.prototype.createElement.call(this,this.imgName,t,n,o,i,r),this.createPhysics()},t.prototype.createNail=function(){var e=new eui.Image("nail");this.nail=e,e.x=this.elementImg.x-this.elementImg.width/2+25,e.y=this.elementImg.y,e.x+=(1-Math.cos(180*this.elementImg.rotation/Math.PI))*(this.elementImg.width/2+25),e.y-=Math.sin(180*this.elementImg.rotation/Math.PI)*this.elementImg.width/2,e.width=20,e.height=20,e.anchorOffsetX=10,e.anchorOffsetY=10,GameMap.Instance.levelLayer.addChild(e);var t=new eui.Image("nail");this.nail2=t,t.x=this.elementImg.x+this.elementImg.width/2-20,t.y=this.elementImg.y,t.x-=(1-Math.cos(180*this.elementImg.rotation/Math.PI))*(this.elementImg.width/2+25),t.y+=Math.sin(180*this.elementImg.rotation/Math.PI)*this.elementImg.width/2,t.width=20,t.height=20,t.anchorOffsetX=10,t.anchorOffsetY=10,GameMap.Instance.levelLayer.addChild(t)},t.prototype.createPhysics=function(){this.shape=new p2.Box({width:this.elementImg.width*P2World.d2pFactor,height:this.elementImg.height*P2World.d2pFactor}),this.body=P2World.Instance.getBody(),this.body.angle=this.elementImg.rotation/180*Math.PI,this.body.angularVelocity=0,this.body.position=[P2World.Instance.d2pX(this.elementImg.x),P2World.Instance.d2pY(this.elementImg.y)],this.body.flag="staticwoodstrip",this.body.type=p2.Body.STATIC,this.body.mass=5,this.body.addShape(this.shape),P2World.Instance.addBody(this.body),this.shape.collisionGroup=P2World.ITEM_GROUP,this.shape.collisionMask=P2World.ITEM_MASK,BeginContactEvent.Instance.on(this.body.id,this.onBeginContact,this)},t.prototype.woodBreak=function(){App.Sound.playEffect("hitwood.mp3"),EffectController.Instance.dust.play(this.elementImg.x,this.elementImg.y,.5*this.elementImg.width,.5*this.elementImg.height,4,2),EffectController.Instance.wood2.play(this.elementImg.x,this.elementImg.y,.3*this.elementImg.width,0,4,1,2),LevelElementManager.Instance.removeElement(this)},t.prototype.onBeginContact=function(e){var t=e.bodyA,n=e.bodyB,o=t==this.body?n:t;if(o.shapes[0].collisionGroup==P2World.BULLET_GROUP)return void this.woodBreak();if(o.shapes[0].collisionGroup==P2World.BOOM_GROUP)return void this.woodBreak();var i=o.velocity[0]*o.velocity[0]+o.velocity[1]*o.velocity[1];return i>9?void this.woodBreak():void 0},t.prototype.update=function(){null!=this.elementImg&&null!=this.body&&e.prototype.update.call(this)},t.prototype.clear=function(){BeginContactEvent.Instance.off(this.body.id),this.body.removeShape(this.shape),P2World.Instance.removeBody(this.body),e.prototype.clear.call(this)},t}(LevelElementObj);__reflect(StaticWoodStripObj.prototype,"StaticWoodStripObj");var StaticWoodStripPos=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.createObj=function(){e.prototype.createObj.call(this),this.obj=LevelElementManager.Instance.createElement(ELevelElementType.STATICWOODSTRIP),this.obj.init(this.x,this.y,this.width,this.height,this.rotation)},t}(ObjPos);__reflect(StaticWoodStripPos.prototype,"StaticWoodStripPos"),window.StaticWoodStripPos=StaticWoodStripPos;var TerrainObj=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.getTerrin=function(){},t}(eui.Group);__reflect(TerrainObj.prototype,"TerrainObj"),window.TerrainObj=TerrainObj;var ThornObj=function(e){function t(){var t=e.call(this)||this;return t.imgName="thorn",t.maxBody=1,t.tmpBody=[],t.tmpR=[],t.pdoxy=[0,0],t.type=ELevelElementType.THORN,t}return __extends(t,e),t.prototype.init=function(e,t,n,o,i){this.elementImg=new eui.Image,this.elementImg.source=this.imgName,this.elementImg.x=e,this.elementImg.y=t,this.elementImg.width=n,this.elementImg.height=o,this.elementImg.anchorOffsetX=n/2,this.elementImg.anchorOffsetY=o/2,this.elementImg.rotation=i,this.elementImg.fillMode="repeat",GameMap.Instance.levelLayer.addChild(this.elementImg),this.createPhysics()},t.prototype.createPhysics=function(){var e=this.elementImg.width,t=5*this.elementImg.height/7;this.pdoxy[0]=(e-this.elementImg.width)*P2World.d2pFactor*.5,this.pdoxy[1]=(t-this.elementImg.height)*P2World.d2pFactor*.5,this.shape=new p2.Box({width:e*P2World.d2pFactor,height:t*P2World.d2pFactor}),this.shape.material=P2World.Instance.itemMat,this.body=P2World.Instance.getBody(),this.body.position=[P2World.Instance.d2pX(this.elementImg.x),P2World.Instance.d2pY(this.elementImg.y)],this.body.flag="thron",this.body.type=p2.Body.DYNAMIC,this.body.angle=this.elementImg.rotation/180*Math.PI,this.body.angularVelocity=0,this.body.mass=.5,this.body.addShape(this.shape),P2World.Instance.addBody(this.body),this.shape.collisionGroup=P2World.ITEM_GROUP,this.shape.collisionMask=P2World.ITEM_MASK,BeginContactEvent.Instance.on(this.body.id,this.onBeginContact,this)},t.prototype.pushObj=function(e){if(!(this.tmpBody.indexOf(e)>=0||this.tmpBody.length>=this.maxBody)){var t=new p2.LockConstraint(this.body,e);P2World.Instance.addConstraint(t),this.tmpR.push(t),this.tmpBody.push(e)}},t.prototype.onBeginContact=function(e){var t=e.bodyA,n=e.bodyB,o=t==this.body?n:t;if(o.shapes[0].collisionGroup==P2World.BODY_GROUP){var i=o.velocity[0]*o.velocity[0]+o.velocity[1]*o.velocity[1];if(i>16)return this.pushObj(o),App.Sound.playEffect("strick.mp3",.3),MCEffectController.Instance.playeEffect("bx",o.position[0]*P2World.p2dFactor,o.position[1]*P2World.p2dFactor,9,192,250,96,125,360*Math.random(),1,1),void EffectController.Instance.blood.play(o.position[0]*P2World.p2dFactor,o.position[1]*P2World.p2dFactor);var r=this.body.velocity[0]*this.body.velocity[0]+this.body.velocity[1]*this.body.velocity[1];if(r>16)return this.pushObj(o),App.Sound.playEffect("strick.mp3",.3),MCEffectController.Instance.playeEffect("bx",o.position[0]*P2World.p2dFactor,o.position[1]*P2World.p2dFactor,9,192,250,96,125,360*Math.random(),1,1),void EffectController.Instance.blood.play(o.position[0]*P2World.p2dFactor,o.position[1]*P2World.p2dFactor)}},t.prototype.update=function(){null!=this.elementImg&&null!=this.body&&e.prototype.update.call(this)},t.prototype.updateDisplay=function(){this.body.toWorldFrame(t.tmp,this.pdoxy),this.elementImg.x=P2World.Instance.p2dX(t.tmp[0]),this.elementImg.y=P2World.Instance.p2dY(t.tmp[1]),this.elementImg.rotation=180*(this.body.angle+this.body.shapes[0].angle)/Math.PI},t.prototype.test=function(){console.log("test1111"),this.body.position[0]=this.body.position[0]+1},t.prototype.clear=function(){this.body.removeShape(this.shape),P2World.Instance.removeBody(this.body),this.tmpBody.splice(0),e.prototype.clear.call(this)},t.tmp=[0,0],t}(LevelElementObj);__reflect(ThornObj.prototype,"ThornObj");var ThornPos=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.createObj=function(){e.prototype.createObj.call(this),this.obj=LevelElementManager.Instance.createElement(ELevelElementType.THORN),this.obj.init(this.x,this.y,this.width,55,this.rotation)},t}(ObjPos);__reflect(ThornPos.prototype,"ThornPos"),window.ThornPos=ThornPos;var CommonVersionController=function(e){function t(){var n=e.call(this)||this;t.Instance=n,n.resourceURL=App.resourceURL,n.version=App.appVersion;var o=egret.localStorage.getItem("RESVERSION"),i=egret.localStorage.getItem("MINIRESVERSION");return(o!=n.version||App.GlobalConfigure.GetGlobalValue("version")!=i)&&(window.platform.removeLocalCache(),egret.localStorage.setItem("RESVERSION",n.version),egret.localStorage.setItem("MINIRESVERSION",App.GlobalConfigure.GetGlobalValue("version"))),n}return __extends(t,e),t.prototype.init=function(){return new Promise(function(e){e()})},t.prototype.getVirtualUrl=function(e){var n=e;return e.indexOf("https")>=0?n:0!=e.indexOf("wx")?e.indexOf(this.resourceURL)<0?n:n=t.Instance.resourceURL+e+"?v="+t.Instance.version:n},t}(egret.EventDispatcher);__reflect(CommonVersionController.prototype,"CommonVersionController",["RES.IVersionController"]);var WoodStripObj=function(e){function t(){var t=e.call(this)||this;return t.imgName="woodstrip",t.type=ELevelElementType.WOODSTRIP,t}return __extends(t,e),t.prototype.init=function(t,n,o,i,r){e.prototype.createElement.call(this,this.imgName,t,n,o,i,r),this.createPhysics()},t.prototype.createPhysics=function(){this.shape=new p2.Box({width:this.elementImg.width*P2World.d2pFactor,height:this.elementImg.height*P2World.d2pFactor}),this.body=P2World.Instance.getBody(),this.body.angle=0,this.body.angularVelocity=0,this.body.position=[P2World.Instance.d2pX(this.elementImg.x),P2World.Instance.d2pY(this.elementImg.y)],this.body.flag="woodstrip",this.body.type=p2.Body.DYNAMIC,this.body.mass=5,this.body.addShape(this.shape),P2World.Instance.addBody(this.body),this.shape.collisionGroup=P2World.ITEM_GROUP,this.shape.collisionMask=P2World.ITEM_MASK,BeginContactEvent.Instance.on(this.body.id,this.onBeginContact,this)},t.prototype.woodBreak=function(){App.Sound.playEffect("hitwood.mp3"),App.vibrateShort(),EffectController.Instance.dust.play(this.elementImg.x,this.elementImg.y,.5*this.elementImg.width,.5*this.elementImg.height,4,2),EffectController.Instance.wood2.play(this.elementImg.x,this.elementImg.y,.3*this.elementImg.width,0,4,1,2),LevelElementManager.Instance.removeElement(this)},t.prototype.onBeginContact=function(e){var t=e.bodyA,n=e.bodyB,o=t==this.body?n:t;if(o.shapes[0].collisionGroup==P2World.BULLET_GROUP)return void this.woodBreak();if(o.shapes[0].collisionGroup==P2World.BOOM_GROUP)return void this.woodBreak();var i=this.body.velocity[0]*this.body.velocity[0]+this.body.velocity[1]*this.body.velocity[1];if(i>9)return void this.woodBreak();var r=o.velocity[0]*o.velocity[0]+o.velocity[1]*o.velocity[1];return r>9?void this.woodBreak():void 0},t.prototype.update=function(){null!=this.elementImg&&null!=this.body&&e.prototype.update.call(this)},t.prototype.clear=function(){e.prototype.clear.call(this),BeginContactEvent.Instance.off(this.body.id),this.body=null},t}(LevelElementObj);__reflect(WoodStripObj.prototype,"WoodStripObj");var WoodStripPos=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.createObj=function(){e.prototype.createObj.call(this),this.obj=LevelElementManager.Instance.createElement(ELevelElementType.WOODSTRIP),this.obj.init(this.x,this.y,this.width,this.height,this.rotation)},t}(ObjPos);__reflect(WoodStripPos.prototype,"WoodStripPos"),window.WoodStripPos=WoodStripPos;var EnemyObj=function(e){function t(){var t=e.call(this)||this;t.shape=null,t.isRagdoll=!1,t.rigList=[],t.rigDic={},t.rigConstraintList=[],t.rigConstraintDic={},t.height=0,t.toPd=new egret.Point,t.isBeenAim=!1,t.isHitcurTime=!1,t.preHitTime=-999999,t.isBreakJt=!1,t.breakJtList=[],t.anim=new EnemyAnim,t.rigList.push(new RagDollItem(AnimManager.bone_trunk)),t.rigList.push(new RagDollItem(AnimManager.bone_head)),t.rigList.push(new RagDollItem(AnimManager.bone_la,AnimManager.bone_la0)),t.rigList.push(new RagDollItem(AnimManager.bone_ra,AnimManager.bone_ra0)),t.rigList.push(new RagDollItem(AnimManager.bone_ll,AnimManager.bone_ll0)),t.rigList.push(new RagDollItem(AnimManager.bone_rl,AnimManager.bone_rl0));
for(var n=0;n<t.rigList.length;n++)t.rigDic[t.rigList[n].boneName]=t.rigList[n];return t}return __extends(t,e),t.prototype.init=function(t){e.prototype.init.call(this,t)},t.prototype.clear=function(){e.prototype.clear.call(this),this.isBeenAim=!1,this.isRagdoll=!1,this.isHitcurTime=!1,this.isBreakJt=!1,this.breakJtList.splice(0),this.recoverRagDoll()},t.prototype.update=function(){e.prototype.update.call(this),0==this.isRagdoll&&this.updateAni();for(var t=0;t<this.rigList.length;t++)this.rigList[t].update();if(this.updateBreakJt(),1==this.isHitcurTime){var n=egret.getTimer();n-this.preHitTime>100&&(this.isHitcurTime=!1)}},t.prototype.updateAni=function(){this.toPd.x=this.display.x-PlayerObj.Instance.display.x,this.toPd.y=this.display.y-PlayerObj.Instance.display.y,this.toPd.normalize(1),this.topdot=this.toPd.x*PlayerObj.Instance.fireDir.x+this.toPd.y*PlayerObj.Instance.fireDir.y;var e=this.topdot>.99;e!=this.isBeenAim&&(this.isBeenAim=e,1==this.isBeenAim?this.anim.scare():this.anim.idel())},t.prototype.createRagDoll=function(){if(null!=this.display){for(var e=0;e<this.rigList.length;e++)this.rigList[e].createBody(this.display);var t,n,o=this.rigDic[AnimManager.bone_trunk];t=this.rigDic[AnimManager.bone_head],n=new p2.RevoluteConstraint(o.body,t.body,{worldPivot:[t.BoneX(),t.BoneY()]}),n.setLimits(-.3*Math.PI,.3*Math.PI),P2World.Instance.addConstraint(n),this.rigConstraintList.push(n),this.rigConstraintDic[AnimManager.bone_head]=n,t=this.rigDic[AnimManager.bone_la],n=new p2.RevoluteConstraint(o.body,t.body,{worldPivot:[t.BoneX(),t.BoneY()]}),P2World.Instance.addConstraint(n),this.rigConstraintList.push(n),this.rigConstraintDic[AnimManager.bone_la]=n,t=this.rigDic[AnimManager.bone_ra],n=new p2.RevoluteConstraint(o.body,t.body,{worldPivot:[t.BoneX(),t.BoneY()]}),P2World.Instance.addConstraint(n),this.rigConstraintList.push(n),this.rigConstraintDic[AnimManager.bone_ra]=n,t=this.rigDic[AnimManager.bone_ll],n=new p2.RevoluteConstraint(o.body,t.body,{worldPivot:[t.BoneX(),t.BoneY()]}),n.setLimits(.8*Math.PI,1.3*Math.PI),P2World.Instance.addConstraint(n),this.rigConstraintList.push(n),this.rigConstraintDic[AnimManager.bone_ll]=n,t=this.rigDic[AnimManager.bone_rl],n=new p2.RevoluteConstraint(o.body,t.body,{worldPivot:[t.BoneX(),t.BoneY()]}),n.setLimits(.8*Math.PI,1.3*Math.PI),P2World.Instance.addConstraint(n),this.rigConstraintList.push(n),this.rigConstraintDic[AnimManager.bone_rl]=n}},t.prototype.addCollisCallback=function(){for(var e=0;e<this.rigList.length;e++)this.rigList[e].addCollisCall(this.onCollisCall,this)},t.prototype.removeCollisCallback=function(){for(var e=0;e<this.rigList.length;e++)this.rigList[e].removeCollisCall()},t.prototype.onCollisCall=function(e,t){if(1!=this.isHitcurTime){this.isHitcurTime=!0,this.preHitTime=egret.getTimer();var n=e.boneName;t.shapes[0].collisionGroup==P2World.BULLET_GROUP?this.onHitByBullet(t,n):t.shapes[0].collisionGroup==P2World.ITEM_GROUP?this.onHitByItem(t,n):t.shapes[0].collisionGroup==P2World.BOOM_GROUP&&this.onHitByBoom()}},t.prototype.onHitByBoom=function(){this.attachBlood(AnimManager.bone_head),this.onDamage("all"),DeadWordEffect.Instance.playEffect("boom",this.display)},t.prototype.onHitByBullet=function(e,t){App.Sound.playEffect("hit0.mp3",.8),0==App.GlobalConfigure.GetNumber("hideBlood")&&(MCEffectController.Instance.playeEffect("bx",e.position[0]*P2World.p2dFactor,e.position[1]*P2World.p2dFactor,9,192,250,96,125,360*Math.random(),1.5,1.7),EffectController.Instance.blood.play(e.position[0]*P2World.p2dFactor,e.position[1]*P2World.p2dFactor)),DeadWordEffect.Instance.playEffect("bullet",this.display),this.attachBlood(t),this.onDamage(t)},t.prototype.onHitByItem=function(e,t){var n=e.velocity[0]*e.velocity[0]+e.velocity[1]*e.velocity[1];5>n||(0==App.GlobalConfigure.GetNumber("hideBlood")&&EffectController.Instance.blood.play(this.rigDic[t].body.position[0]*P2World.p2dFactor,this.rigDic[t].body.position[1]*P2World.p2dFactor),App.Sound.playEffect("hit5.mp3",.8),DeadWordEffect.Instance.playEffect("other",this.display),this.onDamage(t))},t.prototype.onDamage=function(e){this.hp--,this.hp<=0&&this.onDead(e)},t.prototype.onDead=function(e){if(App.vibrateShort(),App.Sound.playEffect("dieEffect.mp3",.5),e==AnimManager.bone_trunk);else if("all"==e){this.breakJtList.push(AnimManager.bone_head);var t=RandomUtils.getInstance().limitInteger(1,9);switch(t){case 1:this.breakJtList.push(AnimManager.bone_la);break;case 2:this.breakJtList.push(AnimManager.bone_ra);break;case 3:this.breakJtList.push(AnimManager.bone_la),this.breakJtList.push(AnimManager.bone_ra);break;case 4:this.breakJtList.push(AnimManager.bone_ll);break;case 5:this.breakJtList.push(AnimManager.bone_rl);break;case 6:this.breakJtList.push(AnimManager.bone_ll),this.breakJtList.push(AnimManager.bone_rl);break;case 7:this.breakJtList.push(AnimManager.bone_ll),this.breakJtList.push(AnimManager.bone_rl),this.breakJtList.push(AnimManager.bone_ra);break;case 8:this.breakJtList.push(AnimManager.bone_ll),this.breakJtList.push(AnimManager.bone_rl),this.breakJtList.push(AnimManager.bone_la);break;case 9:this.breakJtList.push(AnimManager.bone_la),this.breakJtList.push(AnimManager.bone_ra),this.breakJtList.push(AnimManager.bone_rl)}this.isBreakJt=!0}else this.breakJtList.push(e),this.isBreakJt=!0;this.removeCollisCallback(),this.ragdollOn(),SceneManager.Instance.deadEnemy++,SceneManager.Instance.judgeGame(),this.safeModeRemove()},t.prototype.safeModeRemove=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return 0==App.GlobalConfigure.GetNumber("tt_safeMode")?[2]:[4,App.sleep(1e3)];case 1:return e.sent(),RoleManager.Instance.removeEnemy(this),[2]}})})},t.prototype.recoverRagDoll=function(){for(var e=0;e<this.rigList.length;e++)this.rigList[e].clear();for(var e=0;e<this.rigConstraintList.length;e++)P2World.Instance.removeConstraint(this.rigConstraintList[e]);this.rigConstraintList.splice(0)},t.prototype.attachBlood=function(e){1!=App.GlobalConfigure.GetNumber("hideBlood")&&(e!=AnimManager.bone_ll&&e!=AnimManager.bone_rl&&this.rigDic[AnimManager.bone_head].attachBlood(),this.rigDic[AnimManager.bone_trunk].attachBlood())},t.prototype.ragdollOn=function(){if(1!=this.isRagdoll){this.isRagdoll=!0;for(var e=0;e<this.rigList.length;e++)this.rigList[e].on();this.anim.rag()}},t.prototype.ragdollOff=function(){if(0!=this.isRagdoll){this.isRagdoll=!1;for(var e=0;e<this.rigList.length;e++)this.rigList[e].off()}},t.prototype.updateBreakJt=function(){if(0!=this.isBreakJt&&1!=App.GlobalConfigure.GetNumber("closeBreakJt")){this.isBreakJt=!1;for(var e=0;e<this.breakJtList.length;e++){var t=this.rigConstraintDic[this.breakJtList[e]];if(null!=t){var n=this.rigConstraintList.indexOf(t);n>=0&&(P2World.Instance.removeConstraint(t),this.rigConstraintList.splice(n,1),this.rigConstraintDic[this.breakJtList[e]]=null,0==App.GlobalConfigure.GetNumber("hideBlood")&&(this.rigDic[this.breakJtList[e]].addPenxue(),this.rigDic[AnimManager.bone_trunk].addPenxue(this.rigDic[this.breakJtList[e]].boneGT,this.breakJtList[e]==AnimManager.bone_head?1.3:.7)))}}this.breakJtList.splice(0)}},t.prototype.testPenxue=function(){this.rigDic[AnimManager.bone_trunk].addPenxue(this.rigDic[AnimManager.bone_head].boneGT,1.2)},t.prototype.createBox=function(e,t,n,o){this.body=P2World.Instance.getBody("enemyBox"),this.body.mass=3,this.body.position[0]=P2World.Instance.d2pX(e),this.body.position[1]=P2World.Instance.d2pY(t),this.shape=new p2.Box({width:n*P2World.d2pFactor,height:o*P2World.d2pFactor}),this.shape.collisionGroup=P2World.ITEM_GROUP,this.shape.collisionMask=P2World.ITEM_MASK,this.body.addShape(this.shape),this.shape.position=[0,.5*-this.shape.height],P2World.Instance.addBody(this.body),BeginContactEvent.Instance.on(this.body.id,this.onBeginContactEvent,this)},t.prototype.removeBox=function(){null!=this.body&&(BeginContactEvent.Instance.off(this.body.id),P2World.Instance.removeBody(this.body),this.body=null,this.shape=null)},t.prototype.onBeginContactEvent=function(e){var t=e.bodyA,n=e.bodyB,o=this.body.id==t.id?t:n;o.shapes[0].collisionGroup==P2World.BULLET_GROUP},t.prototype.opentest=function(){t.test=this,document.addEventListener("keydown",this.onKeydown)},t.prototype.onKeydown=function(e){},t.aniarr=["cheer1","cheer2","cheer3","idel","scare","test"],t.aniarrI=0,t}(RoleObj);__reflect(EnemyObj.prototype,"EnemyObj");var EnemyPos=function(e){function t(){var t=e.call(this)||this;return t.bodyRes="",t.hp=1,t}return __extends(t,e),t.prototype.createObj=function(){this.obj=RoleManager.Instance.createEnemy();var e=RandomUtils.getInstance().limitInteger(0,t.textSkin.length);this.bodyRes=t.textSkin[e],this.obj.init(this.bodyRes),this.obj.display.scaleX*=this.scaleX,this.obj.hp=this.hp,this.obj.display.x=this.x,this.obj.display.y=this.y,this.obj.height=this.height,this.obj.anim.idel(),this.obj.createRagDoll(),this.obj.addCollisCallback()},t.textSkin=["enemy01","enemy02","enemy03","enemy04","enemy05","enemy06","enemy07","enemy08","enemy09","enemy10"],t}(ObjPos);__reflect(EnemyPos.prototype,"EnemyPos"),window.EnemyPos=EnemyPos;var GunData=function(){function e(e){this.len=100,this.player=e}return Object.defineProperty(e.prototype,"SkinName",{get:function(){return this.skinName},set:function(e){this.skinName!=e&&(this.skinName=e,this.skinData=SkinData.Instance.getGunSkinData(e),this.len=this.skinData.len,this.setGun())},enumerable:!0,configurable:!0}),e.prototype.RecorfOrigi=function(){var e=this.player.display.armature.getSlot(AnimManager.slot_gun);if(null!=e){var t=e.display;this.ox=t.x,this.oy=t.y,this.osx=t.scaleX,this.osy=t.scaleY,this.or=t.rotation,this.oa=t.alpha}},e.prototype.setGun=function(){var e=this.player.display.armature.getSlot(AnimManager.slot_gun),t=this.player.dbFactory.getTextureDisplay("gun/"+this.skinName,this.player.dbName);return null==t?null:(t.anchorOffsetX=.5*t.width,t.anchorOffsetY=.5*t.height,t.x=this.ox,t.y=this.oy,t.scaleX=this.osx,t.scaleY=this.osy,t.rotation=this.or,t.alpha=this.oa,void(e.display=t))},e}();__reflect(GunData.prototype,"GunData");var PlayerObj=function(e){function t(){var n=e.call(this)||this;return n.bulletCount=100,n.target=new egret.Point,n.gunPos=new egret.Point,n.firePos=new egret.Point,n.fireDir=new egret.Point,t.Instance=n,n.gunData=new GunData(n),n.anim=new PlayerAnim,n}return __extends(t,e),t.prototype.getHeadBitmapByName=function(e){return null==this.dbFactory?null:this.dbFactory.getTextureDisplay(e,t.Instance.dbName)},t.prototype.init=function(t){e.prototype.init.call(this,t),this.gunData.RecorfOrigi()},t.prototype.changeGun=function(e){this.gunData.SkinName=e},t.prototype.update=function(){e.prototype.update.call(this)},t.prototype.clear=function(){e.prototype.clear.call(this)},t.prototype.createBody=function(){e.prototype.createBody.call(this)},t.prototype.recoverBody=function(){e.prototype.recoverBody.call(this)},t.prototype.aim=function(e,t){0==this.anim.aimDir&&(this.anim.aimDir=10),this.target.setTo(e,t),this.anim.aim()},t.prototype.fire=function(){if(BulletManager.Instance.bulletNum-BulletManager.Instance.bulletUseNum>0){BulletManager.Instance.bulletUseNum++;var e=App.ViewManager.getView(EViewID.GAME_PLAY_VIEW);e.refreshBullet(),this.anim.fire(),App.Sound.playEffect("fire0.mp3",.5),GameMap.Instance.dark(.08,100),MCEffectController.Instance.playeEffect("fd",this.firePos.x,this.firePos.y,12,384,384,100,240,this.aimR/Math.PI*180,1,2),EffectController.Instance.playFireLight(this.firePos.x,this.firePos.y),EffectController.Instance.spark.play(this.firePos.x,this.firePos.y,this.aimR),EffectController.Instance.bulletCase.play(this.gunPos.x,this.gunPos.y,this.fireDir),BulletManager.Instance.addBullet("bullet01",40,80,this.firePos.x,this.firePos.y,this.fireDir,this.aimR,!0,new egret.Rectangle(5,20,30,53))}else App.Sound.playEffect("bulletempty.mp3",.6)},t}(RoleObj);__reflect(PlayerObj.prototype,"PlayerObj");var PlayerPos=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.createObj=function(){RoleManager.Instance.player.display.x=this.x,RoleManager.Instance.player.display.y=this.y,RoleManager.Instance.player.display.scaleX=this.scaleX,RoleManager.Instance.player.display.scaleY=this.scaleY,RoleManager.Instance.player.anim.clearAnimState(),RoleManager.Instance.player.anim.idel()},t}(ObjPos);__reflect(PlayerPos.prototype,"PlayerPos"),window.PlayerPos=PlayerPos;var RagDollItem=function(){function e(e,t){void 0===t&&(t=null),this.boneName=null,this.bone=null,this.childBoneName=null,this.childBone=null,this.rigidPos=new egret.Point,this.rigidAngleRad=0,this.rigidAngleDeg=0,this.bodyHS=1,this.isTakeCtl=!1,this.onHit=null,this.onHitTarget=null,this.origiBoneTf=new dragonBones.Transform,this.beEffects=[],this.attachBloodArr=[],this.boneName=e,this.childBoneName=t}return e.prototype.clear=function(){this.recoverBoneOrigin(),this.bone=null,this.childBone=null,this.boneGT=null,this.slot=null,this.slotDis=null,this.display=null,this.isTakeCtl=!1,this.onHit=null,this.onHitTarget=null,this.removeCollisCall(),this.removeBody(),this.removePenxue(),this.removeBlood()},e.prototype.BoneX=function(){return P2World.Instance.d2pX(this.display.x+this.boneGT.x*this.display.scaleX)},e.prototype.BoneY=function(){return P2World.Instance.d2pY(this.display.y+this.boneGT.y*this.display.scaleY)},e.prototype.recordBoneOrigin=function(){this.origiBoneTf.copyFrom(this.bone.origin)},e.prototype.recoverBoneOrigin=function(){this.bone.origin.copyFrom(this.origiBoneTf)},e.prototype.createBody=function(e){if(this.display=e,this.bone=this.display.armature.getBone(this.boneName),this.slot=this.display.armature.getSlot(this.boneName),null!=this.bone&&null!=this.slot){this.recordBoneOrigin(),null!=this.childBoneName&&(this.childBone=this.display.armature.getBone(this.childBoneName)),this.slotDis=this.slot.displayList[this.slot.displayIndex],this.boneGT=this.bone.global,this.body=P2World.Instance.getBody("RagDollItem"),this.body.angularDamping=.85;var t;this.boneName==AnimManager.bone_head?(this.body.damping=.4,t=new p2.Circle({radius:.5*this.slotDis.width*P2World.d2pFactor*this.display.scaleY})):this.boneName==AnimManager.bone_trunk?(this.body.damping=.1,t=new p2.Box({width:this.slotDis.width*P2World.d2pFactor*Math.abs(this.display.scaleX)*.5,height:this.slotDis.height*P2World.d2pFactor*this.display.scaleY})):(this.bodyHS=1.3,this.body.damping=.4,t=new p2.Box({width:this.slotDis.width*P2World.d2pFactor*Math.abs(this.display.scaleX),height:this.slotDis.height*P2World.d2pFactor*this.display.scaleY*this.bodyHS})),t.material=P2World.Instance.itemMat,this.body.addShape(t),t.collisionGroup=P2World.BODY_GROUP,t.collisionMask=P2World.BODY_MASK,P2World.Instance.addBody(this.body),this.resetBody()}},e.prototype.addCollisCall=function(e,t){this.onHit=e,this.onHitTarget=t,null!=this.body&&BeginContactEvent.Instance.on(this.body.id,this.onBeginContactEvent,this)},e.prototype.removeCollisCall=function(){this.onHit=null,this.onHitTarget=null,null!=this.body&&BeginContactEvent.Instance.off(this.body.id)},e.prototype.onBeginContactEvent=function(e){var t=e.bodyA,n=e.bodyB,o=this.body.id==t.id?n:t;null!=this.onHit&&this.onHit.apply(this.onHitTarget,[this,o])},e.prototype.removeBody=function(){P2World.Instance.removeBody(this.body),this.body=null},e.prototype.resetBody=function(){null!=this.body&&(this.body.angle=this.display.rotation*Math.PI/180+this.boneGT.rotation+this.slot.origin.rotation,this.bone.globalTransformMatrix.transformPoint(this.slot.origin.x*this.bodyHS,this.slot.origin.y,e.tp),this.body.position[0]=P2World.Instance.d2pX(this.display.x+e.tp.x*this.display.scaleX),this.body.position[1]=P2World.Instance.d2pY(this.display.y+e.tp.y*this.display.scaleY),this.display.scaleX<0&&(this.body.angle*=-1),null!=this.childBone&&(this.childBoneOR=this.childBone.global.rotation-this.boneGT.rotation))},e.prototype.on=function(){1!=this.isTakeCtl&&(this.isTakeCtl=!0,null!=this.body&&(this.resetBody(),this.boneName==AnimManager.bone_trunk?this.body.mass=1:this.body.mass=.5,this.body.type=p2.Body.DYNAMIC,this.body.updateMassProperties()))},e.prototype.off=function(){0!=this.isTakeCtl&&(this.isTakeCtl=!1,null!=this.body&&(this.body.type=p2.Body.STATIC,this.body.mass=0,this.body.sleep(),this.body.updateMassProperties()),this.resetBody())},e.prototype.updateRig=function(){if(null!=this.body||this.body.sleepState==p2.Body.AWAKE){if(this.boneName==AnimManager.bone_trunk)e.tbp[0]=P2World.Instance.d2pX(-this.boneGT.x*this.display.scaleX),e.tbp[1]=P2World.Instance.d2pY(-this.boneGT.y*this.display.scaleY),this.body.toWorldFrame(e.twp,e.tbp),this.display.x=P2World.Instance.p2dX(e.twp[0]),this.display.y=P2World.Instance.p2dY(e.twp[1]),this.display.rotation=180*this.body.angle/Math.PI;else{e.tbp[0]=P2World.Instance.d2pX(this.slot.origin.y*this.display.scaleX),e.tbp[1]=P2World.Instance.d2pY(this.slot.origin.x*this.bodyHS*this.display.scaleY),this.body.toWorldFrame(e.twp,e.tbp),1!=GameMap.Instance.scaleX||0!=GameMap.Instance.x||0!=GameMap.Instance.y?(GameMap.Instance.localToGlobal(P2World.Instance.p2dX(e.twp[0]),P2World.Instance.p2dY(e.twp[1]),e.tp2),this.display.globalToLocal(e.tp2.x,e.tp2.y,e.tp)):this.display.globalToLocal(P2World.Instance.p2dX(e.twp[0]),P2World.Instance.p2dY(e.twp[1]),e.tp);var t=this.bone.parent;this.bone.offset.x=e.tp.x-this.bone.origin.x-t.origin.x,this.bone.offset.y=e.tp.y-this.bone.origin.y-t.origin.y,this.bone.offset.rotation=this.body.angle-this.display.rotation*Math.PI/180-this.bone.origin.rotation-t.origin.rotation-this.slot.origin.rotation,this.display.scaleX<0&&(this.bone.offset.rotation=-this.bone.offset.rotation)}null!=this.childBone&&(this.childBone.offset.rotation=this.childBoneOR)}},e.prototype.addPenxue=function(e,t){void 0===e&&(e=null),void 0===t&&(t=1);var n=!1;(this.boneName==AnimManager.bone_trunk||this.boneName==AnimManager.bone_head)&&(n=!0);var o=EffectController.Instance.bloodEjection.addEjection(this.onPenxueEnd,this,n),i=this.slotDis.width*Math.abs(this.display.scaleX),r=this.slotDis.height*this.display.scaleY,s=Math.min(i,r),a=s/100*2*t;if(this.boneName==AnimManager.bone_head)o.ox=0,o.oy=.5*r*P2World.d2pFactor,o.or=90;else if(this.boneName==AnimManager.bone_trunk){if(null==e)return;var l=(e.x-this.boneGT.x)*this.display.scaleX,p=(e.y-this.boneGT.y)*this.display.scaleY,h=Math.atan2(p,l);o.ox=l*P2World.d2pFactor,o.oy=p*P2World.d2pFactor,o.or=h/Math.PI*180}else a*=3,o.ox=0,o.oy=.5*r*P2World.d2pFactor,o.or=90;o.s=a,this.beEffects.push(o)},e.prototype.removePenxue=function(){for(var e=0;e<this.beEffects.length;e++)EffectController.Instance.bloodEjection.removeEjection(this.beEffects[0]);this.beEffects.splice(0)},e.prototype.onPenxueEnd=function(e){var t=this.beEffects.indexOf(e);0>t||this.beEffects.splice(t,1)},e.prototype.updatePenxue=function(){if(null!=this.body)for(var t,n=0;n<this.beEffects.length;n++)t=this.beEffects[n],e.tbp[0]=t.ox,e.tbp[1]=t.oy,this.body.toWorldFrame(e.twp,e.tbp),t.x=P2World.Instance.p2dX(e.twp[0]),t.y=P2World.Instance.p2dX(e.twp[1]),t.rotation=this.body.angle/Math.PI*180+t.or},e.prototype.attachBlood=function(){for(var e=RandomUtils.getInstance().limitInteger(1,3),t=0;e>t;t++){var n=EffectController.Instance.getAttachBlood(),o=this.slotDis.width*Math.abs(this.display.scaleX),i=this.slotDis.height*this.display.scaleY,r=Math.min(o,i),s=r/n.width,a=s*(.2+.7*Math.random());n.scaleX=a,n.scaleY=a;var l=n.width*a,p=.5*(o-l)*P2World.d2pFactor,h=.5*(i-l)*P2World.d2pFactor;n.ox=RandomUtils.getInstance().limit(-p,p),n.oy=RandomUtils.getInstance().limit(-h,h),n.or=360*Math.random(),this.attachBloodArr.push(n)}},e.prototype.removeBlood=function(){for(var e=0;e<this.attachBloodArr.length;e++)EffectController.Instance.removeAttachBlood(this.attachBloodArr[e]);this.attachBloodArr.splice(0)},e.prototype.updateAttachblood=function(){for(var t,n=0;n<this.attachBloodArr.length;n++)t=this.attachBloodArr[n],e.tbp[0]=t.ox,e.tbp[1]=t.oy,this.body.toWorldFrame(e.twp,e.tbp),t.x=P2World.Instance.p2dX(e.twp[0]),t.y=P2World.Instance.p2dX(e.twp[1]),t.rotation=this.body.angle/Math.PI*180+t.or},e.prototype.update=function(){null!=this.body&&(1==this.isTakeCtl&&this.updateRig(),this.updatePenxue(),this.updateAttachblood())},e.tbp=[0,0],e.twp=[0,0],e.tp=new egret.Point,e.tp2=new egret.Point,e.tm=new dragonBones.Matrix,e}();__reflect(RagDollItem.prototype,"RagDollItem");var RoleManager=function(){function e(){this.enemyPools=new ObjectPool,this.enemys=[],this.removeEnemys=[],e.Instance=this,this.createPlayer()}return e.prototype.update=function(e){this.updateRemove(),this.player.update();for(var t=0;t<this.enemys.length;t++)this.enemys[t].update()},e.prototype.createPlayer=function(){this.player=new PlayerObj,this.player.init("player12"),this.player.changeGun("gun_01"),GameMap.Instance.roleLayer.addChild(this.player.display)},e.prototype.createEnemy=function(){var e=this.enemyPools.popObj();return null==e&&(e=new EnemyObj),this.enemys.push(e),e},e.prototype.removeEnemy=function(e){this.removeEnemys.push(e)},e.prototype.removeAllEnemy=function(){for(var e,t=0;t<this.enemys.length;t++)e=this.enemys[t],e.clear(),this.enemyPools.pushObj(e);this.enemys.splice(0),this.removeEnemys.splice(0)},e.prototype.clear=function(){this.removeAllEnemy()},e.prototype.updateRemove=function(){for(var e,t,n=0;n<this.removeEnemys.length;n++)e=this.removeEnemys[n],t=this.enemys.indexOf(e),e.clear(),this.enemyPools.pushObj(e),this.enemys.splice(t,1);this.removeEnemys.splice(0)},e}();__reflect(RoleManager.prototype,"RoleManager");var ThemeAdapter=function(){function e(){}return e.prototype.getTheme=function(e,t,n,o){function i(e){t.call(o,e)}function r(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),n.call(o))}"undefined"!=typeof generateEUI?egret.callLater(function(){t.call(o,generateEUI)},this):(RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),RES.getResByUrl(e,i,this,RES.ResourceItem.TYPE_TEXT))},e}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var ESkipViewType;!function(e){e[e.BANNER=1e5]="BANNER",e[e.LIKE=100001]="LIKE",e[e.HOT=100002]="HOT",e[e.MINIBOX=100003]="MINIBOX",e[e.BOX=100004]="BOX",e[e.JUMP=100005]="JUMP",e[e.BIGLIKE=100006]="BIGLIKE",e[e.TRYPLAY=100007]="TRYPLAY",e[e.SCREENAD=100008]="SCREENAD",e[e.WXMENU=100009]="WXMENU",e[e.FRIEND=100010]="FRIEND",e[e.TOP=100011]="TOP",e[e.BIGLIKESIX=100012]="BIGLIKESIX"}(ESkipViewType||(ESkipViewType={}));var SkipController=function(){function e(){this.model=new SkipModel,this.bannerView=new SkipBannerView(null),this.skipLikeView=new SkipLikeView(null),this.skipBoxView=new SkipBoxView(null),"wxgame"==platform.getPlatformName()&&(this.skipWxMenuView=new SkipWxMenuView(null)),"wxgame"==platform.getPlatformName()&&(this.skipBigLikeFourView=new SkipBigLikeFourView(null));for(var e=App.GlobalConfigure.GetArray("subskipindex"),t=0;t<e.length;t++){e[t][0]}}return Object.defineProperty(e,"Instance",{get:function(){return null==e.s_Instance&&(e.s_Instance=new e),e.s_Instance},enumerable:!0,configurable:!0}),e.prototype.skipOtherGame=function(e,t,n){if(null!=e){var o=e._parent_;window.platform.aldSendEvent("点击跳转-appID",o.appID+""),window.platform.aldSendEvent("点击跳转-名字",e._name_+""),"wxgame"==window.platform.getPlatformName()?window.platform.linkOtherGame(o.appID,o.url,t,n,e):1==this.model.defaultSuc?t.call(null,e):n.call(null,e)}},e.prototype.showView=function(t){if("tt"==platform.getPlatformName())switch(t){case ESkipViewType.LIKE:case ESkipViewType.BOX:case ESkipViewType.BIGLIKESIX:case ESkipViewType.BANNER:return null}if("1"!=App.GlobalConfigure.GetGlobalValue("showskip"))return null;if(this.model.hideCnt!=this.model.skipDatas.length){if(t==ESkipViewType.BANNER&&1!=App.GlobalConfigure.GetNumber("skipbanner"))return null;if(t==ESkipViewType.SCREENAD){var n=App.GlobalConfigure.GetNumberArr("skipScreenIndex",0),o=e.Instance.model.skipDatas[n];if(null==o)return}return App.ViewManager.open(t)}},e.prototype.closeView=function(e){App.ViewManager.close(e)},e}();__reflect(SkipController.prototype,"SkipController");var SkipData=function(){function e(){this.index=0,this.items=[],this.url="",this.appID="",this.flag="",this.name="",this.imgUrl=""}return e.prototype.getSkinByData=function(e){return this.imgUrl},e}();__reflect(SkipData.prototype,"SkipData");var SkipItemData=function(){function e(){this._subIndex_=0,this._name_=""}return e}();__reflect(SkipItemData.prototype,"SkipItemData");var SkipModel=function(){function e(){this.skipDatas=[],this.tmpArray=[],this.defaultSuc=!0,this.hideCnt=0,this.updateInfo()}return e.prototype.updateInfo=function(){if("wxgame"==platform.getPlatformName()){var t=e.data[0];if(t=JSON.parse(t),t&&200==t.code){for(var n=0;n<t.data.length;++n){var o=t.data[n];1==App.GlobalConfigure.GetNumber("hideSkipedGame")&&("0"==egret.localStorage.getItem(o.GameAppId)||"0"==App.GlobalConfigure.getLocalTodayValue(o.GameAppId))&&this.hideCnt++;var i=new SkipData;i.index=n,i.url=o.PromoteLink,i.appID=o.GameAppId,i.name=o.GameName,i.imgUrl=o.Icon,i.position=o.Position;var r=new SkipItemData;r._subIndex_=0,r._name_=o.GameName,r._parent_=i,i.items.push(r),i.items.length>0&&this.skipDatas.push(i)}for(var s,n=0;n<this.skipDatas.length;n++)for(var a=n+1;a<this.skipDatas.length;a++)this.skipDatas[n].position>this.skipDatas[a].position&&(s=this.skipDatas[n],this.skipDatas[n]=this.skipDatas[a],this.skipDatas[a]=s);this.defaultSuc="true"==App.GlobalConfigure.GetGlobalValue("skipdefault")}}},e.prototype.hideGame=function(e){App.GlobalConfigure.setLocalTodayValue("skip"+e,"1")},e.prototype.hideGameNew=function(e){this.hideCnt++,App.GlobalConfigure.setLocalTodayValue(e._parent_.appID,"0")},e.prototype.getAllItems=function(e){e.splice(0);for(var t="",n=0;n<this.skipDatas.length;++n){if(t=this.skipDatas[n].appID,1==App.GlobalConfigure.GetNumber("hideSkipedGame")){if("0"==App.GlobalConfigure.getLocalTodayValue(t))continue;if("0"==egret.localStorage.getItem(t))continue}e.push(this.skipDatas[n].items[0])}return 0==e.length?(console.log("no"),!1):!0},e.prototype.getDataByJuHe=function(e){e.splice(0),this.tmpArray.splice(0);for(var t="",n=0;n<this.skipDatas.length;++n){if(t=this.skipDatas[n].appID,1==App.GlobalConfigure.GetNumber("hideSkipedGame")){if("0"==App.GlobalConfigure.getLocalTodayValue(t))continue;if("0"==egret.localStorage.getItem(t))continue}this.tmpArray.push(n)}if(0==this.tmpArray.length)return console.log("no"),!1;for(var n=0;10>n;++n)e.push(this.skipDatas[n].items[0]);return!0},e.prototype.getDataByJuHeNew=function(e){e.splice(0),this.tmpArray.splice(0);for(var t="",n=0;n<this.skipDatas.length;++n){if(t=this.skipDatas[n].appID,1==App.GlobalConfigure.GetNumber("hideSkipedGame")){if("0"==App.GlobalConfigure.getLocalTodayValue(t))continue;if("0"==egret.localStorage.getItem(t))continue}this.tmpArray.push(n)}if(0==this.tmpArray.length)return console.log("no"),!1;for(var n=0;n<this.tmpArray.length;++n)e.push(this.skipDatas[n].items[0]);return!0},e.prototype.getDatas=function(e,t){e.splice(0),this.tmpArray.splice(0);for(var n="",o=0;o<this.skipDatas.length;++o){if(n=this.skipDatas[o].appID,1==App.GlobalConfigure.GetNumber("hideSkipedGame")){if("0"==App.GlobalConfigure.getLocalTodayValue(n))continue;if("0"==egret.localStorage.getItem(n))continue}this.tmpArray.push(o)}if(0==this.tmpArray.length)return console.log("no"),!1;if(this.tmpArray.length<=t){for(var o=0;o<this.tmpArray.length;++o){var i=this.skipDatas[this.tmpArray[o]],r=App.RandomUtils.limitInteger(0,i.items.length);e.push(i.items[r])}for(var o=this.tmpArray.length;t>o;++o){var s=App.RandomUtils.limitInteger(0,this.tmpArray.length),i=this.skipDatas[this.tmpArray[s]],r=App.RandomUtils.limitInteger(0,i.items.length);e.push(i.items[r])}}else for(var o=0;t>o;++o){var s=App.RandomUtils.limitInteger(0,this.tmpArray.length),i=this.skipDatas[this.tmpArray[s]],r=App.RandomUtils.limitInteger(0,i.items.length);e.push(i.items[r]),this.tmpArray.splice(s,1)}return!0},e}();__reflect(SkipModel.prototype,"SkipModel");var SkipBannerView=function(e){function t(t){var n=e.call(this,t,null,ESkipViewType.BANNER)||this;return n.setSkinName("resource/ui/skip/skipbanner.exml"),n.setLayer(EViewLayer.TIPS),n}return __extends(t,e),t.prototype.getImgPath=function(e){var t="./";return"wxgame"==window.platform.getPlatformName()&&(t=App.resourceURL),t+="/resource/res/global/banners/"+e+".jpg"},t.prototype.onSkipSuc=function(e){window.platform.aldSendEvent("banner推荐点击跳转成功-appID",e._parent_.appID+"")},t.prototype.onSkipFai=function(e){window.platform.aldSendEvent("banner推荐点击跳转失败-appID",e._parent_.appID+""),SkipBoxView.openID=2,SkipController.Instance.showView(ESkipViewType.BOX)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.left=this.right=this.top=this.bottom=0,this.content.width=App.MainSprite.width-20,this.content.height=.34*this.content.width,this.content.bottom=20,this.content.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSkip,this)},t.prototype.onSkip=function(){this.closeSelf(),window.platform.aldSendEvent("点击banner推荐",this.tmpData.appID+""),SkipController.Instance.skipOtherGame(this.tmpData.items[0],this.onSkipSuc,this.onSkipFai)},t.prototype.open=function(){var e=App.RandomUtils.limitInteger(0,10);this.tmpData=SkipController.Instance.model.skipDatas[e],this.content.source=this.getImgPath(e+1),window.platform.aldSendEvent("banner推荐曝光",this.tmpData.appID+"")},t.prototype.close=function(){},t}(BaseView);__reflect(SkipBannerView.prototype,"SkipBannerView");var SkipBigLikeFourRender=function(e){function t(){var t=e.call(this)||this;return t.index=-1,t.skinName="resource/ui/skip/skiplikefouritem.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.img.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSkip,this)},t.prototype.dataChanged=function(){e.prototype.dataChanged.call(this),this.img.source=this.data.img,this.index=this.data.index},t.prototype.onSkipSuc=function(e){window.platform.aldSendEvent("106游戏跳转成功-appID",e._parent_.appID+""),window.platform.aldSendEvent("106游戏跳转成功-名字",e._name_+""),window.platform.aldSendEvent("103结算2*3跳转成功-appID",e._parent_.appID+""),window.platform.aldSendEvent("103结算2*3跳转成功-名字",e._name_+""),SkipController.Instance.model.hideGameNew(e)},t.prototype.onSkipFai=function(e){window.platform.aldSendEvent("103结算2*3跳转失败-appID",e._parent_.appID+""),window.platform.aldSendEvent("103结算2*3跳转失败-名字",e._name_+""),SkipBoxView.openID=2,SkipController.Instance.showView(ESkipViewType.BOX)},t.prototype.onSkip=function(){var e=SkipBigLikeFourView.tmpData[this.index];window.platform.aldSendEvent("点击聚合跳转",e._name_+""),SkipController.Instance.skipOtherGame(e,this.onSkipSuc,this.onSkipFai)},t}(eui.ItemRenderer);__reflect(SkipBigLikeFourRender.prototype,"SkipBigLikeFourRender");var SkipBigLikeFourView=function(e){function t(t){var n=e.call(this,t,null,ESkipViewType.BIGLIKESIX)||this;return n.data=new eui.ArrayCollection,n.setSkinName("resource/ui/skip/skiplikefour.exml"),n.setLayer(EViewLayer.NORMAL),n}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.list.itemRenderer=SkipBigLikeFourRender,this.list.dataProvider=this.data,this.scroller.scrollPolicyH=eui.ScrollPolicy.OFF,this.scroller.scrollPolicyV=eui.ScrollPolicy.ON;var t=new eui.TileLayout;t.horizontalGap=10,this.top=this.bottom=0,this.list.layout=t,this.scroller.addEventListener(egret.Event.CHANGE,this.onScrollMove,this)},t.prototype.onScrollMove=function(){egret.Tween.removeTweens(this.scroller.viewport)},t.prototype.refresh=function(){if(0!=this.isShow()){if(0==SkipController.Instance.model.getDataByJuHeNew(t.tmpData))return void this.closeSelf();this.data.removeAll(),this.list.height=0;for(var e=0;e<t.tmpData.length;e++)this.data.addItem({name:t.tmpData[e]._name_,img:t.tmpData[e]._parent_.getSkinByData(t.tmpData[e]._subIndex_+1),index:e}),e%2==0&&(this.list.height+=300);this.data.refresh()}},t.prototype.open=function(){this.refresh(),window.platform.aldSendEvent("103结算2*3曝光",null),egret.Tween.get(this.scroller.viewport,{loop:!0}).to({scrollV:this.list.height-1e3},2e4).to({scrollV:0},2e4)
},t.prototype.close=function(){egret.Tween.removeTweens(this.scroller.viewport)},t.tmpData=[],t}(BaseView);__reflect(SkipBigLikeFourView.prototype,"SkipBigLikeFourView");var SkipBoxItemRender=function(e){function t(){var t=e.call(this)||this;return t.index=-1,t.skinName="resource/ui/skip/skipboxitem.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.grp.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSkip,this)},t.prototype.dataChanged=function(){e.prototype.dataChanged.call(this),this.labelName.text=this.data.name,this.img.source=this.data.img,this.index=this.data.index},t.prototype.sendSkip=function(e){return 0==SkipBoxView.openID?void window.platform.aldSendEvent("102假退出点击",e._name_+""):1==SkipBoxView.openID?void window.platform.aldSendEvent("101返回主页曝光瀑布流点击",e._name_+""):2==SkipBoxView.openID?void window.platform.aldSendEvent("104所有取消跳转瀑布流点击",e._name_+""):3==SkipBoxView.openID?void window.platform.aldSendEvent("105开屏瀑布流点击",e._name_+""):4==SkipBoxView.openID?void window.platform.aldSendEvent("替换：轮播-瀑布流-点击",e._name_+""):void 0},t.prototype.onSkip=function(){var e=SkipBoxView.tmpItems[this.index];this.sendSkip(e),SkipController.Instance.skipOtherGame(e,this.onSkipSuc,this.onSkipFai)},t.prototype.onSkipSuc=function(e){return window.platform.aldSendEvent("106游戏跳转成功-appID",e._parent_.appID+""),window.platform.aldSendEvent("106游戏跳转成功-名字",e._name_+""),SkipController.Instance.model.hideGameNew(e),App.ViewManager.getView(ESkipViewType.BOX).refresh(),0==SkipBoxView.openID?void window.platform.aldSendEvent("102假退出跳转成功",e._name_+""):1==SkipBoxView.openID?void window.platform.aldSendEvent("101返回主页曝光瀑布流跳转成功",e._name_+""):2==SkipBoxView.openID?void window.platform.aldSendEvent("104所有取消跳转瀑布流跳转成功",e._name_+""):3==SkipBoxView.openID?void window.platform.aldSendEvent("105开屏瀑布流跳转成功",e._name_+""):4==SkipBoxView.openID?void window.platform.aldSendEvent("替换：轮播-瀑布流-跳转成功",e._name_+""):void 0},t.prototype.onSkipFai=function(e){return 0==SkipBoxView.openID?void window.platform.aldSendEvent("102假退出跳转失败",e._name_+""):1==SkipBoxView.openID?void window.platform.aldSendEvent("101返回主页曝光瀑布流跳转失败",e._name_+""):2==SkipBoxView.openID?void window.platform.aldSendEvent("104所有取消跳转瀑布流跳转失败",e._name_+""):3==SkipBoxView.openID?void window.platform.aldSendEvent("105开屏瀑布流跳转失败",e._name_+""):4==SkipBoxView.openID?void window.platform.aldSendEvent("替换：轮播-瀑布流-跳转失败",e._name_+""):void 0},t}(eui.ItemRenderer);__reflect(SkipBoxItemRender.prototype,"SkipBoxItemRender");var SkipBoxView=function(e){function t(t){var n=e.call(this,t,null,ESkipViewType.BOX)||this;return n.isSuccess=0,n.data=new eui.ArrayCollection,n.setSkinName("resource/ui/skip/skipbox.exml"),n.setLayer(EViewLayer.TIPS),n}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.list.itemRenderer=SkipBoxItemRender,this.list.dataProvider=this.data,this.scroller.scrollPolicyH=eui.ScrollPolicy.OFF,this.scroller.scrollPolicyV=eui.ScrollPolicy.ON;var t=new eui.TileLayout;this.top=this.bottom=0,this.list.layout=t,this.scroller.addEventListener(egret.Event.CHANGE,this.onScrollMove,this),this.btnClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.closeSelf,this)},t.prototype.onScrollMove=function(){egret.Tween.removeTweens(this.scroller.viewport)},t.prototype.refresh=function(){if(0!=this.isShow()){if(0==SkipController.Instance.model.getDataByJuHeNew(t.tmpItems))return void this.closeSelf();this.data.removeAll(),this.list.height=0;for(var e=0;e<t.tmpItems.length;e++)this.data.addItem({name:t.tmpItems[e]._name_,img:t.tmpItems[e]._parent_.getSkinByData(t.tmpItems[e]._subIndex_+1),index:e}),e%2==0&&(this.list.height+=470);this.data.refresh()}},t.prototype.sendEvent=function(){return 0==t.openID?void window.platform.aldSendEvent("102假退出曝光",null):1==t.openID?void window.platform.aldSendEvent("101返回主页曝光瀑布流曝光",null):2==t.openID?void window.platform.aldSendEvent("104所有取消跳转瀑布流曝光",null):3==t.openID?void window.platform.aldSendEvent("105开屏瀑布流曝光",null):4==t.openID?void window.platform.aldSendEvent("替换：轮播-瀑布流-曝光",null):void 0},t.prototype.open=function(){this.refresh(),this.sendEvent(),egret.Tween.get(this.scroller.viewport,{loop:!0}).to({scrollV:this.list.height-1e3},2e4).to({scrollV:0},2e4)},t.prototype.close=function(){return 1==this.isSuccess?(App.ControllerManager.applyFunc(EControllerID.GAME,EGameMessage.NEXT_LEVEL),void(this.isSuccess=0)):-1==this.isSuccess?(App.ControllerManager.applyFunc(EControllerID.GAME,EGameMessage.RESTAR_GAME),void(this.isSuccess=0)):void egret.Tween.removeTweens(this.scroller.viewport)},t.tmpItems=[],t.openID=-1,t}(BaseView);__reflect(SkipBoxView.prototype,"SkipBoxView");var SkipLikeItem=function(e){function t(){var t=e.call(this)||this;return t.index=-1,t.skinName="resource/ui/skip/skiplikeitem.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSkip,this)},t.prototype.dataChanged=function(){e.prototype.dataChanged.call(this),this.img.source=this.data.img,this.index=this.data.index},t.prototype.onSkip=function(){window.platform.aldSendEvent("107主页底部横条点击跳转",SkipLikeView.tmpData[this.index]._name_+""),SkipController.Instance.skipOtherGame(SkipLikeView.tmpData[this.index],this.onSkipSuc,this.onSkipFai)},t.prototype.onSkipSuc=function(e){window.platform.aldSendEvent("106游戏跳转成功-appID",e._parent_.appID+""),window.platform.aldSendEvent("106游戏跳转成功-名字",e._name_+""),window.platform.aldSendEvent("107主页底部横条跳转成功-appID",e._parent_.appID+""),window.platform.aldSendEvent("107主页底部横条跳转成功-名字",e._name_+""),SkipController.Instance.model.hideGameNew(e),App.ViewManager.getView(ESkipViewType.LIKE).updateInfo()},t.prototype.onSkipFai=function(e){window.platform.aldSendEvent("107主页底部横条跳转失败-appID",e._parent_.appID+""),window.platform.aldSendEvent("107主页底部横条跳转失败-名字",e._name_+""),SkipController.Instance.showView(ESkipViewType.BOX)},t}(eui.ItemRenderer);__reflect(SkipLikeItem.prototype,"SkipLikeItem");var SkipLikeView=function(e){function t(t){var n=e.call(this,t,null,ESkipViewType.LIKE)||this;return n.isSuccess=0,n.data=new eui.ArrayCollection,n.setSkinName("resource/ui/skip/skiplike.exml"),n.setLayer(EViewLayer.NORMAL),n}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.list.itemRenderer=SkipLikeItem,this.list.dataProvider=this.data,this.scroller.scrollPolicyH=eui.ScrollPolicy.ON,this.scroller.scrollPolicyV=eui.ScrollPolicy.OFF;var t=new eui.TileLayout;this.list.layout=t,t.orientation=eui.TileOrientation.ROWS,this.scroller.addEventListener(egret.Event.CHANGE,this.onScrollMove,this),this.updateInfo()},t.prototype.onScrollMove=function(){egret.Tween.removeTweens(this.scroller.viewport)},t.prototype.updateInfo=function(){if(0!=this.isShow()){if(0==SkipController.Instance.model.getAllItems(t.tmpData))return void this.closeSelf();this.data.removeAll(),this.list.width=0;for(var e=0;e<t.tmpData.length;++e)this.data.addItem({img:t.tmpData[e]._parent_.getSkinByData(t.tmpData[e]._subIndex_+1),index:e}),this.list.width+=140;this.data.refresh()}},t.prototype.open=function(){this.rect.width=890,this.scroller.width=805,window.platform.aldSendEvent("107主页底部横条曝光",null),this.updateInfo(),egret.Tween.get(this.scroller.viewport,{loop:!0}).to({scrollH:this.list.width-900},2e4).to({scrollH:0},2e4)},t.prototype.close=function(){egret.Tween.removeTweens(this.scroller.viewport)},t.tmpData=[],t}(BaseView);__reflect(SkipLikeView.prototype,"SkipLikeView");var SkipScreenAdView=function(e){function t(){var n=e.call(this)||this;return n.time=0,t.Instance=n,n.percentWidth=n.percentHeight=100,n}return __extends(t,e),t.prototype.getImgPath=function(e){var t=".";return"wxgame"==window.platform.getPlatformName()&&(t=App.resourceURL),t+="/resource/res/global/screen/"+e+".jpg"},t.prototype.createTips=function(){this.tips=new eui.Label,this.tips.size=34,this.tips.bold=!1,this.tips.fontFamily="微软雅黑",this.tips.textAlign=this.tips.verticalAlign="center",this.tips.top=72,this.tips.left=79,this.tips.textColor=268435455,this.tips.text=this.time+"秒后跳过",this.addChild(this.tips)},t.prototype.createImage=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(n){switch(n.label){case 0:return e=null,"debug"!=platform.getPlatformName()?[3,2]:[4,RES.getResByUrl("resource/wx/sr_b1.png")];case 1:return e=n.sent(),[3,4];case 2:return[4,window.platform.loadPackageIMG("resource/wx/sr_b1.png")];case 3:e=n.sent(),n.label=4;case 4:return t=new eui.Image(e),t.width=230,t.height=65,t.scale9Grid=new egret.Rectangle(22,6,20,43),t.top=60,t.left=25,this.addChild(t),[2]}})})},t.prototype.createAd=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return e=null,console.log(this.getImgPath(App.GlobalConfigure.GetNumberArr("skipScreenIndex",1))),[4,RES.getResByUrl(this.getImgPath(App.GlobalConfigure.GetNumberArr("skipScreenIndex",1)))];case 1:return e=t.sent(),this.img=new eui.Image(e),this.img.width=900,this.img.height=1600,this.img.top=0,this.img.bottom=0,this.img.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSkip,this),this.addChild(this.img),[2]}})})},t.prototype.show=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.createAd()];case 1:return e.sent(),[4,this.createImage()];case 2:return e.sent(),this.createTips(),[2]}})})},t.prototype.onSkipSuc=function(e){window.platform.aldSendEvent("开屏点击跳转成功-appID",e._parent_.appID+"")},t.prototype.onSkipFai=function(e){window.platform.aldSendEvent("开屏点击跳转失败-appID",e._parent_.appID+"")},t.prototype.onSkip=function(){this.close(),window.platform.aldSendEvent("点击开屏推荐",this.tmpData.appID+""),SkipController.Instance.skipOtherGame(this.tmpData.items[0],this.onSkipSuc,this.onSkipFai)},t.prototype.showView=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(n){switch(n.label){case 0:return"wxgame"!=platform.getPlatformName()?[2]:(App.MainSprite.addChild(this),this.top=this.bottom=0,e=App.GlobalConfigure.GetArray("skipScreenIndex"),t=e[0],0>t?(this.close(),[2]):(this.tmpData=new SkipData,this.tmpData.url=e[3],this.tmpData.appID=e[4],[4,this.show()]));case 1:return n.sent(),this.tmpData=SkipController.Instance.model.skipDatas[t],window.platform.aldSendEvent("开屏推荐曝光",this.tmpData.appID+""),this.time=App.GlobalConfigure.GetNumberArr("skipScreenIndex",2),App.Timer.doTimer(1e3,0,this.onCountDown,this),[2]}})})},t.prototype.onCountDown=function(){return this.time<0?void this.close():(this.tips.text=this.time+"秒后跳过",void this.time--)},t.prototype.close=function(){console.log("关闭"),App.MainSprite.removeChild(this),App.Timer.remove(this.onCountDown,this)},t}(eui.Component);__reflect(SkipScreenAdView.prototype,"SkipScreenAdView");var SkipWxMenuItem=function(e){function t(){var t=e.call(this)||this;return t.index=-1,t.skinName="resource/ui/skip/skipwxmenuitem.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSkip,this)},t.prototype.dataChanged=function(){e.prototype.dataChanged.call(this),this.img.source=this.data.img,this.index=this.data.index,this.labelName.text=this.data.name;var t=App.RandomUtils.limit(0,100);t>70?this.imgStar.visible=!0:this.imgStar.visible=!1},t.prototype.onSkip=function(){var e=SkipWxMenuView.tmpItems[this.index];window.platform.aldSendEvent("点击假微信跳转",e._name_+""),SkipController.Instance.skipOtherGame(e,this.onSkipSuc,this.onSkipFai)},t.prototype.onSkipSuc=function(e){window.platform.aldSendEvent("点击跳转成功-appID",e._parent_.appID+""),window.platform.aldSendEvent("点击跳转成功-名字",e._name_+""),SkipController.Instance.model.hideGameNew(e),App.ViewManager.getView(ESkipViewType.BOX).refresh()},t.prototype.onSkipFai=function(e){window.platform.aldSendEvent("点击跳转失败-appID",e._parent_.appID+""),window.platform.aldSendEvent("点击跳转失败-名字",e._name_+""),SkipController.Instance.showView(ESkipViewType.BOX)},t}(eui.ItemRenderer);__reflect(SkipWxMenuItem.prototype,"SkipWxMenuItem");var SkipWxMenuView=function(e){function t(t){var n=e.call(this,t,null,ESkipViewType.WXMENU)||this;return n.data=new eui.ArrayCollection,n.setSkinName("resource/ui/skip/skipwxmenu.exml"),n.setLayer(EViewLayer.NORMAL),n}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.top=this.bottom=0,this.list.itemRenderer=SkipWxMenuItem,this.list.dataProvider=this.data,this.scroller.scrollPolicyH=eui.ScrollPolicy.OFF,this.scroller.scrollPolicyV=eui.ScrollPolicy.ON;var t=new eui.TileLayout;this.list.layout=t,this.btnExit.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this)},t.prototype.refresh=function(){if(0!=this.isShow()){if(this.data.removeAll(),this.list.height=0,0==SkipController.Instance.model.getAllItems(t.tmpItems))return void this.closeSelf();for(var e=0;e<t.tmpItems.length;e++)this.data.addItem({name:t.tmpItems[e]._name_,img:t.tmpItems[e]._parent_.getSkinByData(t.tmpItems[e]._subIndex_+1),index:e}),this.list.height+=233;this.data.refresh()}},t.prototype.open=function(){this.x=900,egret.Tween.get(this).to({x:0},300,null),this.refresh()},t.prototype.onClose=function(){egret.Tween.get(this).to({x:900},300,null).call(function(){SkipController.Instance.closeView(ESkipViewType.WXMENU)},this)},t.tmpItems=[],t}(BaseView);__reflect(SkipWxMenuView.prototype,"SkipWxMenuView");var HmGunEntry=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.Init=function(e){this.id=this.castType(e[0],"number"),this.name=this.castType(e[1],"string"),this.gold=this.castType(e[2],"number"),this.view=this.castType(e[3],"number"),this.model=this.castType(e[4],"string")},t}(BaseEntry);__reflect(HmGunEntry.prototype,"HmGunEntry");var HmGunTable=function(e){function t(){return e.call(this,"hmgun_txt")||this}return __extends(t,e),Object.defineProperty(t,"Instance",{get:function(){return null==t.s_Instance&&(t.s_Instance=new t),t.s_Instance},enumerable:!0,configurable:!0}),t.prototype.getEntry=function(e){var t=null;return t=this.getBaseEntry(HmGunEntry,e)},t.prototype.getIndexsByKey=function(e){var t=null;return t=this.getBaseIndexsByKey(HmGunEntry,e)},t.prototype.getEntryByIndex=function(e){var t=null;return t=this.getBaseEntryByIndex(HmGunEntry,e)},t}(BaseTable);__reflect(HmGunTable.prototype,"HmGunTable");var HmSignEntry=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.Init=function(e){this.id=this.castType(e[0],"number"),this.type=this.castType(e[1],"number"),this.value=this.castType(e[2],"number"),this.iconid=this.castType(e[3],"number")},t}(BaseEntry);__reflect(HmSignEntry.prototype,"HmSignEntry");var HmSignTable=function(e){function t(){return e.call(this,"hmsign_txt")||this}return __extends(t,e),Object.defineProperty(t,"Instance",{get:function(){return null==t.s_Instance&&(t.s_Instance=new t),t.s_Instance},enumerable:!0,configurable:!0}),t.prototype.getEntry=function(e){var t=null;return t=this.getBaseEntry(HmSignEntry,e)},t.prototype.getIndexsByKey=function(e){var t=null;return t=this.getBaseIndexsByKey(HmSignEntry,e)},t.prototype.getEntryByIndex=function(e){var t=null;return t=this.getBaseEntryByIndex(HmSignEntry,e)},t}(BaseTable);__reflect(HmSignTable.prototype,"HmSignTable");var HmSkinEntry=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.Init=function(e){this.id=this.castType(e[0],"number"),this.name=this.castType(e[1],"string"),this.gold=this.castType(e[2],"number"),this.view=this.castType(e[3],"number"),this.model=this.castType(e[4],"string"),this.mouth=this.castType(e[5],"string")},t}(BaseEntry);__reflect(HmSkinEntry.prototype,"HmSkinEntry");var HmSkinTable=function(e){function t(){return e.call(this,"hmskin_txt")||this}return __extends(t,e),Object.defineProperty(t,"Instance",{get:function(){return null==t.s_Instance&&(t.s_Instance=new t),t.s_Instance},enumerable:!0,configurable:!0}),t.prototype.getEntry=function(e){var t=null;return t=this.getBaseEntry(HmSkinEntry,e)},t.prototype.getIndexsByKey=function(e){var t=null;return t=this.getBaseIndexsByKey(HmSkinEntry,e)},t.prototype.getEntryByIndex=function(e){var t=null;return t=this.getBaseEntryByIndex(HmSkinEntry,e)},t}(BaseTable);__reflect(HmSkinTable.prototype,"HmSkinTable");var HttpPromiseEmpty=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.start=function(){return console.log("empty request"+this.url),null},t}(HttpPromiseData);__reflect(HttpPromiseEmpty.prototype,"HttpPromiseEmpty");var HttpRequest=function(){function e(){this._isDone=!1,this.req=new egret.HttpRequest}return Object.defineProperty(e.prototype,"isDone",{get:function(){return this._isDone},enumerable:!0,configurable:!0}),e.prototype.onComplete=function(e){if(this._isDone=!0,e.type==egret.Event.COMPLETE){var t=e.currentTarget;this.data.callSuc(t.response),this._isDone=!0}else e.type==egret.IOErrorEvent.IO_ERROR&&(this.data.callErr(e.data),this._isDone=!0)},e.prototype.request=function(e){this.data=e,this._isDone=!1,this.req.responseType=this.data.responsType,this.req.open(this.data.url,this.data.method),this.req.send(),this.req.addEventListener(egret.Event.COMPLETE,this.onComplete,this),this.req.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onComplete,this)},e.prototype.clear=function(){var e=this.data;return this.data=null,this.req.removeEventListener(egret.Event.COMPLETE,this.onComplete,this),this.req.removeEventListener(egret.IOErrorEvent.IO_ERROR,this.onComplete,this),e},e}();__reflect(HttpRequest.prototype,"HttpRequest");var EViewID;!function(e){e[e.NONE=0]="NONE",e[e.MAIN_VIEW=1]="MAIN_VIEW",e[e.MENU_VIEW=2]="MENU_VIEW",e[e.SET_VIEW=3]="SET_VIEW",e[e.SUCCESS_VIEW=4]="SUCCESS_VIEW",e[e.GAME_PLAY_VIEW=5]="GAME_PLAY_VIEW",e[e.GAME_FAIL_VIEW=6]="GAME_FAIL_VIEW",e[e.GAME_PAUSE_VIEW=7]="GAME_PAUSE_VIEW",e[e.TIPS_VIEW=8]="TIPS_VIEW",e[e.GUIDE_VIEW=9]="GUIDE_VIEW",e[e.ROLE_VIEW=10]="ROLE_VIEW",e[e.GUN_VIEW=11]="GUN_VIEW",e[e.ENERGY_VIEW=12]="ENERGY_VIEW",e[e.MONEY_VIEW=13]="MONEY_VIEW",e[e.SIGN_VIEW=14]="SIGN_VIEW",e[e.GOLD_BOX_VIEW=15]="GOLD_BOX_VIEW",e[e.OTHERGAME_VIEW=16]="OTHERGAME_VIEW",e[e.MSG_VIEW=17]="MSG_VIEW",e[e.REQUEST_MESSAGE_VIEW=18]="REQUEST_MESSAGE_VIEW",e[e.LOTTERY_VIEW=19]="LOTTERY_VIEW",e[e.GAME_SHARE_VIEW=20]="GAME_SHARE_VIEW"}(EViewID||(EViewID={}));var EControllerID;!function(e){e[e.NONE=0]="NONE",e[e.MAIN=1]="MAIN",e[e.LOGIN=2]="LOGIN",e[e.GAME=3]="GAME",e[e.PROFIT=4]="PROFIT",e[e.BAG=5]="BAG"}(EControllerID||(EControllerID={}));var ModulesManager=function(){function e(){}return e.init=function(){console.log("egret ..ModulesManager... ",arguments),App.Sound.setEffectVolume(1),App.Sound.setBgVolume(1),e.initController(),new SceneManager,new ServerDataQueue,new MessageBoxView},e.initController=function(){App.ControllerManager.register(EControllerID.MAIN,new MainController),App.ControllerManager.register(EControllerID.LOGIN,new WXLoginController),App.ControllerManager.register(EControllerID.GAME,new GameController),App.ControllerManager.register(EControllerID.PROFIT,new ProfitController),App.ControllerManager.register(EControllerID.BAG,new BagController)},e}();__reflect(ModulesManager.prototype,"ModulesManager");var EBagMessage;!function(e){e[e.SKIN_GET=0]="SKIN_GET",e[e.GUN_GET=1]="GUN_GET",e[e.SKIN_BUY=2]="SKIN_BUY",e[e.SKIN_BUY_GUN=3]="SKIN_BUY_GUN",e[e.REFRESH_SKIN=4]="REFRESH_SKIN",e[e.REFRESH_GUN=5]="REFRESH_GUN"}(EBagMessage||(EBagMessage={}));var BagController=function(e){function t(){var t=e.call(this)||this;return t.skinId=0,t.skinGunId=0,t.model=new BagModel(t),t.roleSelectView=new RoleSelectView(t),t.gunSelectView=new GunSelectView(t),t.skinId=Number(egret.localStorage.getItem("skinId")),t.skinGunId=Number(egret.localStorage.getItem("skinGunId")),t.skinId||(t.skinId=0),t.skinGunId||(t.skinGunId=0),t.isHavedSkin=!1,t.isHaveGun=!1,t.registerFunc(EBagMessage.REFRESH_SKIN,t.refrshSkinList,t),t.registerFunc(EBagMessage.REFRESH_GUN,t.refrshGunList,t),t.registerFunc(EBagMessage.SKIN_GET,t.onSkinGet,t),t.registerFunc(EBagMessage.GUN_GET,t.onGunGet,t),t.registerFunc(EBagMessage.SKIN_BUY,t.onSkinBuy,t),t.registerFunc(EBagMessage.SKIN_BUY_GUN,t.onSkinBuyGun,t),t}return __extends(t,e),t.prototype.initByLoginAfter=function(){this.model.refreshSkin(),this.model.refreshGunSkin(),this.model.refreshNotGunSkins(),this.model.refreshNotRoleSkins();var e=HmSkinTable.Instance.getEntryByIndex(this.skinId+1);PlayerObj.Instance.changeSkin(e.model);var t=HmGunTable.Instance.getEntryByIndex(this.skinGunId+1);PlayerObj.Instance.changeGun(t.model)},t.prototype.onSkinGet=function(e){var t=this.model;t.ownerSkins.push(e),App.LoginInfo.skin=JSON.stringify(t.ownerSkins),ServerDataQueue.Instance.needUploadSkin=!0},t.prototype.onGunGet=function(e){var t=this.model;t.ownerGunSkins.push(e),App.LoginInfo.gunskin=JSON.stringify(t.ownerGunSkins),ServerDataQueue.Instance.needUploadGunSkin=!0},t.prototype.refrshSkinList=function(){this.roleSelectView.refreshList()},t.prototype.refrshGunList=function(){this.gunSelectView.refreshList()},t.prototype.onSkinBuy=function(e){var t=this.model,n=HmSkinTable.Instance.getEntryByIndex(e+1);App.LoginInfo.gold>=n.gold?(t.ownerSkins.push(e),App.LoginInfo.skin=JSON.stringify(t.ownerSkins),App.LoginInfo.gold-=n.gold,this.applyControllerFunc(EControllerID.MAIN,EMainMessage.CHANGE_MONEY),this.skinId=e,ServerDataQueue.Instance.needUploadSkin=!0):App.GlobalConfigure.getLocalTodayNumber("todayVedio")<App.GlobalConfigure.GetNumber("maxVedioAddGold")?App.ViewManager.open(EViewID.MONEY_VIEW):App.ViewManager.open(EViewID.TIPS_VIEW,"金币不够哟~")},t.prototype.onSkinBuyGun=function(e){var t=this.model,n=HmGunTable.Instance.getEntryByIndex(e+1);App.LoginInfo.gold>=n.gold?(t.ownerGunSkins.push(e),App.LoginInfo.gunskin=JSON.stringify(t.ownerGunSkins),App.LoginInfo.gold-=n.gold,this.applyControllerFunc(EControllerID.MAIN,EMainMessage.CHANGE_MONEY),this.skinGunId=e,ServerDataQueue.Instance.needUploadGunSkin=!0):App.GlobalConfigure.getLocalTodayNumber("todayVedio")<App.GlobalConfigure.GetNumber("maxVedioAddGold")?App.ViewManager.open(EViewID.MONEY_VIEW):App.ViewManager.open(EViewID.TIPS_VIEW,"金币不够哟~")},t}(BaseController);__reflect(BagController.prototype,"BagController");var BagModel=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.ownerSkins=[],t.ownerGunSkins=[],t.notRoleSkins=[],t.notGunSkins=[],t}return __extends(t,e),t.prototype.haveSkins=function(e){return this.ownerSkins.indexOf(e)>=0},t.prototype.haveGunSkins=function(e){return this.ownerGunSkins.indexOf(e)>=0},t.prototype.refreshSkin=function(){this.ownerSkins=new Array,this.ownerSkins.push(0);try{(null==App.LoginInfo.skin||""==App.LoginInfo.skin)&&(App.LoginInfo.skin="[]");for(var e=JSON.parse(App.LoginInfo.skin),t=e.length,n=0;t>n;++n){var o=Number(e[n]);0!=o&&this.ownerSkins.indexOf(o)<0&&this.ownerSkins.push(Number(e[n]))}}catch(i){console.error("can't parser json."),console.error(App.LoginInfo)}},t.prototype.refreshGunSkin=function(){this.ownerGunSkins=new Array,this.ownerGunSkins.push(0);try{(null==App.LoginInfo.gunskin||""==App.LoginInfo.gunskin)&&(App.LoginInfo.gunskin="[]");for(var e=JSON.parse(App.LoginInfo.gunskin),t=e.length,n=0;t>n;++n){var o=Number(e[n]);0!=o&&this.ownerGunSkins.indexOf(o)<0&&this.ownerGunSkins.push(Number(e[n]))}}catch(i){console.error("can't parser json."),console.error(App.LoginInfo)}},t.prototype.refreshNotGunSkins=function(){this.notGunSkins=new Array,this.notGunSkins.splice(0);for(var e=0;e<HmGunTable.Instance.count;e++){var t=HmGunTable.Instance.getEntryByIndex(e+1);this.ownerGunSkins.indexOf(e)<0&&t.gold>0&&this.notGunSkins.push(e)}},t.prototype.refreshNotRoleSkins=function(){this.notRoleSkins=new Array,this.notRoleSkins.splice(0);for(var e=0;e<HmSkinTable.Instance.count;e++){var t=HmSkinTable.Instance.getEntryByIndex(e+1);this.ownerSkins.indexOf(e)<0&&t.gold>0&&this.notRoleSkins.push(e)}},t}(BaseModel);__reflect(BagModel.prototype,"BagModel");var GunSelectRender=function(e){function t(){var t=e.call(this)||this;return t.skinName="resource/ui/main/gunRender.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.gunSelect.addEventListener(egret.TouchEvent.TOUCH_TAP,this.gunSelection,this),this.setGroup.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBuyGun,this)},t.prototype.gunSelection=function(){var e=App.ControllerManager.getControllerModel(EControllerID.BAG);e.haveGunSkins(this.index)&&(App.ControllerManager.getController(EControllerID.BAG).skinGunId=this.index,App.ControllerManager.applyFunc(EControllerID.BAG,EBagMessage.REFRESH_GUN)),RoleManager.Instance.player.anim.changeGun(),App.Timer.doTimer(400,1,this.onTimer,this)},t.prototype.onTimer=function(){var e=HmGunTable.Instance.getEntryByIndex(this.index+1);PlayerObj.Instance.changeGun(e.model),App.Timer.doTimer(470,1,this.Sound,this)},t.prototype.Sound=function(){App.Sound.playEffect("reload.mp3")},t.prototype.onBuyGun=function(){0==this.isHaveGun?(this.data.gold>0?App.ControllerManager.applyFunc(EControllerID.BAG,EBagMessage.SKIN_BUY_GUN,this.index):App.ViewManager.open(EViewID.TIPS_VIEW,"该皮肤暂不支持购买"),App.ControllerManager.applyFunc(EControllerID.BAG,EBagMessage.REFRESH_GUN)):this.gunSelection()},t.prototype.dataChanged=function(){e.prototype.dataChanged.call(this),this.index=this.data.index,this.isHaveGun=this.data.isHaveGun;var t=PlayerObj.Instance.getHeadBitmapByName("gun/"+this.data.model);null!=t&&(this.gunhead.width=t.width,this.gunhead.height=t.height,this.gunhead.source=t.texture),this.data.isHaveGun?(this.gunbg.source="gunnochoose",this.setImage.visible=!1,this.setMoney.visible=!1,this.labelText.visible=!0,this.data.isSelect?(this.gunbg.source="gunchoose",this.labelText.text="正在使用",this.setBg.source="btn_1",this.setBg.scale9Grid=new egret.Rectangle(16,19,34,261)):(this.labelText.text="点击使用",this.setBg.scale9Grid=new egret.Rectangle(14,16,25,87),this.setBg.source="Tipsbtn")):-1==this.data.gold?(this.setImage.source="watchvideos",this.setMoney.text="免费领取",this.setMoney.size=20,this.labelText.visible=!1):-2==this.data.gold?(this.setImage.visible=!1,this.setMoney.visible=!1,this.labelText.visible=!0,this.labelText.text="签到获得"):(this.setImage.source="money",this.setMoney.text=this.data.gold+"",this.labelText.visible=!1)},t}(eui.ItemRenderer);__reflect(GunSelectRender.prototype,"GunSelectRender");var GunSelectView=function(e){function t(t){var n=e.call(this,t,null,EViewID.GUN_VIEW)||this;return n.data=new eui.ArrayCollection,n.setSkinName("resource/ui/main/gun.exml"),n.setLayer(EViewLayer.NORMAL),n.percentWidth=100,n.percentHeight=100,n}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.BackBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.closeGunView,this),this.gunList.itemRenderer=GunSelectRender,this.gunList.dataProvider=this.data;var t=new eui.TileLayout;t.orientation=eui.TileOrientation.COLUMNS,t.verticalGap=34,t.horizontalGap=10,t.requestedRowCount=2,this.gunList.layout=t,this.gunScroller.scrollPolicyV=eui.ScrollPolicy.OFF,this.gunScroller.scrollPolicyH=eui.ScrollPolicy.ON},t.prototype.closeGunView=function(){App.Sound.playEffect("reload.mp3"),this.closeSelf()},t.prototype.onTimer=function(){PlayerObj.Instance.changeGun(this.k),App.Timer.doTimer(470,1,this.onSound,this)},t.prototype.onSound=function(){App.Sound.playEffect("reload.mp3")},t.prototype.refreshList=function(){var e=this.controller.getModel().ownerGunSkins;this.data.removeAll(),this.gunList.width=0;for(var t=0;t<HmGunTable.Instance.count;t++){var n=!1,o=!1,i=HmGunTable.Instance.getEntryByIndex(t+1);t==App.ControllerManager.getController(EControllerID.BAG).skinGunId&&(n=!0,RoleManager.Instance.player.anim.changeGun(),this.k=i.model,App.Timer.doTimer(400,1,this.onTimer,this)),e.indexOf(t)>=0&&(o=!0),this.data.addItem({index:t,isSelect:n,model:i.model,isHaveGun:o,gold:i.gold}),t%2==0&&(this.gunList.width+=178)}this.data.refresh()},t.prototype.isHaveGun=function(){var e=App.ControllerManager.getController(EControllerID.BAG).skinGunId,t=HmGunTable.Instance.getEntryByIndex(e+1);PlayerObj.Instance.changeGun(t.model),egret.localStorage.setItem("skinGunId",e+"")},t.prototype.open=function(){this.refreshList(),App.ViewManager.getView(EViewID.MENU_VIEW).isShowTip=!0,App.ControllerManager.applyFunc(EControllerID.PROFIT,EProfitMessage.HIDE_BANNER),App.ViewManager.getView(EViewID.MENU_VIEW).roleSelection.visible=!1},t.prototype.close=function(){this.isHaveGun(),App.ControllerManager.applyFunc(EControllerID.PROFIT,EProfitMessage.SHOW_BANNER),App.ViewManager.getView(EViewID.MENU_VIEW).roleSelection.visible=!0},t}(BaseView);__reflect(GunSelectView.prototype,"GunSelectView");var RoleSelectRender=function(e){function t(){var t=e.call(this)||this;return t.skinName="resource/ui/main/roleRender.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.roleSelect.addEventListener(egret.TouchEvent.TOUCH_TAP,this.roleSelection,this),this.setGroup.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBuy,this)},t.prototype.roleSelection=function(){var e=App.ControllerManager.getControllerModel(EControllerID.BAG);e.haveSkins(this.index)&&(App.ControllerManager.getController(EControllerID.BAG).skinId=this.index,App.ControllerManager.applyFunc(EControllerID.BAG,EBagMessage.REFRESH_SKIN)),PlayerObj.Instance.changeSkin(this.data.model),App.Sound.playEffect("reload.mp3"),RoleManager.Instance.player.anim.playerCheer()},t.prototype.onBuy=function(){0==this.ishaveskin?this.data.gold>0?App.ControllerManager.applyFunc(EControllerID.BAG,EBagMessage.SKIN_BUY,this.index):App.ViewManager.open(EViewID.TIPS_VIEW,"该皮肤暂不支持购买"):this.roleSelection(),App.ControllerManager.applyFunc(EControllerID.BAG,EBagMessage.REFRESH_SKIN),App.Sound.playEffect("reload.mp3")},t.prototype.dataChanged=function(){e.prototype.dataChanged.call(this),this.ishaveskin=this.data.ishaveskin,this.index=this.data.index;var t,n=PlayerObj.Instance.getHeadBitmapByName(this.data.head);"null"!=this.data.mouth&&(t=PlayerObj.Instance.getHeadBitmapByName(this.data.mouth),this.roleMouth.width=t.width,this.roleMouth.height=t.height,this.roleMouth.source=t.texture),null!=n&&(this.rolehead.width=n.width,this.rolehead.height=n.height,this.rolehead.source=n.texture),this.data.ishaveskin?(this.roleBg.source="gunnochoose",this.data.isSelect?(this.roleBg.source="gunchoose",this.setImage.visible=!1,this.setMoney.visible=!1,this.labelText.visible=!0,this.labelText.text="正在使用",this.setBg.source="btn_1",this.setBg.scale9Grid=new egret.Rectangle(16,19,34,261)):(this.setImage.visible=!1,this.setMoney.visible=!1,this.labelText.visible=!0,this.labelText.text="点击使用",this.setBg.scale9Grid=new egret.Rectangle(14,16,25,87),this.setBg.source="Tipsbtn")):-1==this.data.gold?(this.setImage.source="watchvideos",this.setMoney.text="免费领取",this.setMoney.size=20,this.labelText.visible=!1):-2==this.data.gold?(this.setImage.visible=!1,this.setMoney.visible=!1,this.labelText.visible=!0,this.labelText.text="签到获得"):(this.setImage.source="money",this.setMoney.text=this.data.gold,this.labelText.visible=!1)},t}(eui.ItemRenderer);__reflect(RoleSelectRender.prototype,"RoleSelectRender");var RoleSelectView=function(e){function t(t){var n=e.call(this,t,null,EViewID.ROLE_VIEW)||this;return n.data=new eui.ArrayCollection,n.setSkinName("resource/ui/main/role.exml"),n.setLayer(EViewLayer.NORMAL),n.percentWidth=100,n.percentHeight=100,n}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.backBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.closeRoleView,this),this.roleList.itemRenderer=RoleSelectRender,this.roleList.dataProvider=this.data;var t=new eui.TileLayout;t.orientation=eui.TileOrientation.COLUMNS,t.verticalGap=34,t.horizontalGap=10,t.requestedRowCount=2,this.roleList.layout=t,this.roleScroller.scrollPolicyV=eui.ScrollPolicy.OFF,this.roleScroller.scrollPolicyH=eui.ScrollPolicy.ON
},t.prototype.refreshList=function(){var e=this.controller.getModel().ownerSkins;this.data.removeAll(),this.roleList.width=0;for(var t=RES.getRes("skin_json"),n=0;n<HmSkinTable.Instance.count;n++){var o=!1,i=!1,r=HmSkinTable.Instance.getEntryByIndex(n+1);n==App.ControllerManager.getController(EControllerID.BAG).skinId&&(o=!0,PlayerObj.Instance.changeSkin(r.model)),e.indexOf(n)>=0&&(i=!0),this.data.addItem({index:n,isSelect:o,model:r.model,head:t.role[r.model].head,ishaveskin:i,mouth:r.mouth,gold:r.gold}),n%2==0&&(this.roleList.width+=178)}this.data.refresh()},t.prototype.closeRoleView=function(){App.Sound.playEffect("reload.mp3"),this.closeSelf()},t.prototype.isHaveSkin=function(){var e=App.ControllerManager.getController(EControllerID.BAG).skinId,t=HmSkinTable.Instance.getEntryByIndex(e+1);PlayerObj.Instance.changeSkin(t.model),egret.localStorage.setItem("skinId",e+"")},t.prototype.open=function(){this.refreshList(),App.ViewManager.getView(EViewID.MENU_VIEW).isShowTip=!0,App.ControllerManager.applyFunc(EControllerID.PROFIT,EProfitMessage.HIDE_BANNER),App.ViewManager.getView(EViewID.MENU_VIEW).gunSelection.visible=!1},t.prototype.close=function(){this.isHaveSkin(),App.ControllerManager.applyFunc(EControllerID.PROFIT,EProfitMessage.SHOW_BANNER),App.ViewManager.getView(EViewID.MENU_VIEW).gunSelection.visible=!0},t}(BaseView);__reflect(RoleSelectView.prototype,"RoleSelectView");var EGameMessage;!function(e){e[e.START_GAME=0]="START_GAME",e[e.GAME_OVER=1]="GAME_OVER",e[e.QUIT_GAME=2]="QUIT_GAME",e[e.RESTAR_GAME=3]="RESTAR_GAME",e[e.NEXT_LEVEL=4]="NEXT_LEVEL"}(EGameMessage||(EGameMessage={}));var GameController=function(e){function t(){var t=e.call(this)||this;return t.newPlayerStart=!0,t.failcnt=0,t.noviceGuideView=new NoviceGuideView(t),t.gameSuccessView=new GameSuccessView(t),t.gamePlayView=new GamePlayView(t),t.gamePauseView=new GamePauseView(t),t.gameFailView=new GameFailView(t),t.gameShareView=new GameShareView(t),t.registerFunc(EGameMessage.START_GAME,t.onStartGame,t),t.registerFunc(EGameMessage.QUIT_GAME,t.onQuitGame,t),t.registerFunc(EGameMessage.RESTAR_GAME,t.onRestartGame,t),t.registerFunc(EGameMessage.NEXT_LEVEL,t.onNext,t),t.registerFunc(EGameMessage.GAME_OVER,t.onGameOver,t),t}return __extends(t,e),t.prototype.onStartGame=function(){App.ViewManager.open(EViewID.GAME_PLAY_VIEW),this.applyControllerFunc(EControllerID.MAIN,EMainMessage.REQUEST_LEVEL,SceneManager.Instance.gameLevelCtrl.getNowLevel()),this.applyControllerFunc(EControllerID.MAIN,EMainMessage.CHANGE_REWARD,EProfitType.ENERGY,-1,0,!1)},t.prototype.onQuitGame=function(){1!=SceneManager.Instance.isSuccess&&(SceneManager.Instance.clear(),App.ViewManager.close(EViewID.GAME_PLAY_VIEW),App.ViewManager.open(EViewID.MENU_VIEW))},t.prototype.onRestartGame=function(){1!=SceneManager.Instance.isSuccess&&(SceneManager.Instance.clear(),this.applyControllerFunc(EControllerID.MAIN,EMainMessage.CHANGE_REWARD,EProfitType.ENERGY,-1,0,!1),this.applyControllerFunc(EControllerID.MAIN,EMainMessage.REQUEST_LEVEL,SceneManager.Instance.gameLevelCtrl.getNowLevel()))},t.prototype.onNext=function(){App.ViewManager.close(EViewID.SUCCESS_VIEW),SceneManager.Instance.clear();var e=App.ViewManager.getView(EViewID.GAME_PLAY_VIEW);e.refresh(),this.applyControllerFunc(EControllerID.MAIN,EMainMessage.CHANGE_REWARD,EProfitType.ENERGY,-1,0,!1),this.applyControllerFunc(EControllerID.MAIN,EMainMessage.REQUEST_LEVEL,SceneManager.Instance.gameLevelCtrl.getNowLevel())},t.prototype.onGameOver=function(){SceneManager.Instance.gameLevelCtrl.gameSuccess(),this.applyControllerFunc(EControllerID.MAIN,EMainMessage.CHANGE_REWARD,EProfitType.GOLD,App.GlobalConfigure.GetNumber("successGold"),0,!1)},t}(BaseController);__reflect(GameController.prototype,"GameController");var GamePlayerModel=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t}(BaseModel);__reflect(GamePlayerModel.prototype,"GamePlayerModel");var GameFailView=function(e){function t(t){var n=e.call(this,t,null,EViewID.GAME_FAIL_VIEW)||this;return n.setSkinName("resource/ui/game/gamefail.exml"),n.setLayer(EViewLayer.NORMAL),n.percentWidth=100,n.percentHeight=100,n}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.btnSkip.onClick(this.onSkip,this),this.btnReplay.onClick(this.onReplay,this),this.labelReturn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onMenu,this),this.share.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onShare,this)},t.prototype.onMenu=function(){this.applyFunc(EGameMessage.QUIT_GAME),this.closeSelf()},t.prototype.onShare=function(){this.applyControllerFunc(EControllerID.PROFIT,EProfitMessage.SHARE,null,null,null,"通关成功分享")},t.prototype.onSkip=function(){App.Sound.playEffect("pushbuttonE.mp3")},t.prototype.onReplay=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){return Energy.Instance.energy>0?(e=function(){var e=SkipController.Instance.showView(ESkipViewType.BOX);e?e.isSuccess=-1:App.ControllerManager.applyFunc(EControllerID.GAME,EGameMessage.NEXT_LEVEL),this.closeSelf()},e.call(this)):App.ControllerManager.getControllerModel(EControllerID.MAIN).todayBuyEneryCount<App.GlobalConfigure.GetNumber("maxBuyEneryCount")?App.ViewManager.open(EViewID.ENERGY_VIEW):App.ViewManager.open(EViewID.TIPS_VIEW,"体力不够了啦"),App.Sound.playEffect("pushbuttonE.mp3"),[2]})})},t.prototype.open=function(){e.prototype.open.call(this),this.applyControllerFunc(EControllerID.PROFIT,EProfitMessage.TRY_SHOW_ON_END)},t.prototype.close=function(){SkipController.Instance.closeView(ESkipViewType.BIGLIKESIX),this.applyControllerFunc(EControllerID.PROFIT,EProfitMessage.HIDE_BANNER)},t}(BaseView);__reflect(GameFailView.prototype,"GameFailView");var GamePauseView=function(e){function t(t){var n=e.call(this,t,null,EViewID.GAME_PAUSE_VIEW)||this;return n.setSkinName("resource/ui/game/gamepause.exml"),n.setLayer(EViewLayer.NORMAL),n.percentWidth=100,n.percentHeight=100,n}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.btnReturn.onClick(this.onReturn,this),this.btnContinue.onClick(this.onClose,this)},t.prototype.onReturn=function(){this.applyFunc(EGameMessage.QUIT_GAME),this.closeSelf(),App.Sound.playEffect("pushbuttonE.mp3")},t.prototype.onClose=function(){platform.recordResume(),this.closeSelf(),App.Sound.playEffect("pushbuttonE.mp3")},t.prototype.open=function(){platform.recordPause(),"qq"==platform.getPlatformName()&&App.LoginInfo.qqwhite&&platform.showAppBox()},t}(BaseView);__reflect(GamePauseView.prototype,"GamePauseView");var GamePlayView=function(e){function t(t){var n=e.call(this,t,null,EViewID.GAME_PLAY_VIEW)||this;return n.setSkinName("resource/ui/game/gameplay.exml"),n.setLayer(EViewLayer.NORMAL),n.percentWidth=100,n.percentHeight=100,n}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.btnPause.onClick(this.onPause,this),this.btnReplay.onClick(this.onReplay,this)},t.prototype.onPause=function(){App.ViewManager.open(EViewID.GAME_PAUSE_VIEW),App.Sound.playEffect("pushbuttonE.mp3")},t.prototype.onReplay=function(){App.ViewManager.open(EViewID.TIPS_VIEW,"体力-1，重新装弹"),this.applyFunc(EGameMessage.RESTAR_GAME),App.Sound.playEffect("pushbuttonE.mp3")},t.prototype.refresh=function(){this.labelLevel.text="LEVEL "+(App.LoginInfo.level+1)},t.prototype.refreshBullet=function(){for(var e=1;7>=e;e++){var t=this.grpBullet.getChildByName("b"+e);e<=BulletManager.Instance.bulletNum?t.visible=!0:this.grpBullet.getChildByName("b"+e).visible=!1,e>BulletManager.Instance.bulletUseNum?t.source="bullet":t.source="bullet_1"}this.rect.height=70*BulletManager.Instance.bulletNum+20},t.prototype.hideContent=function(){egret.Tween.get(this).to({alpha:0},200),this.touchEnabled=this.touchChildren=!1},t.prototype.showContent=function(){egret.Tween.get(this).to({alpha:1},200),this.touchEnabled=this.touchChildren=!0},t.prototype.open=function(){this.refresh(),App.Sound.playBg("gamebgm.mp3")},t.prototype.openAndopen=function(){e.prototype.openAndopen.call(this)},t.prototype.close=function(){egret.Tween.removeTweens(this)},t}(BaseView);__reflect(GamePlayView.prototype,"GamePlayView");var GameShareView=function(e){function t(t){var n=e.call(this,t,null,EViewID.GAME_SHARE_VIEW)||this;return n.setSkinName("resource/ui/game/gameshare.exml"),n.setLayer(EViewLayer.NORMAL),n.percentWidth=100,n.percentHeight=100,n}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.btn_qx.addEventListener(egret.TouchEvent.TOUCH_TAP,this.closeSelf,this),this.g_btn_share.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onShare,this),this.btn_share.onClick(this.onShare,this)},t.prototype.onSafeMode=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return this.btn_qx.visible=!e,e?[4,App.sleep(t)]:[3,2];case 1:n.sent(),this.btn_qx.visible=!0,n.label=2;case 2:return[2]}})})},t.prototype.onShare=function(){var e=this;platform.gameRecorderOnShare("杀手精英",function(){var t="win"==e.currentState?300:200;e.applyControllerFunc(EControllerID.MAIN,EMainMessage.CHANGE_REWARD,EProfitType.GOLD,t,0,!1),e.closeSelf()},function(t){t&&0==t.errMsg.indexOf("shareAppMessage:fail video file is too short")&&App.ViewManager.open(EViewID.TIPS_VIEW,"视频太短，不能分享录屏"),e.closeSelf()})},t.prototype.open=function(t){e.prototype.open.call(this),this.currentState="win"==t?"win":"fail",this.applyControllerFunc(EControllerID.PROFIT,EProfitMessage.SHOW_BANNER)},t.prototype.close=function(){},t}(BaseView);__reflect(GameShareView.prototype,"GameShareView");var GameSuccessView=function(e){function t(t){var n=e.call(this,t,null,EViewID.SUCCESS_VIEW)||this;return n.setSkinName("resource/ui/game/gamesuccess.exml"),n.setLayer(EViewLayer.NORMAL),n.percentWidth=100,n.percentHeight=100,n}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.continueGame.addEventListener(egret.TouchEvent.TOUCH_TAP,this.ContinueGame,this),this.lab_draw.addEventListener(egret.TouchEvent.TOUCH_TAP,this.ContinueGame,this),this.btnReplay.onClick(this.onReplay,this),this.btn_back.onClick(this.onReplay,this),this.btn_draw.onClick(this.onDraw,this),this.share.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onShare,this)},t.prototype.onShare=function(){this.applyControllerFunc(EControllerID.PROFIT,EProfitMessage.SHARE,null,null,null,"通关成功分享")},t.prototype.timeLate=function(){0!=this.isShow()&&(this.btnReplay.bottom=500,this.continueGame.bottom=400,this.share.bottom=400,this.applyControllerFunc(EControllerID.PROFIT,EProfitMessage.SHOW_BANNER))},t.prototype.onDraw=function(){this.applyControllerFunc(EControllerID.PROFIT,EProfitMessage.VIEW_ADVERT,this.onViewSuc,this.onViewFai,this,"99抽奖视频")},t.prototype.onViewSuc=function(){this.applyControllerFunc(EControllerID.MAIN,EMainMessage.CHANGE_REWARD,EProfitType.GOLD,2*App.GlobalConfigure.GetNumber("successGold"),0,!1),this.ContinueGame()},t.prototype.onViewFai=function(){var e=App.ControllerManager.getControllerModel(EControllerID.PROFIT);1==e.canUseVideo()?App.ViewManager.open(EViewID.TIPS_VIEW,"观看完广告才能获得奖励哟！"):App.ViewManager.open(EViewID.TIPS_VIEW,"分享成功才能获得奖励哟！")},t.prototype.ContinueGame=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return Energy.Instance.energy>0?(e=function(){var e=SkipController.Instance.showView(ESkipViewType.BOX);e?e.isSuccess=1:App.ControllerManager.applyFunc(EControllerID.GAME,EGameMessage.NEXT_LEVEL)},"qq"!=platform.getPlatformName()?[3,2]:[4,platform.showInterstitial()]):[3,3];case 1:if(t.sent(),App.LoginInfo.qqwhite)return App.ViewManager.open(EViewID.GOLD_BOX_VIEW,e,this),[2];t.label=2;case 2:return e(),[3,4];case 3:App.ControllerManager.getControllerModel(EControllerID.MAIN).todayBuyEneryCount<App.GlobalConfigure.GetNumber("maxBuyEneryCount")?App.ViewManager.open(EViewID.ENERGY_VIEW):App.ViewManager.open(EViewID.TIPS_VIEW,"体力不够了啦"),t.label=4;case 4:return App.Sound.playEffect("pushbuttonE.mp3"),[2]}})})},t.prototype.onReplay=function(){this.applyFunc(EGameMessage.QUIT_GAME),this.closeSelf()},t.prototype.RefreshProgress=function(){this.progressPercentage.text=(App.LoginInfo.level%10+1)/10*100+"%",this.displayProgress.width=(App.LoginInfo.level%10+1)/10*420,this.labelgold.text="+"+App.GlobalConfigure.GetNumber("successGold")},t.prototype.open=function(){e.prototype.open.call(this),this.RefreshProgress(),App.Sound.playEffect("oversuccessE.mp3"),this.applyControllerFunc(EControllerID.PROFIT,EProfitMessage.TRY_SHOW_ON_END)},t.prototype.close=function(){SkipController.Instance.closeView(ESkipViewType.BIGLIKESIX),this.applyControllerFunc(EControllerID.PROFIT,EProfitMessage.HIDE_BANNER)},t}(BaseView);__reflect(GameSuccessView.prototype,"GameSuccessView");var NoviceGuideView=function(e){function t(t){var n=e.call(this,t,null,EViewID.GUIDE_VIEW)||this;return n.setSkinName("resource/ui/game/noviceguide.exml"),n.setLayer(EViewLayer.NORMAL),n.percentWidth=100,n.percentHeight=100,n}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.guideConfirm.addEventListener(egret.TouchEvent.TOUCH_TAP,this.closeSelf,this)},t.prototype.gameGuide=function(){var e=App.ViewManager.getView(EViewID.GUIDE_VIEW);egret.Tween.get(this.demonstration,{loop:!0}).wait(1e3).wait(100).to({rotation:-10},1e3,egret.Ease.sineIn).call(function(){e.guideWoodBox.visible=!0}).to({rotation:20},3e3,egret.Ease.sineOut).wait(200).call(function(){e.guideWoodBox.visible=!1,e.blast.visible=!0,e.bullletexplosion.visible=!0,e.bulletRay_0.visible=!1}).wait(200).call(function(){e.blast.visible=!1,e.bullletexplosion.visible=!1,e.bulletRay_0.visible=!0}).wait(600),egret.Tween.get(this.guideFinger,{loop:!0}).wait(1e3).call(function(){e.guideFinger.scaleX=e.guideFinger.scaleY=.7,e.fingerEffect.visible=!0}).wait(100).call(function(){e.fingerEffect.visible=!1}).to({y:200},1e3,egret.Ease.sineIn).to({y:400},3e3,egret.Ease.sineOut).wait(200).call(function(){e.guideFinger.scaleX=e.guideFinger.scaleY=1,e.guideConfirm.visible=!0,e.nextView.visible=!0}).wait(200).wait(600)},t.prototype.open=function(){this.gameGuide()},t.prototype.close=function(){egret.Tween.removeTweens(this.guideFinger),egret.Tween.removeTweens(this.demonstration)},t}(BaseView);__reflect(NoviceGuideView.prototype,"NoviceGuideView");var GameLoadingView=function(e){function t(){var n=e.call(this)||this;return n.tipsText="",t.Instance=n,n.percentWidth=n.percentHeight=100,n}return __extends(t,e),t.prototype.createLoadingBg=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(n){switch(n.label){case 0:return e=null,"debug"!=platform.getPlatformName()?[3,2]:[4,RES.getResByUrl("resource/wx/logo_bg.png")];case 1:return e=n.sent(),[3,4];case 2:return[4,window.platform.loadPackageIMG("resource/wx/logo_bg.png")];case 3:e=n.sent(),n.label=4;case 4:return t=new eui.Image(e),t.width=900,t.height=2e3,t.scale9Grid=new egret.Rectangle(3,3,3,3),this.addChild(t),[2]}})})},t.prototype.createCloudZero=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(n){switch(n.label){case 0:return e=null,"debug"!=platform.getPlatformName()?[3,2]:[4,RES.getResByUrl("resource/wx/flakyCloud.png")];case 1:return e=n.sent(),[3,4];case 2:return[4,window.platform.loadPackageIMG("resource/wx/flakyCloud.png")];case 3:e=n.sent(),n.label=4;case 4:return t=new eui.Image(e),t.width=289,t.height=137,t.left=0,t.top=84,this.addChild(t),[2]}})})},t.prototype.createCloudOne=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(n){switch(n.label){case 0:return e=null,"debug"!=platform.getPlatformName()?[3,2]:[4,RES.getResByUrl("resource/wx/flakyCloud.png")];case 1:return e=n.sent(),[3,4];case 2:return[4,window.platform.loadPackageIMG("resource/wx/flakyCloud.png")];case 3:e=n.sent(),n.label=4;case 4:return t=new eui.Image(e),t.width=203,t.height=97,t.left=106,t.top=574,this.addChild(t),[2]}})})},t.prototype.createCloudTwo=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(n){switch(n.label){case 0:return e=null,"debug"!=platform.getPlatformName()?[3,2]:[4,RES.getResByUrl("resource/wx/flakyCloud.png")];case 1:return e=n.sent(),[3,4];case 2:return[4,window.platform.loadPackageIMG("resource/wx/flakyCloud.png")];case 3:e=n.sent(),n.label=4;case 4:return t=new eui.Image(e),t.width=300,t.height=165,t.left=642,t.top=689,this.addChild(t),[2]}})})},t.prototype.createProgressWheel=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return e=null,"debug"!=platform.getPlatformName()?[3,2]:[4,RES.getResByUrl("resource/wx/progresswheel.png")];case 1:return e=t.sent(),[3,4];case 2:return[4,window.platform.loadPackageIMG("resource/wx/progresswheel.png")];case 3:e=t.sent(),t.label=4;case 4:return this.progressWheel=new eui.Image(e),this.progressWheel.width=75,this.progressWheel.height=75,this.progressWheel.left=141,this.progressWheel.top=909,this.addChild(this.progressWheel),[2]}})})},t.prototype.createTips=function(){this.tips=new eui.Label,this.tips.percentWidth=100,this.tips.size=45,this.tips.bold=!0,this.tips.height=80,this.tips.stroke=2,this.tips.strokeColor=8742969,this.tips.fontFamily="微软雅黑",this.tips.textAlign=this.tips.verticalAlign="center",this.tips.y=1070,this.addChild(this.tips)},t.prototype.createProgress=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(n){switch(n.label){case 0:return e=null,"debug"!=platform.getPlatformName()?[3,2]:[4,RES.getResByUrl("resource/wx/progress.png")];case 1:return e=n.sent(),[3,4];case 2:return[4,window.platform.loadPackageIMG("resource/wx/progress.png")];case 3:e=n.sent(),n.label=4;case 4:return t=new eui.Image(e),t.width=631,t.height=52,t.x=165,t.y=985,this.addChild(t),"debug"!=platform.getPlatformName()?[3,6]:[4,RES.getResByUrl("resource/wx/progressbk.png")];case 5:return e=n.sent(),[3,8];case 6:return[4,window.platform.loadPackageIMG("resource/wx/progressbk.png")];case 7:e=n.sent(),n.label=8;case 8:return this.progressbk=new eui.Image(e),this.progressbk.width=618,this.progressbk.height=40,this.progressbk.scale9Grid=new egret.Rectangle(11,8,12,19),this.progressbk.right=111,this.progressbk.x=171,this.progressbk.y=991,this.addChild(this.progressbk),[2]}})})},t.prototype.createLogo=function(){return __awaiter(this,void 0,void 0,function(){var e,n,o;return __generator(this,function(i){switch(i.label){case 0:return"debug"!=platform.getPlatformName()?[3,2]:(e=t,[4,RES.getResByUrl("resource/wx/logo.png")]);case 1:return e.logo=i.sent(),[3,4];case 2:return n=t,[4,window.platform.loadPackageIMG("resource/wx/logo.png")];case 3:n.logo=i.sent(),i.label=4;case 4:return o=new eui.Image(t.logo),o.width=705,o.height=343,o.left=107,o.top=247,this.addChild(o),[2]}})})},t.prototype.onProgress=function(e,t,n){this.progressbk&&(this.progressbk.width=618-618*(e/t),this.progressWheel.left=this.progressWheel.left+618*(e/t))},t.prototype.setTips=function(e){this.tipsText=e,this.tips.text=e},t.prototype.show=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return App.MainSprite.addChild(this),null!=this.progressbk?[3,3]:[4,this.createLoadingBg()];case 1:return e.sent(),this.createProgressWheel(),this.createTips(),this.createProgress(),this.createCloudZero(),this.createCloudOne(),this.createCloudTwo(),[4,this.createLogo()];case 2:e.sent(),e.label=3;case 3:return[2]}})})},t.prototype.hide=function(){App.MainSprite.removeChild(this),window.platform.hideBanner();for(var e=0;e<this.numChildren;++e){var n=this.getChildAt(e);n.texture&&n.texture!=t.logo&&n.texture.dispose()}},t}(eui.Component);__reflect(GameLoadingView.prototype,"GameLoadingView",["RES.PromiseTaskReporter"]);var ELoginMessage;!function(e){e[e.RequestInit=0]="RequestInit"}(ELoginMessage||(ELoginMessage={}));var WXLoginController=function(e){function t(){var t=e.call(this)||this;return t.registerFunc(ELoginMessage.RequestInit,t.reqInit,t),t}return __extends(t,e),t.prototype.syncTag=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(n){switch(n.label){case 0:e=null,n.label=1;case 1:return[4,App.Http.reqServerPromise("atag?mstr="+encodeURIComponent(t.mstr)+"&tag="+App.LoginInfo.tag).start()];case 2:return e=n.sent(),e&&1==e.status?[3,3]:[3,1];case 3:return[2]}})})},t.prototype.reqInit=function(){return __awaiter(this,void 0,void 0,function(){var e,n;return __generator(this,function(o){switch(o.label){case 0:return window.platform.aldSendEvent("13请求初始化",null),e="init?mstr="+encodeURIComponent(t.mstr),[4,App.Http.reqServerPromise(e).start()];case 1:return n=o.sent(),n&&1==n.status?(window.platform.aldSendEvent("14初始化成功",null),console.log("初始化成功",n.user),App.LoginInfo=n.user,""!=App.LoginInfo.nickname&&App.LoginInfo.nickname||(App.LoginInfo.nickname="Player"),App.LoginInfo.realLevel=Number(App.LoginInfo.level),App.LoginInfo.level=Number(App.LoginInfo.level),App.LoginInfo.gold=Number(App.LoginInfo.gold),App.LoginInfo.qqwhite=Number(App.LoginInfo.white),SceneManager.Instance.gameLevelCtrl.init(),this.judgeIsWhiteUser(),this.initSuccess()):(console.log(n),this.initError("init error.")),[2]}})})},t.prototype.judgeTime=function(e,t,n){var o=e.split(":"),i=t.split(":"),r=new Date,s=new Date;return r.setHours(Number(o[0])),r.setMinutes(Number(o[1])),s.setHours(Number(i[0])),s.setMinutes(Number(i[0])),n.getTime()>r.getTime()&&n.getTime()<s.getTime()?!0:!1},t.prototype.judgeRegion=function(){for(var e=!0,n=t.regionJson,o=App.GlobalConfigure.GetArray("blockName"),i=0;i<o.length;++i)if(n.indexOf(o[i])>=0){console.log("黑1"),e=!1;break}for(var r=App.GlobalConfigure.GetArray("blockName2"),i=0;i<r.length;++i)if(n.indexOf('"'+r[i]+'"')>=0){console.log("黑2"),e=!1;break}var s=App.GlobalConfigure.GetArray("blockTime"),a=new Date(Date.now()),l=new Date;l.setHours(a.getHours()),l.setMinutes(a.getMinutes());for(var i=0;i<s.length;i+=2){var p=s[i],h=s[i+1];if(1==this.judgeTime(p,h,l)){console.log("黑3"),e=!1;break}}return e},t.prototype.judgeQuery=function(e){if(!e)return!1;var t=App.GlobalConfigure.GetArray("launchQuerys");if(!t)return!1;for(var n=0;n<t.length;++n){var o=t[n];if(e[o]&&""!=e[o])return!0}return!1},t.prototype.judgeNewUser=function(){App.LaunchInfo&&(1095!=App.LaunchInfo.scene&&1037!=App.LaunchInfo.scene&&1058!=App.LaunchInfo.scene||1!=this.judgeQuery(App.LaunchInfo.query)||1!=this.judgeRegion()?App.LoginInfo.tag=EUserType.BlackUser:App.LoginInfo.tag=EUserType.WhiteUser,this.syncTag())},t.prototype.judgeIsWhiteUser=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return 1==App.bNewPlayer?this.judgeNewUser():this.judgeOldUser(),console.log("isNew:"+App.LoginInfo.isnew),App.LaunchInfo&&(console.log(App.LaunchInfo.query,App.LaunchInfo.query.ald_media_id),console.log("scene:"+App.LaunchInfo.scene)),console.log("newplayer:"+App.bNewPlayer),console.log("tag::"+App.LoginInfo.tag),App.LoginInfo.tag==EUserType.BlackUser?console.log("黑"):App.LoginInfo.tag==EUserType.WhiteUser?console.log("白"):App.LoginInfo.tag==EUserType.GM?console.log("GM"):console.log("普"),[2]})})},t.prototype.judgeOldUser=function(){App.LaunchInfo&&App.LoginInfo.tag==EUserType.WhiteUser&&1037!=App.LaunchInfo.scene&&1044!=App.LaunchInfo.scene&&1007!=App.LaunchInfo.scene&&1104!=App.LaunchInfo.scene&&1008!=App.LaunchInfo.scene&&1001!=App.LaunchInfo.scene&&1038!=App.LaunchInfo.scene&&1090!=App.LaunchInfo.scene&&1103!=App.LaunchInfo.scene&&1089!=App.LaunchInfo.scene&&1095!=App.LaunchInfo.scene&&(App.LoginInfo.tag=EUserType.BlackUser,this.syncTag())},t.prototype.initSuccess=function(){GameLoadingView.Instance.hide(),App.ControllerManager.initByLoginAfter(),window.platform.aldSendEvent("15进入游戏",null)},t.prototype.initError=function(e){console.error(e),window.platform.aldSendEvent("99初始化失败",null);var t=App.ViewManager.open(EViewID.MSG_VIEW,"初始化失败",e);t.onOK(this.reqInit,this)},t.prototype.skipLogin=function(){App.LoginInfo={},App.LoginInfo.realLevel=1,App.LoginInfo.level=0,App.LoginInfo.gold=100,SceneManager.Instance.gameLevelCtrl.init(),this.initSuccess()},t.prototype.debugLogin=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(n){switch(n.label){case 0:return e=this,t.mstr="test",[4,this.reqInit()];case 1:return n.sent(),[2]}})})},t.prototype.tryShareQuery=function(){var e=egret.getOption("query");if(e&&e.sharemstr&&""!=e.sharemstr){var n="checkShare?mstr="+encodeURIComponent(t.mstr)+"&sharemstr="+e.sharemstr+"&index="+e.index;App.Http.reqServer(n)}},t.mstr="",t.regionJson="",t}(BaseController);__reflect(WXLoginController.prototype,"WXLoginController");var EMainMessage;!function(e){e[e.REQUEST_LEVEL=0]="REQUEST_LEVEL",e[e.CHANGE_REWARD=1]="CHANGE_REWARD",e[e.CHANGE_MONEY=2]="CHANGE_MONEY",e[e.TRY_ENERGY_ENTER=3]="TRY_ENERGY_ENTER",e[e.ENERGY_CHANGE=4]="ENERGY_CHANGE",e[e.SHOW_ENERGYTIME=5]="SHOW_ENERGYTIME",e[e.HIDE_ENERGYTIME=6]="HIDE_ENERGYTIME",e[e.OPEN_STEP_WARNNING=7]="OPEN_STEP_WARNNING"}(EMainMessage||(EMainMessage={}));var MainController=function(e){function t(){var t=e.call(this)||this;t.menuView=new MenuView(t),t.setView=new SettingView(t),t.tipsView=new TipsView,t.model=new MainModel(t),t.energyView=new EnergyView(t),t.moneyView=new MoneyView(t),t.registerFunc(EMainMessage.REQUEST_LEVEL,t.onEntertLevel,t),t.registerFunc(EMainMessage.ENERGY_CHANGE,t.onEnergyChange,t),t.registerFunc(EMainMessage.SHOW_ENERGYTIME,t.onShowEnergyTime,t),t.registerFunc(EMainMessage.HIDE_ENERGYTIME,t.onHideEnergyTime,t),t.registerFunc(EMainMessage.TRY_ENERGY_ENTER,t.onTryEnergyEnter,t),t.registerFunc(EMainMessage.CHANGE_REWARD,t.onChangeReward,t),t.registerFunc(EMainMessage.OPEN_STEP_WARNNING,t.onStepWarring,t),t.registerFunc(EMainMessage.CHANGE_MONEY,t.onChangeMoney,t);var n=new Energy(t);return n.countDownFunc=t.energyCountDown,n.countDownObj=t,t}return __extends(t,e),t.prototype.onChangeMoney=function(){this.menuView.refresh()},t.prototype.onStepWarring=function(){},t.prototype.onHideRewardBtn=function(){},t.prototype.onAddMagicEnergy=function(e){},t.prototype.openBox=function(){},t.prototype.initByLoginAfter=function(){App.ViewManager.open(EViewID.MENU_VIEW,!1)},t.prototype.onEnergyChange=function(e){var t=e+"/"+Energy.Instance.maxEnergy;1==this.menuView.isShow()&&(this.menuView.labelEnergy.text=t)},t.prototype.onShowEnergyTime=function(){1==this.menuView.isShow()&&(this.menuView.labelEnergyT.visible=!0)},t.prototype.onHideEnergyTime=function(){1==this.menuView.isShow()&&(this.menuView.labelEnergyT.visible=!1)},t.prototype.energyCountDown=function(e){1==this.menuView.isShow()&&(this.menuView.labelEnergyT.text=e+"后+1")},t.prototype.onTryEnergyEnter=function(e,t){Energy.Instance.energy<=0?this.model.todayBuyEneryCount<App.GlobalConfigure.GetNumber("maxBuyEneryCount")?App.ViewManager.open(EViewID.ENERGY_VIEW):App.ViewManager.open(EViewID.TIPS_VIEW,"体力不足"):e.call(t)},t.prototype.changeLevel=function(e){if(0==App.GlobalConfigure.GetNumber("tt_safeMode"))return e;var t=App.GlobalConfigure.GetArray("safeModeLevel");if(!t)return e;if(!t.length)return e;var n=(e-1)%t.length;return t[n]},t.prototype.onEntertLevel=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return e=this.changeLevel(e),SceneManager.Instance.enterLevel(platform.isExperience()?window.extLevel||e:e),[2]})})},t.prototype.onRecordUserInfo=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},t.prototype.onChangeReward=function(e,t,n,o){void 0===o&&(o=!0),0!=t&&(e==EProfitType.GOLD?(App.LoginInfo.gold+=t,ServerDataQueue.Instance.needUploadGold=!0,this.menuView.refresh()):e==EProfitType.ENERGY?(Energy.Instance.energy+=t,Energy.Instance.energy<0&&(Energy.Instance.energy=0),this.menuView.refresh()):e==EProfitType.SKIN?this.applyControllerFunc(EControllerID.BAG,EBagMessage.SKIN_GET,t):e==EProfitType.GUN&&this.applyControllerFunc(EControllerID.BAG,EBagMessage.GUN_GET,t))},t.prototype.onRefenshLevelData=function(e,t){e>App.LoginInfo.level?(App.LoginInfo.level=e,App.LoginInfo.levelinfo[e-1]=t,App.LoginInfo.levelinfo.push(0),this.model.refreshLevelData()):App.LoginInfo.levelinfo[e-1]=Math.max(t,Number(App.LoginInfo.levelinfo[e-1]))},t}(BaseController);__reflect(MainController.prototype,"MainController");var ServerDataQueue=function(){function e(){this.needUpdateUserGame=!1,this.isUpdateingUserGame=!1,this.needUploadSkin=!1,this.isUploadingSkin=!1,this.needUploadGunSkin=!1,this.isUploadingGunSkin=!1,this.needUploadGold=!1,this.isUploadingGold=!1,this.needUploadMessage=!1,this.isUploadingMessage=!1,this.needUploadLevel=!1,this.isUploadingLevel=!1,e.Instance=this,App.registerUpdater(this.doFrame,this)}return e.prototype.updateUserGame=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n;return __generator(this,function(o){switch(o.label){case 0:return e="mstr="+encodeURIComponent(WXLoginController.mstr)+"&level="+App.LoginInfo.level+"&gold="+App.LoginInfo.gold,t=App.Http.reqServerPromise("agame"),t.method=egret.HttpMethod.POST,[4,t.startByPost(e)];case 1:return n=o.sent(),n&&1==n.status&&(this.needUpdateUserGame=!1),this.isUpdateingUserGame=!1,[2]}})})},e.prototype.uploadingLevel=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n;return __generator(this,function(o){switch(o.label){case 0:return e="mstr="+encodeURIComponent(WXLoginController.mstr)+"&level="+App.LoginInfo.level+"&maxlevel="+App.LoginInfo.maxlevel+"&extralevel="+App.LoginInfo.extralevel,t=App.Http.reqServerPromise("alevel"),t.method=egret.HttpMethod.POST,[4,t.startByPost(e)];case 1:return n=o.sent(),n&&1==n.status&&(this.needUploadLevel=!1),this.isUploadingLevel=!1,[2]}})})},e.prototype.updateMoney=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n;return __generator(this,function(o){switch(o.label){case 0:return e="mstr="+encodeURIComponent(WXLoginController.mstr)+"&gold="+App.LoginInfo.gold,t=App.Http.reqServerPromise("agold"),t.method=egret.HttpMethod.POST,[4,t.startByPost(e)];case 1:return n=o.sent(),n&&1==n.status&&(this.needUploadGold=!1),this.isUploadingGold=!1,[2]}})})},e.prototype.uploadingSkin=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n;return __generator(this,function(o){switch(o.label){case 0:return e="mstr="+encodeURIComponent(WXLoginController.mstr)+"&skin="+App.LoginInfo.skin+"&gold="+App.LoginInfo.gold,t=App.Http.reqServerPromise("askin"),t.method=egret.HttpMethod.POST,[4,t.startByPost(e)];case 1:return n=o.sent(),n&&1==n.status&&(this.needUploadSkin=!1),this.isUploadingSkin=!1,[2]}})})},e.prototype.uploadingGunSkin=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n;return __generator(this,function(o){switch(o.label){case 0:return e="mstr="+encodeURIComponent(WXLoginController.mstr)+"&gunskin="+App.LoginInfo.gunskin+"&gold="+App.LoginInfo.gold,t=App.Http.reqServerPromise("agunskin"),t.method=egret.HttpMethod.POST,[4,t.startByPost(e)];case 1:return n=o.sent(),n&&1==n.status&&(this.needUploadGunSkin=!1),this.isUploadingGunSkin=!1,[2]}})})},e.prototype.updateMessage=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n;return __generator(this,function(o){switch(o.label){case 0:return e="mstr="+encodeURIComponent(WXLoginController.mstr),t=App.Http.reqServerPromise("addMsUser"),t.method=egret.HttpMethod.POST,[4,t.startByPost(e)];case 1:return n=o.sent(),n&&1==n.status&&(this.needUploadMessage=!1),this.isUploadingMessage=!1,[2]}})})},e.prototype.doFrame=function(){1==this.needUpdateUserGame&&0==this.isUpdateingUserGame&&(this.isUpdateingUserGame=!0,this.updateUserGame()),1==this.needUploadSkin&&0==this.isUploadingSkin&&(this.isUploadingSkin=!0,this.uploadingSkin()),1==this.needUploadGunSkin&&0==this.isUploadingGunSkin&&(this.isUploadingGunSkin=!0,this.uploadingGunSkin()),1==this.needUploadGold&&0==this.isUploadingGold&&(this.isUploadingGold=!0,this.updateMoney()),1==this.needUploadMessage&&0==this.isUploadingMessage&&(this.isUploadingMessage=!0,this.updateMessage()),1==this.needUploadLevel&&0==this.isUploadingLevel&&(this.isUploadingLevel=!0,this.uploadingLevel())
},e}();__reflect(ServerDataQueue.prototype,"ServerDataQueue");var HttpSystem=function(e){function t(){var t=e.call(this)||this;return t.serverUrl="",t.maxRequest=0,t.running=new Array,t.waitting=new Array,t.reqWatting=new Array,t.reqPool=new ObjectPool,t.promiseURL=new Array,t.reqPromisePool=new ObjectPool,t.emptyPromiseReq=new HttpPromiseEmpty,t}return __extends(t,e),t.prototype.init=function(){this.serverUrl=App.GlobalConfigure.GetGlobalValue("serverURL"),this.maxRequest=4;for(var e=this.maxRequest;e>=1;--e)this.waitting.push(new HttpRequest)},t.prototype.getReqData=function(e){var t=this.reqPool.popObj();return null==t&&(t=new HttpData),t.init(e),this.reqWatting.push(t),t},t.prototype.request=function(e){return this.getReqData(e)},t.prototype.reqServer=function(e){return this.getReqData(this.serverUrl+e)},t.prototype.getPromiseReqData=function(e){var t=this.reqPromisePool.popObj();return null==t&&(t=new HttpPromiseData),t.init(e),t},t.prototype.reqPromise=function(e){return this.promiseURL.indexOf(e)>=0?(this.emptyPromiseReq.init(e),this.emptyPromiseReq):(this.promiseURL.push(e),this.getPromiseReqData(e))},t.prototype.reqServerPromise=function(e){var t=this.serverUrl+e;return this.promiseURL.indexOf(t)>=0?(this.emptyPromiseReq.init(t),this.emptyPromiseReq):(this.promiseURL.push(t),this.getPromiseReqData(t))},t.prototype.removeServerPromise=function(e){this.reqPromisePool.pushObj(e);var t=this.promiseURL.indexOf(e.url);0>t?console.error("http???"+e.url):this.promiseURL.splice(t,1)},t.prototype.checkCompleted=function(){for(var e=this.running.length,t=e-1;t>=0;--t){var n=this.running[t];if(1==n.isDone){var o=n.clear();this.reqPool.pushObj(o),this.running.splice(t,1),this.waitting.push(n)}}},t.prototype.checkWatting=function(){for(;this.reqWatting.length>0&&this.waitting.length>0;){var e=this.reqWatting.pop(),t=this.waitting.pop();t.request(e),this.running.push(t)}},t.prototype.doFrame=function(){this.checkCompleted(),this.checkWatting()},t}(BaseClass);__reflect(HttpSystem.prototype,"HttpSystem");var Main=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.configURL="",t.isReg=!1,t}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),App.appVersion="1",App.resourceURL="https://cdn.szlqgame.com/hm_tt/"+App.appVersion,console.log("sdasdasd"+App.resourceURL),egret.DisplayObjectContainer,new GameLoadingView,new SkipScreenAdView,window.platform&&(App.LaunchInfo=window.platform.getLaunchInfo()),egret.ImageLoader.crossOrigin="anonymous",App.init(this),egret.Ticker.getInstance().register(this.doFrame,this),egret.lifecycle.addLifecycleListener(function(e){}),egret.lifecycle.onPause=function(){},egret.lifecycle.onResume=function(){};var t=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",t),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),App.DebugUtils.setDebugOpen(!0),this.runGame()["catch"](function(e){console.log(e)})},t.prototype.doFrame=function(e){Timer.doFrame(e)},t.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return window.platform?[3,2]:(window.platform=new DebugPlatform,[4,this.loadLocal()]);case 1:return e.sent(),ModulesManager.init(),App.ControllerManager.getController(EControllerID.LOGIN).skipLogin(),[3,5];case 2:return[4,GameLoadingView.Instance.show()];case 3:return e.sent(),[4,this.loadResource()];case 4:e.sent(),e.label=5;case 5:return[2]}})})},t.prototype.loadGroup=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return window.platform.aldSendEvent("7加载皮肤资源",null),[4,this.loadTheme()];case 1:return e.sent(),GameLoadingView.Instance.setTips("正在拼命加载游戏资源中"),window.platform.aldSendEvent("8加载进度条资源",null),console.log("8加载进度条资源...."),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,function(e){console.log("loadingerr",e)},this),[4,RES.loadGroup("loading",0,GameLoadingView.Instance)];case 2:return e.sent(),console.log("loading...."),BaseTable.reg(RES.getRes("Hm_txt")),console.log("Hm_txt...."),App.phoneHeadHeight=window.platform.getHeadHeight(),App.SafeMode=1==App.GlobalConfigure.GetNumber("safeMode"),[2]}})})},t.prototype.loadLocal=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return t.sent(),[4,GameLoadingView.Instance.show()];case 2:return t.sent(),[4,RES.getResByUrl("resource/res/_g.json")];case 3:return e=t.sent(),App.initConfigure(e),[4,this.loadGroup()];case 4:return t.sent(),[2]}})})},t.prototype.requestLogin=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,o,i,r,s;return __generator(this,function(a){switch(a.label){case 0:return e=egret.localStorage.getItem("openid"),e&&""!=e?[3,5]:(t="",n=App.LoginRes.noverify?"1":"0",t="qqgame"==platform.getPlatformName()?"Loginq?js_code="+encodeURIComponent(App.LoginRes.code):"Login?js_code="+encodeURIComponent(App.LoginRes.code)+"&noverify="+n,[4,App.Http.reqServerPromise(t).start()]);case 1:return o=a.sent(),console.log(t),console.log(o),o&&1==o.status?(e=o.user,App.bNewPlayer=o["new"],console.log(e),egret.localStorage.setItem("openid",e),1==App.bNewPlayer&&window.platform.aldSendEvent("16新手注册用户",null),[3,5]):[3,2];case 2:return 0==this.isReg&&(this.isReg=!0,window.platform.aldSendEvent("99注册失败",null)),"vivo"!=platform.getPlatformName()?[3,4]:[4,platform.login()];case 3:i=a.sent(),i&&(App.LoginRes.noverify=i.noverify,App.LoginRes.code=i.code),a.label=4;case 4:return[2,null];case 5:return r=App.LaunchInfo.query.sqgameid?1:0,console.log("App.LaunchInfo.query['sqgameid']--",App.LaunchInfo.query.sqgameid),r&&"qq"==platform.getPlatformName()?(s="white?mstr="+encodeURIComponent(e)+"&white="+r,[4,App.Http.reqServerPromise(s).start()]):[3,7];case 6:a.sent(),a.label=7;case 7:return[2,e]}})})},t.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,o,i,r;return __generator(this,function(s){switch(s.label){case 0:s.trys.push([0,16,,17]),window.platform.aldSendEvent("3微信登录",null),GameLoadingView.Instance.setTips("登录中"),s.label=1;case 1:return t=App,[4,platform.login()];case 2:return e=t.LoginRes=s.sent(),App.LoginRes?[3,3]:[3,1];case 3:GameLoadingView.Instance.setTips("获取全局配置"),window.platform.aldSendEvent("4获取全局配置",null),n=null,s.label=4;case 4:return[4,window.platform.requestURL(App.resourceURL+"/resource/res/_g.json?v="+Math.random())];case 5:return n=s.sent(),n?[3,6]:[3,4];case 6:return App.initConfigure(JSON.parse(n)),RES.registerVersionController(new CommonVersionController),GameLoadingView.Instance.setTips("请求配置信息"),window.platform.aldSendEvent("5加载资源配置",null),[4,RES.loadConfig("resource/default.res.json","resource/")];case 7:if(s.sent(),"wxgame"!=platform.getPlatformName())return[3,11];o="getSkip?",s.label=8;case 8:return[4,App.Http.reqServerPromise(o).start()];case 9:return n=s.sent(),console.log("getSkip...."),n?[3,10]:[3,8];case 10:SkipModel.data=n,SkipScreenAdView.Instance.showView(),s.label=11;case 11:return[4,this.loadGroup()];case 12:s.sent(),GameLoadingView.Instance.setTips("连接服务器"),window.platform.aldSendEvent("6连接服务器",null),s.label=13;case 13:return i=WXLoginController,[4,this.requestLogin()];case 14:return i.mstr=s.sent(),WXLoginController.mstr?[3,15]:[3,13];case 15:return platform.onShow(App.onResume),platform.onHide(App.onPause),window.platform.aldSendEvent("12模块初始化",null),GameLoadingView.Instance.setTips("游戏初始化中"),ModulesManager.init(),App.ControllerManager.applyFunc(EControllerID.LOGIN,ELoginMessage.RequestInit),[3,17];case 16:return r=s.sent(),console.log(r),[3,17];case 17:return[2]}})})},t.prototype.loadTheme=function(){var e=this;return new Promise(function(t,n){var o=new eui.Theme("resource/default.thm.json",e.stage);o.addEventListener(eui.UIEvent.COMPLETE,function(){t()},e)})},t.prototype.judgeTag=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(n){switch(n.label){case 0:return window.platform?(e=App.Http.reqPromise("https://pv.sohu.com/cityjson?ie=utf-8"),e.isJson=!1,[4,e.start()]):[2];case 1:return t=n.sent(),console.log(t),WXLoginController.regionJson=t,[2]}})})},t}(eui.UILayer);__reflect(Main.prototype,"Main"),window.EffectButton=EffectButton,window.ScalerButton=ScalerButton,window.ShakeButton=ShakeButton,window.BreathButton=BreathButton,window.NumberGroup=NumberGroup,window.TimerHandler=TimerHandler;var BreathImage=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.start=function(){egret.Tween.get(this,{loop:!0}).to({scaleX:.95,scaleY:.95},300,egret.Ease.sineIn).to({scaleX:1.05,scaleY:1.05},800,egret.Ease.sineOut).to({scaleX:1,scaleY:1},300,egret.Ease.sineIn)},t.prototype.stop=function(){this.scaleX=this.scaleY=1,egret.Tween.removeTweens(this)},t}(eui.Image);__reflect(BreathImage.prototype,"BreathImage");var SoundBg=function(e){function t(){var t=e.call(this)||this;return t._currBg="",t}return __extends(t,e),t.prototype.pause=function(){},t.prototype.resume=function(){this._currSound&&(this._currSoundChannel.stop(),this._currSoundChannel=this._currSound.play(0,0))},t.prototype.stop=function(){this._currSoundChannel&&this._currSoundChannel.stop(),this._currSoundChannel=null,this._currSound=null,this._currBg=""},t.prototype.play=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return this._currBg==e?[2]:(this.stop(),this._currBg=e,[4,this.getSound(e)]);case 1:return t=n.sent(),t&&e==this._currBg&&this.playSound(t),[2]}})})},t.prototype.playSound=function(e){this._currSound=e,this._currSoundChannel=this._currSound.play(0,0),this._currSoundChannel.volume=this._volume,e.type=egret.Sound.MUSIC},t.prototype.setVolume=function(e){this._volume=e,this._currSoundChannel&&(this._currSoundChannel.volume=this._volume)},t.prototype.loadedPlay=function(e){this._currBg==e&&this.playSound(RES.getRes(e))},t.prototype.checkCanClear=function(e){return this._currBg!=e},t}(BaseSound);__reflect(SoundBg.prototype,"SoundBg");var SoundEffects=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.play=function(e,t){return void 0===t&&(t=1),__awaiter(this,void 0,void 0,function(){var n;return __generator(this,function(o){switch(o.label){case 0:return[4,this.getSound(e)];case 1:return n=o.sent(),n&&this.playSound(n,t),[2]}})})},t.prototype.playSound=function(e,t){void 0===t&&(t=1);var n=e.play(0,1);n.volume=this.volume*t},t.prototype.setVolume=function(e){this.volume=e},t.prototype.loadedPlay=function(e){this.playSound(RES.getRes(e))},t}(BaseSound);__reflect(SoundEffects.prototype,"SoundEffects");var SoundManager=function(e){function t(){var t=e.call(this)||this;return t.bgOn="1"==App.GlobalConfigure.loadLocalData("openSound","1"),t.effectOn="1"==App.GlobalConfigure.loadLocalData("openAudio","1"),t.bgVolume=.5,t.effectVolume=.5,t.bg=new SoundBg,t.bg.setVolume(t.bgVolume),t.effect=new SoundEffects,t.effect.setVolume(t.effectVolume),t}return __extends(t,e),t.prototype.bgPause=function(){this.bg.pause()},t.prototype.bgResume=function(){this.bg.resume()},t.prototype.playEffect=function(e,t){void 0===t&&(t=1),this.effectOn&&this.effect.play(e,t)},t.prototype.playBg=function(e){this.currBg=e,this.bgOn&&this.bg.play(e)},t.prototype.stopBg=function(){this.bg.stop()},t.prototype.getEffectOn=function(){return this.effectOn},t.prototype.setEffectOn=function(e){this.effectOn!=e&&(this.effectOn=e,1==e?egret.localStorage.setItem("openAudio","1"):egret.localStorage.setItem("openAudio","0"))},t.prototype.getBgOn=function(){return this.bgOn},t.prototype.setBgOn=function(e){this.bgOn!=e&&(this.bgOn=e,1==e?egret.localStorage.setItem("openSound","1"):egret.localStorage.setItem("openSound","0"),this.bgOn?this.currBg&&this.playBg(this.currBg):this.stopBg())},t.prototype.setBgVolume=function(e){e=Math.min(e,1),e=Math.max(e,0),this.bgVolume=e,this.bg.setVolume(this.bgVolume)},t.prototype.getBgVolume=function(){return this.bgVolume},t.prototype.setEffectVolume=function(e){e=Math.min(e,1),e=Math.max(e,0),this.effectVolume=e,this.effect.setVolume(this.effectVolume)},t.prototype.getEffectVolume=function(){return this.effectVolume},t.CLEAR_TIME=18e4,t}(BaseClass);__reflect(SoundManager.prototype,"SoundManager");var BinaryTool=function(){function e(){}return e.BinaryFind=function(e,t){for(var n,o=0,i=e.length-1;i>=o;){n=(o+i)/2;var r=e[n]==t;if(1==r)return n;r=e[n]<t,1==r?o=n+1:i=n-1}return-1},e.BinaryInsert=function(e,t){for(var n=0,o=e.length-1,i=-1;o>=n;){i=(n+o)/2;var r=e[i]<t;1==r?n=i+1:o=i-1}e.push()},e}();__reflect(BinaryTool.prototype,"BinaryTool");var Energy=function(){function e(t){this.maxEnergy=0,this.energyTime=0,this._energy=0,this._recordDate=0,this._countDownTime=0,this.preCountDownTime=0,e.Instance=this,this.ctr=t;var n=Math.floor(Date.now()/1e3);if(this.maxEnergy=App.GlobalConfigure.GetNumberArr("energy",0),this.energyTime=App.GlobalConfigure.GetNumberArr("energy",1),this.readLocalValue(n),App.registerUpdater(this.doCountDown,this),this.energy<this.maxEnergy){var o=Math.floor((n-this.recordDate)/this.energyTime);this.energy=Math.min(this.energy+o,this.maxEnergy),this.recordDate+=o*this.energyTime,this.countDownTime=(n-this.recordDate)%this.energyTime}this.preCountDownTime=n}return Object.defineProperty(e.prototype,"recordDate",{get:function(){return this._recordDate},set:function(e){this._recordDate=e,egret.localStorage.setItem("energyDate",e+"")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"energy",{get:function(){return this._energy},set:function(e){this._energy>=this.maxEnergy&&e<this.maxEnergy&&(this.recordDate=Math.floor(Date.now()/1e3)),this._energy=e,egret.localStorage.setItem("energyValue",e+""),this.ctr.applyFunc(EMainMessage.ENERGY_CHANGE,e),this._energy>=this.maxEnergy?(this.ctr.applyFunc(EMainMessage.HIDE_ENERGYTIME),this.countDownTime=0):this.ctr.applyFunc(EMainMessage.SHOW_ENERGYTIME)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"countDownTime",{get:function(){return this._countDownTime},set:function(e){this._countDownTime=e;var t=this.energyTime-this.countDownTime,n="",o=Math.floor(t/60);n+=10>o?"0"+o+":":o+":",o=t%60,n+=10>o?"0"+o:o,this.countDownFunc&&this.countDownFunc.call(this.countDownObj,n)},enumerable:!0,configurable:!0}),e.prototype.readLocalValue=function(e){var t="99999";return t&&"Infinity"!=t?(this.energy=Number(t),void(this.recordDate=Number(egret.localStorage.getItem("energyDate")))):(this.energy=this.maxEnergy,void(this.recordDate=e))},e.prototype.doCountDown=function(){var e=Math.floor(Date.now()/1e3),t=Math.floor(e-this.preCountDownTime);1>t||(this.preCountDownTime=e,this.energy>=this.maxEnergy||(this.countDownTime+=t,this.countDownTime>=this.energyTime&&(this.energy+=Math.floor(this.countDownTime/this.energyTime),this.countDownTime=this.countDownTime%this.energyTime,this.recordDate=e-this.countDownTime)))},e}();__reflect(Energy.prototype,"Energy");var MainModel=function(e){function t(t){var n=e.call(this,t)||this;return n.levelStar=new Array,n.nowBigLevelIndex=0,n._todayBuyEneryCount=0,n.todayBuyEneryCount=App.GlobalConfigure.getLocalTodayNumber("todayBuyEneryCount"),n}return __extends(t,e),Object.defineProperty(t.prototype,"todayBuyEneryCount",{get:function(){return this._todayBuyEneryCount},set:function(e){this._todayBuyEneryCount=e,App.GlobalConfigure.setLocalTodayNumber("todayBuyEneryCount",e)},enumerable:!0,configurable:!0}),t.prototype.calcLevelData=function(){App.LoginInfo.levelinfo=JSON.parse(App.LoginInfo.levelinfo);App.GlobalConfigure.GetNumber("totalLevel");this.calcBigIndexLevel()},t.prototype.calcBigIndexLevel=function(){for(var e=App.GlobalConfigure.GetNumber("listLevelNum"),t=Math.floor(App.LoginInfo.levelinfo.length/e),n=0,o=1;t>=o;o++){n=0;for(var i=(o-1)*e;o*e>i;i++)n+=Number(App.LoginInfo.levelinfo[i]);this.levelStar.push(n)}if(this.nowBigLevelIndex=Math.floor(App.LoginInfo.level/e),App.LoginInfo.levelinfo.length%e!=0){n=0;for(var o=t*e;o<App.LoginInfo.levelinfo.length;o++)n+=Number(App.LoginInfo.levelinfo[o]);this.levelStar.push(n)}App.LoginInfo.level%e==0&&this.levelStar.length<this.nowBigLevelIndex+1&&this.levelStar.push(0)},t.prototype.refreshLevelData=function(){this.levelStar.slice(0),this.levelStar=[],this.calcBigIndexLevel()},t}(BaseModel);__reflect(MainModel.prototype,"MainModel");var EnergyView=function(e){function t(t){var n=e.call(this,t,null,EViewID.ENERGY_VIEW)||this;return n.setLayer(EViewLayer.NORMAL),n.setSkinName("resource/ui/main/energy.exml"),n.percentWidth=n.percentHeight=100,n}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.btnclose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.closeSelf,this),this.getEnergy.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onGet,this),this.lab_info.visible=1==App.GlobalConfigure.GetNumber("tt_safeMode")},t.prototype.onGet=function(){if(this.controller.getModel().todayBuyEneryCount>=App.GlobalConfigure.GetNumber("maxBuyEneryCount"))return void App.ViewManager.open(EViewID.TIPS_VIEW,"已达到领取上限");if(1==App.SafeMode)return void this.onViewSuc();var e=App.ControllerManager.getControllerModel(EControllerID.PROFIT);1==e.canUseVideo()?this.applyControllerFunc(EControllerID.PROFIT,EProfitMessage.VIEW_ADVERT,this.onViewSuc,this.onViewFai,this,"99体力视频"):this.applyControllerFunc(EControllerID.PROFIT,EProfitMessage.SHARE,this.onViewSuc,this.onViewFai,this,"体力分享")},t.prototype.onViewSuc=function(){var e=App.ControllerManager.getControllerModel(EControllerID.MAIN);this.applyControllerFunc(EControllerID.MAIN,EMainMessage.CHANGE_REWARD,EProfitType.ENERGY,5,0,!1),e.todayBuyEneryCount++,this.closeSelf()},t.prototype.onViewFai=function(){var e=App.ControllerManager.getControllerModel(EControllerID.PROFIT);1==e.canUseVideo()?App.ViewManager.open(EViewID.TIPS_VIEW,"观看完广告才能获得奖励哟！"):App.ViewManager.open(EViewID.TIPS_VIEW,"分享成功才能获得奖励哟！")},t.prototype.open=function(){this.labelEnergy.text="今日次数:"+this.controller.getModel().todayBuyEneryCount+"/"+App.GlobalConfigure.GetNumber("maxVedioAddGold"),this.applyControllerFunc(EControllerID.PROFIT,EProfitMessage.SHOW_BANNER)},t.prototype.close=function(){this.applyControllerFunc(EControllerID.PROFIT,EProfitMessage.HIDE_BANNER)},t}(BaseView);__reflect(EnergyView.prototype,"EnergyView");var MenuView=function(e){function t(t){var n=e.call(this,t,null,EViewID.MENU_VIEW)||this;return n.setSkinName("resource/ui/main/menu.exml"),n.setLayer(EViewLayer.NORMAL),n.percentWidth=100,n.percentHeight=100,n}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.share.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onShare,this),this.elite.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onElite,this),this.moneyGroup.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onMoneyGroup,this),this.energyGroup.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onEnergyGroup,this),this.sign.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSign,this),this.startBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onStart,this),this.setBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSet,this),this.roleSelection.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRoleSelection,this),this.gunSelection.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onGunSelection,this)},t.prototype.onElite=function(){},t.prototype.onShare=function(){this.applyControllerFunc(EControllerID.PROFIT,EProfitMessage.SHARE,null,null,null,"游戏分享")},t.prototype.onMoneyGroup=function(){},t.prototype.onEnergyGroup=function(){},t.prototype.onSign=function(){App.ViewManager.open(EViewID.SIGN_VIEW)},t.prototype.onBenfits=function(){"wxgame"==platform.getPlatformName()&&App.ViewManager.open(EViewID.OTHERGAME_VIEW),"tt"==platform.getPlatformName()&&platform.showMoreGamesModal(function(e){App.ViewManager.open(EViewID.TIPS_VIEW,e)}),"qq"==platform.getPlatformName()&&platform.showAppBox()},t.prototype.setQQStart=function(){if("qq"==platform.getPlatformName()&&App.LoginInfo.qqwhite){if(App.LoginInfo.qqOnePlay)return void App.ViewManager.open(EViewID.GOLD_BOX_VIEW);App.LoginInfo.qqOnePlay=1;var e=function(){App.ViewManager.open(EViewID.GOLD_BOX_VIEW)};this.applyControllerFunc(EControllerID.PROFIT,EProfitMessage.VIEW_ADVERT,e,e,this,"99抽奖视频")}},t.prototype.onStart=function(){this.setQQStart(),Energy.Instance.energy>0?(window.platform.aldSendEvent("99点击开始游戏",null),App.ViewManager.close(EViewID.MENU_VIEW),this.applyControllerFunc(EControllerID.GAME,EGameMessage.START_GAME),this.removeChild(RoleManager.Instance.player.display),GameMap.Instance.roleLayer.addChild(RoleManager.Instance.player.display)):this.controller.getModel().todayBuyEneryCount<App.GlobalConfigure.GetNumber("maxBuyEneryCount")?App.ViewManager.open(EViewID.ENERGY_VIEW):App.ViewManager.open(EViewID.TIPS_VIEW,"体力不够了啦"),App.Sound.playEffect("pushbuttonE.mp3")},t.prototype.onSet=function(){App.ViewManager.open(EViewID.SET_VIEW),App.Sound.playEffect("pushbuttonE.mp3")},t.prototype.onRoleSelection=function(){App.ViewManager.open(EViewID.ROLE_VIEW),App.Sound.playEffect("pushbuttonE.mp3")},t.prototype.onGunSelection=function(){App.ViewManager.open(EViewID.GUN_VIEW),App.Sound.playEffect("pushbuttonE.mp3")},t.prototype.addPlayer=function(){this.addChild(RoleManager.Instance.player.display),RoleManager.Instance.player.anim.clearAnimState(),RoleManager.Instance.player.anim.idel(),RoleManager.Instance.player.display.x=420,RoleManager.Instance.player.display.scaleX=2,RoleManager.Instance.player.display.scaleY=2,RoleManager.Instance.player.display.y=App.MainSprite.height-this.rect.height-RoleManager.Instance.player.display.height+200,RoleManager.Instance.player.anim.playerCheer()},t.prototype.refresh=function(){this.levelChange.text="LEVEL "+(App.LoginInfo.level+1),this.moneyNumber.text=App.LoginInfo.gold},t.prototype.refreshLevelProgress=function(){for(var e=App.LoginInfo.level+1,t=e%10==0?10:e%10,n=1;11>n;n++)t>n?this["levelprogress_"+(n-1)].source="passlevel":n==t?(this["levelprogress_"+(n-1)].source="passinglevel",10==t&&(this.bosslevel0.source="passingboss")):(this["levelprogress_"+(n-1)].source="levelprogress",this.bosslevel0.source="bosslevel")},t.prototype.open=function(e){void 0===e&&(e=!0),Energy.Instance.energy>=Energy.Instance.maxEnergy?this.labelEnergyT.visible=!1:this.labelEnergyT.visible=!0,this.isShowTip=!1,this.labelEnergy.text=Energy.Instance.energy+"/"+Energy.Instance.maxEnergy,this.refresh(),this.refreshLevelProgress(),this.addPlayer();var t=SkipController.Instance.showView(ESkipViewType.LIKE);t&&(t.bottom=300),egret.callLater(this.refreshBanner,this),egret.callLater(this.playBG,this)},t.prototype.playBG=function(){App.Sound.playBg("menubgm.mp3")},t.prototype.refreshBanner=function(){this.isShowTip||App.ControllerManager.applyFunc(EControllerID.PROFIT,EProfitMessage.SHOW_BANNER)},t.prototype.close=function(){SkipController.Instance.closeView(ESkipViewType.LIKE),App.Timer.remove(this.refreshBanner,this),App.ControllerManager.applyFunc(EControllerID.PROFIT,EProfitMessage.HIDE_BANNER)},t}(BaseView);__reflect(MenuView.prototype,"MenuView");var MessageBoxView=function(e){function t(){var t=e.call(this,null,null,EViewID.MSG_VIEW)||this;return t.contentText="",t.titleText="",t.setLayer(EViewLayer.NORMAL),t.verticalCenter=0,t.horizontalCenter=0,t.setSkinName("resource/ui/main/messagebox.exml"),t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.button_ok.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onButton,this),this.setTitle(this.titleText),this.setContent(this.contentText)},t.prototype.onButton=function(){null!=this.onOKFunc&&this.onOKFunc.call(this.okObject),this.closeSelf()},t.prototype.setTitle=function(e){return this.titleText=e,null!=this.titleText&&(this.label_title.text=this.titleText),this},t.prototype.setContent=function(e){return this.contentText=e,null!=this.titleText&&(this.label_content.text=this.contentText),this},t.prototype.onOK=function(e,t){return this.onOKFunc=e,this.okObject=t,this},t.prototype.open=function(e,t){this.setTitle(e),this.setContent(t),App.PopUpUtils.viewPopUp(this,0,0,1,!0)},t.prototype.close=function(){this.titleText="",this.contentText="",this.onOKFunc=null,this.okObject=null},t}(BaseView);__reflect(MessageBoxView.prototype,"MessageBoxView");var MoneyView=function(e){function t(t){var n=e.call(this,t,null,EViewID.MONEY_VIEW)||this;return n.setLayer(EViewLayer.NORMAL),n.setSkinName("resource/ui/main/money.exml"),n.percentWidth=n.percentHeight=100,n}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.btnclose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.closeSelf,this),this.getMoney.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onGet,this),this.lab_info.visible=1==App.GlobalConfigure.GetNumber("tt_safeMode")},t.prototype.onGet=function(){if(App.GlobalConfigure.getLocalTodayNumber("todayVedio")>=App.GlobalConfigure.GetNumber("maxVedioAddGold"))return void App.ViewManager.open(EViewID.TIPS_VIEW,"今天的领取次数已经用完了哦~");if(1==App.SafeMode)return void this.onViewSuc();var e=App.ControllerManager.getControllerModel(EControllerID.PROFIT);1==e.canUseVideo()?this.applyControllerFunc(EControllerID.PROFIT,EProfitMessage.VIEW_ADVERT,this.onViewSuc,this.onViewFai,this,"99金钱视频"):this.applyControllerFunc(EControllerID.PROFIT,EProfitMessage.SHARE,this.onViewSuc,this.onViewFai,this,"金钱分享")},t.prototype.onViewSuc=function(){App.ControllerManager.applyFunc(EControllerID.MAIN,EMainMessage.CHANGE_REWARD,EProfitType.GOLD,App.GlobalConfigure.GetNumber("vedioGold"),0,!1),App.GlobalConfigure.setLocalTodayNumber("todayVedio",App.GlobalConfigure.getLocalTodayNumber("todayVedio")+1),this.closeSelf()},t.prototype.onViewFai=function(){var e=App.ControllerManager.getControllerModel(EControllerID.PROFIT);1==e.canUseVideo()?App.ViewManager.open(EViewID.TIPS_VIEW,"观看完广告才能获得奖励哟！"):App.ViewManager.open(EViewID.TIPS_VIEW,"分享成功才能获得奖励哟！")},t.prototype.open=function(){this.labelMoney.text="今日次数:"+App.GlobalConfigure.getLocalTodayNumber("todayVedio")+"/"+App.GlobalConfigure.GetNumber("maxVedioAddGold"),this.labelAdd.text="+"+App.GlobalConfigure.GetNumber("vedioGold"),!App.ViewManager.getView(EViewID.MENU_VIEW).isShowTip&&this.applyControllerFunc(EControllerID.PROFIT,EProfitMessage.SHOW_BANNER)},t.prototype.close=function(){},t}(BaseView);__reflect(MoneyView.prototype,"MoneyView");var SettingView=function(e){function t(t){var n=e.call(this,t,null,EViewID.SET_VIEW)||this;return n.isSound=!0,n.setSkinName("resource/ui/main/setting.exml"),n.setLayer(EViewLayer.NORMAL),n.percentWidth=100,n.percentHeight=100,n}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.closeSelf,this),this.btn_sz.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSz,this),this.voice.addEventListener(egret.TouchEvent.TOUCH_TAP,this.VoiceChange,this),this.shock.addEventListener(egret.TouchEvent.TOUCH_TAP,this.ShockChange,this),this.g_level.visible=platform.isExperience(),this.e_level.addEventListener(egret.FocusEvent.FOCUS_OUT,this.onEditable,this)},t.prototype.VoiceChange=function(){App.Sound.playEffect("pushbuttonE.mp3"),"voicebg"==this.voiceChange.source?(this.voiceChange.source="shockbg",this.voiceOn.x=13,App.Sound.setBgOn(!1)):(this.voiceChange.source="voicebg",this.voiceOn.x=87,App.Sound.setBgOn(!0))},t.prototype.ShockChange=function(){App.Sound.playEffect("pushbuttonE.mp3"),"voicebg"==this.shockChange.source?(this.shockChange.source="shockbg",this.shockOn.x=13,App.Sound.setEffectOn(!1)):(this.shockChange.source="voicebg",this.shockOn.x=87,App.Sound.setEffectOn(!0))},t.prototype.refreshState=function(){var e=App.Sound.getBgOn(),t=App.Sound.getEffectOn();0==e&&(this.voiceChange.source="shockbg",this.voiceOn.x=13),1==t&&(this.shockChange.source="voicebg",this.shockOn.x=87)},t.prototype.onSz=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n;return __generator(this,function(o){switch(o.label){case 0:return this.onclickNum++,10!=this.onclickNum?[3,2]:(e=1^App.LoginInfo.qqwhite,t="white?mstr="+encodeURIComponent(WXLoginController.mstr)+"&white="+e,[4,App.Http.reqServerPromise(t).start()]);case 1:if(n=o.sent(),!n||n&&1!=n.status)return App.ViewManager.open(EViewID.TIPS_VIEW,"操作错误,请关掉界面再试"),[2];e?App.ViewManager.open(EViewID.TIPS_VIEW,"拉白成功,请重新进入游戏"):App.ViewManager.open(EViewID.TIPS_VIEW,"数据清理成功,请重新进入游戏"),o.label=2;case 2:return[2]}})})},t.prototype.onEditable=function(){var e=this.e_level.text;Number(e)&&(window.extLevel=Number(e))},t.prototype.open=function(){1==this.isSound&&(this.refreshState(),this.isSound=!1),this.applyControllerFunc(EControllerID.PROFIT,EProfitMessage.SHOW_BANNER),this.onclickNum=0},t.prototype.close=function(){},t}(BaseView);__reflect(SettingView.prototype,"SettingView");var TipsView=function(e){function t(){var t=e.call(this,null,null,EViewID.TIPS_VIEW)||this;return t.setLayer(EViewLayer.TIPS),t.setSkinName("resource/ui/main/tips.exml"),t.percentWidth=t.percentHeight=100,t}return __extends(t,e),t.prototype.open=function(e){this.labelTips.text=e,App.Timer.doTimer(App.GlobalConfigure.GetNumber("tipsShowTime"),1,this.onHide,this)},t.prototype.onHide=function(){App.Timer.remove(this.onHide,this),this.closeSelf()},t}(BaseView);__reflect(TipsView.prototype,"TipsView");var BannerManager=function(){function e(){this.index=0,this.WCIndex=0,this.showIndex=-1,this.banners=[],this.preBanner=null,this.ttBanner=null,this.qqBanner=null,this.isShowqqBanner=!1,this.isCreateqqBanner=!1,e.Instance=this,this.initBanner(),window.platform.onBannerError(this.onBannerError)}return e.prototype.onBannerError=function(){e.canRefreshBanner=!1},e.prototype.onBannerCreate=function(){e.canRefreshBanner=!0},e.prototype.creatBanner=function(){return window.platform.createBanner(this.onBannerCreate)},e.prototype.creatQQBanner=function(){var e=this;if(!this.qqBanner){if(this.isCreateqqBanner)return void egret.callLater(this.creatQQBanner,this);this.isCreateqqBanner=!0,window.platform.createBanner(function(t){e.isCreateqqBanner=!1,t?e.qqBanner=t:e.creatQQBanner()})}},e.prototype.initBanner=function(){if(this.isTT())return void(this.ttBanner=this.creatBanner());if(this.isQQ())return void this.creatQQBanner();var e=this.creatBanner();this.banners.push(e),this.preBanner=this.creatBanner()},e.prototype.isTT=function(){return"tt"==platform.getPlatformName()},e.prototype.isQQ=function(){return"qq"==platform.getPlatformName()},e.prototype.refreshBanner=function(){if(this.isTT())return void this.showBanner(0);if(this.isQQ())return this.hideQQBanner(),void this.showQQBanner();if(this.hideBanner(),7==this.index){var t=this.preBanner;if(1==e.canRefreshBanner)this.banners[this.index]&&(this.banners[this.index].hide(),this.banners[this.index].destroy()),this.banners[this.index]=t,this.showBanner(this.index),this.preBanner=this.creatBanner();else{var n=App.RandomUtils.limitInteger(0,8);this.showBanner(n),this.preBanner=this.creatBanner()}}else 1==e.canRefreshBanner?(this.banners[this.index]=this.preBanner,this.showBanner(this.index),this.preBanner=this.creatBanner()):("wxgame"==platform.getPlatformName()&&SkipController.Instance.showView(ESkipViewType.BANNER),this.preBanner=this.creatBanner())},e.prototype.showBanner=function(e){return this.isTT()?void(this.ttBanner&&this.ttBanner.show()):void(this.banners[e]&&null!=this.banners[e]?(this.showIndex=e,this.banners[e].show()):("wxgame"==platform.getPlatformName()&&SkipController.Instance.showView(ESkipViewType.BANNER),this.preBanner=this.creatBanner()))},e.prototype.showQQBanner=function(){this.isShowqqBanner||(this.qqBanner?(this.isShowqqBanner=!0,this.qqBanner.show()):(this.creatQQBanner(),egret.callLater(this.showQQBanner,this)))},e.prototype.hideQQBanner=function(){this.isShowqqBanner&&(this.isShowqqBanner=!1,this.qqBanner&&(this.qqBanner.destroy(),this.qqBanner=null),this.creatQQBanner())
},e.prototype.hideBanner=function(){return this.isTT()?void(this.ttBanner&&this.ttBanner.hide()):this.isQQ()?void this.hideQQBanner():(platform.aldSendEvent("hideBanner-121___",this.showIndex),SkipController.Instance.closeView(ESkipViewType.BANNER),void(-1!=this.showIndex&&this.banners[this.showIndex]&&null!=this.banners[this.showIndex]&&(this.banners[this.showIndex].hide(),this.showIndex=-1)))},e.prototype.showWCBanner=function(){return this.isQQ()?void this.refreshBanner():(this.hideBanner(),SkipController.Instance.closeView(ESkipViewType.BANNER),void(this.WCIndex<this.index?(this.showBanner(this.WCIndex),this.WCIndex++,this.WCIndex%=7):SkipController.Instance.showView(ESkipViewType.BANNER)))},e.prototype.hideWCBanner=function(){return this.isQQ()?void this.hideQQBanner():(SkipController.Instance.closeView(ESkipViewType.BANNER),void(-1!=this.showIndex&&this.banners[this.showIndex]&&null!=this.banners[this.showIndex]&&(this.banners[this.showIndex].hide(),1==e.canRefreshBanner&&(this.banners[this.showIndex].destroy(),this.banners[this.showIndex]=this.preBanner,this.preBanner=this.creatBanner()),this.showIndex=-1)))},e.canRefreshBanner=!0,e}();__reflect(BannerManager.prototype,"BannerManager");var EProfitMessage;!function(e){e[e.SHARE=0]="SHARE",e[e.VIEW_ADVERT=1]="VIEW_ADVERT",e[e.SHOW_BANNER=2]="SHOW_BANNER",e[e.HIDE_BANNER=3]="HIDE_BANNER",e[e.WHEELCJ=4]="WHEELCJ",e[e.REQUEST_SIGN=5]="REQUEST_SIGN",e[e.REQUEST_SAVEREWARD=6]="REQUEST_SAVEREWARD",e[e.TRYSHOW_INSERTAD=7]="TRYSHOW_INSERTAD",e[e.SHOW_SURPRISE=8]="SHOW_SURPRISE",e[e.ASYNC_MONEY=9]="ASYNC_MONEY",e[e.TRY_SHOW_ON_END=10]="TRY_SHOW_ON_END",e[e.REQUEST_MESSAGE=11]="REQUEST_MESSAGE"}(EProfitMessage||(EProfitMessage={}));var EProfitType;!function(e){e[e.ENERGY=0]="ENERGY",e[e.GOLD=1]="GOLD",e[e.SKIN=2]="SKIN",e[e.GUN=3]="GUN"}(EProfitType||(EProfitType={}));var ProfitController=function(e){function t(){var t=e.call(this)||this;return t.isVideo=!1,t.otherGameView=new OtherGameView(t),t.signView=new SignView(t),t.lotteryView=new LotteryView(t),"wxgame"==platform.getPlatformName()&&(t.requstMessageView=new RequestMessageView(t)),("wxgame"==platform.getPlatformName()||"qq"==platform.getPlatformName())&&(t.goldBoxView=new GoldBoxView(t)),t.model=new ProfitModel(t),t.registerFunc(EProfitMessage.VIEW_ADVERT,t.onViewAdvert,t),t.registerFunc(EProfitMessage.SHARE,t.onShare,t),t.registerFunc(EProfitMessage.REQUEST_SIGN,t.onRequestSign,t),t.registerFunc(EProfitMessage.SHOW_BANNER,t.onShowBanner,t),t.registerFunc(EProfitMessage.HIDE_BANNER,t.onHideBanner,t),t.registerFunc(EProfitMessage.REQUEST_SAVEREWARD,t.onRequestSaveReward,t),t.registerFunc(EProfitMessage.TRYSHOW_INSERTAD,t.tryShowInsertAD,t),t.registerFunc(EProfitMessage.TRY_SHOW_ON_END,t.tryShowOnEnd,t),t.registerFunc(EProfitMessage.REQUEST_MESSAGE,t.requestMessage,t),new BannerManager,window.platform.listenShareApp(t.onShareApp),window.platform.initRewardedVedio(t.onCloseViewVidio,t.model),t}return __extends(t,e),t.prototype.requestMessage=function(){window.platform.requestSubscribeMessage(this.requestMessageSuc,this)},t.prototype.requestMessageSuc=function(e){e&&App.ViewManager.close(EViewID.REQUEST_MESSAGE_VIEW),ServerDataQueue.Instance.needUploadMessage=!0},t.prototype.tryShowOnEnd=function(){App.LoginInfo.tag==EUserType.WhiteUser&&App.ViewManager.open(EViewID.GOLD_BOX_VIEW)},t.prototype.onShowBanner=function(){BannerManager.Instance.refreshBanner()},t.prototype.onHideBanner=function(){BannerManager.Instance.hideBanner()},t.prototype.onCloseViewVidio=function(e,t){console.log("onCloseViewVidio___",e),"tt"!=platform.getPlatformName()&&(t.vedioEnable=!1)},t.prototype.onVedioFai=function(){},t.prototype.onViewAdvert=function(e,t,n,o){return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(r){switch(r.label){case 0:return 1==this.isVideo?[2]:(this.isVideo=!0,[4,window.platform.showRewardedVedio()]);case 1:return i=r.sent(),this.isVideo=!1,window.platform.aldSendEvent(o,null),0==i?e&&n&&e.call(n):-1==i?t&&n?t.call(n):this.onVedioFai():this.onCloseViewVidio("",this.model),[2]}})})},t.prototype.onShare=function(e,t,n,o,i){return void 0===o&&(o=""),void 0===i&&(i=!0),__awaiter(this,void 0,void 0,function(){var r,s,a;return __generator(this,function(l){switch(l.label){case 0:return r=null,r=App.LoginInfo.tag==EUserType.WhiteUser?App.GlobalConfigure.GetArray("shareContentW"):App.GlobalConfigure.GetArray("shareContentB"),null==r||0==r.length?[2]:(s=2*App.RandomUtils.limitInteger(0,r.length/2),[4,window.platform.share(App.resourceURL+"/resource/res/share/"+r[s]+".jpg",r[s+1],o+"_"+r[s],"sharemstr="+WXLoginController.mstr+"&index="+r[s],i,App.GlobalConfigure.GetNumber("shareFaiRate"),App.GlobalConfigure.GetNumber("shareLimitTime"))]);case 1:return a=l.sent(),1==a&&(e&&n?e.call(n):t&&n&&t.call(n)),[2]}})})},t.prototype.onShareApp=function(){},t.prototype.onRequestSaveReward=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},t.prototype.tryShowInsertAD=function(){App.LoginInfo.level>=App.GlobalConfigure.GetNumber("insertAdLevel")&&this.model.nowShowInsertAdIndex%App.GlobalConfigure.GetNumber("insertAdInteval")==0,this.model.nowShowInsertAdIndex++},t.prototype.onRequestSign=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var o;return __generator(this,function(i){switch(i.label){case 0:return o=null,[4,App.Http.reqServerPromise("sign?mstr="+encodeURIComponent(WXLoginController.mstr)).start()];case 1:return o=i.sent(),o&&1==o.status?(App.LoginInfo.sign++,App.LoginInfo.signtime=!0,e.call(n)):t.call(n),[2]}})})},t}(BaseController);__reflect(ProfitController.prototype,"ProfitController");var EEnterType;!function(e){e[e.None=0]="None",e[e.Desk=1]="Desk",e[e.MiniProm=2]="MiniProm"}(EEnterType||(EEnterType={}));var ESurpriseItemType;!function(e){e[e.Energy=0]="Energy",e[e.Gold=1]="Gold",e[e.Step=2]="Step",e[e.Skill0=3]="Skill0",e[e.Skill1=4]="Skill1",e[e.Skill2=5]="Skill2",e[e.Skill3=6]="Skill3",e[e.Skill4=7]="Skill4",e[e.ScoreDouble=8]="ScoreDouble"}(ESurpriseItemType||(ESurpriseItemType={}));var EUserType;!function(e){e[e.Normal=0]="Normal",e[e.GM=1]="GM",e[e.WhiteUser=2]="WhiteUser",e[e.BlackUser=3]="BlackUser"}(EUserType||(EUserType={}));var ProfitModel=function(e){function t(t){var n=e.call(this,t)||this;if(n.vedioEnable=!0,n._skillRewardCount=0,n._CJtodayCount=0,n._CJtotalCount=0,n._CJgetL1=0,n._CJgetL2=0,n._CJgetL3=0,n.enterType=EEnterType.None,n.isIOS=!1,n.shareTypes=new Array,n.nowShowInsertAdIndex=1,n.rewardCount=0,n.rewardArray=[],n.rewardCount=Number(egret.localStorage.getItem("rewardCount")),n.skillRewardCount=App.GlobalConfigure.getLocalTodayNumber("skillRewardCount"),n.CJtodayCount=App.GlobalConfigure.getLocalTodayNumber("CJtodayCount"),n.CJtotalCount=Number(App.GlobalConfigure.loadLocalData("CJtotalCount","")),n._CJgetL1=Number(App.GlobalConfigure.loadLocalData("CJgetL1","")),n._CJgetL2=Number(App.GlobalConfigure.loadLocalData("CJgetL2","")),n._CJgetL3=Number(App.GlobalConfigure.loadLocalData("CJgetL3","")),1==n._CJgetL1&&1==n._CJgetL2&&1==n._CJgetL3){var o=App.DateUtils.getToday(),i=App.GlobalConfigure.loadLocalData("CJgetL1_DATE_",""),r=App.GlobalConfigure.loadLocalData("CJgetL2_DATE_",""),s=App.GlobalConfigure.loadLocalData("CJgetL3_DATE_","");i!=o&&r!=o&&s!=o&&(n.CJgetL1=n.CJgetL2=n.CJgetL3=0,n.CJtotalCount=0)}return n.judgeEnterType(),n}return __extends(t,e),Object.defineProperty(t.prototype,"CJtodayCount",{get:function(){return this._CJtodayCount},set:function(e){this._CJtodayCount=e,App.GlobalConfigure.setLocalTodayNumber("CJtodayCount",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"CJtotalCount",{get:function(){return this._CJtotalCount},set:function(e){this._CJtotalCount=e,egret.localStorage.setItem("CJtotalCount",e+"")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"CJgetL1",{get:function(){return this._CJgetL1},set:function(e){this._CJgetL1=e,App.GlobalConfigure.setLocalTodayNumber("CJgetL1",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"CJgetL2",{get:function(){return this._CJgetL2},set:function(e){this._CJgetL2=e,App.GlobalConfigure.setLocalTodayNumber("CJgetL2",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"CJgetL3",{get:function(){return this._CJgetL3},set:function(e){this._CJgetL3=e,App.GlobalConfigure.setLocalTodayNumber("CJgetL3",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"skillRewardCount",{get:function(){return this._skillRewardCount},set:function(e){this._skillRewardCount=e,App.GlobalConfigure.setLocalTodayNumber("skillRewardCount",e)},enumerable:!0,configurable:!0}),t.prototype.judgeEnterType=function(){var e=window.platform.getSystemInfo();if(e&&e.system){var t=e.system.substr(0,3);"iOS"==t&&(this.isIOS=!0)}null!=App.LaunchInfo&&(1==this.isIOS?1104==App.LaunchInfo.scene&&(this.enterType=EEnterType.MiniProm):1023==App.LaunchInfo.scene&&(this.enterType=EEnterType.Desk))},t.prototype.canUseVideo=function(){return this.vedioEnable},t.prototype.refreshReward=function(){var e=App.ControllerManager.getControllerModel(EControllerID.BAG);if(e.refreshSkin(),e.refreshGunSkin(),e.refreshNotGunSkins(),e.refreshNotRoleSkins(),0==e.notGunSkins.length&&0==e.notRoleSkins.length)this.rewardArray=[200,500,1e3];else if(this.rewardCount%2==0&&0!=e.notRoleSkins.length){var t=App.RandomUtils.limitInteger(0,e.notRoleSkins.length-1);this.rewardArray=[200,500,e.notRoleSkins[t]],console.log(e.notRoleSkins),this.rewardCount++;var n=this.rewardCount;egret.localStorage.setItem("rewardCount",n+""),this.skinType=!0}else if(0!=e.notGunSkins.length){var t=App.RandomUtils.limitInteger(0,e.notGunSkins.length-1);this.rewardArray=[200,500,e.notGunSkins[t]],console.log(e.notGunSkins),this.rewardCount++;var n=this.rewardCount;egret.localStorage.setItem("rewardCount",n+""),this.skinType=!1}else{this.rewardCount++;var n=this.rewardCount;egret.localStorage.setItem("rewardCount",n+""),this.refreshReward()}for(var o=0;o<this.rewardArray.length;o++){var i=App.RandomUtils.limitInteger(0,this.rewardArray.length-1),r=this.rewardArray[o];this.rewardArray[o]=this.rewardArray[i],this.rewardArray[i]=r}return this.rewardArray},t}(BaseModel);__reflect(ProfitModel.prototype,"ProfitModel");var GoldBoxView=function(e){function t(t){var n=e.call(this,t,null,EViewID.GOLD_BOX_VIEW)||this;return n.progress=0,n.isbannerShow=!1,n.canGetBox=!1,n.setSkinName("resource/ui/profit/goldbox.exml"),n.setLayer(EViewLayer.NORMAL),n}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.top=this.bottom=this.left=this.right=0,this.btnClose.onClick(this.onWxMenu,this)},t.prototype.onWxMenu=function(){this.closeSelf(),window.platform.aldSendEvent("误触宝箱界面点击左上角退出按钮",null),SkipController.Instance.showView(ESkipViewType.WXMENU)},t.prototype.refreshProgress=function(){this.labelPro.text="点满即可打开宝箱，当前:"+this.progress+"%",this.imgPro.width=545*this.progress/100},t.prototype.onGet=function(){if(this.progress>=App.GlobalConfigure.GetNumberArr("bannerBox",2)){if(this.isbannerShow)return;this.isbannerShow=!0,App.ControllerManager.applyFunc(EControllerID.PROFIT,EProfitMessage.SHOW_BANNER),this.callback&&this.callback.call(this.objthis),App.Timer.doTimer(1500,1,this.timefunction,this)}this.progress>65?this.progress+=7:this.progress+=17,this.progress>100&&(this.progress=100),this.refreshProgress()},t.prototype.timefunction=function(){1==this.canGetBox&&(this.closeSelf(),this.applyControllerFunc(EControllerID.MAIN,EMainMessage.CHANGE_REWARD,EProfitType.GOLD,App.GlobalConfigure.GetNumber("goldboxreward"),0,!1),App.ViewManager.open(EViewID.TIPS_VIEW,"领取"+App.GlobalConfigure.GetNumber("goldboxreward")+"钻石"))},t.prototype.reduce=function(){this.progress>0&&this.progress<98&&(this.progress-=1,this.progress<0&&(this.progress=0),this.refreshProgress())},t.prototype.judgeGetWay=function(){this.progress=0,this.refreshProgress(),App.Timer.doTimer(100,0,this.reduce,this),this.num=App.GlobalConfigure.getLocalTodayNumber("showInsertAdWcToday"),this.btnGet.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onGet,this),this.btnGet.visible=!0,this.labelPro0.visible=!1,App.GlobalConfigure.setLocalTodayNumber("showInsertAdWcToday",this.num+1)},t.prototype.open=function(e,t){window.platform.aldSendEvent("打开误触宝箱",null),App.ControllerManager.applyFunc(EControllerID.PROFIT,EProfitMessage.HIDE_BANNER),this.callback=e,this.objthis=t,this.isbannerShow=!1,this.judgeGetWay(),this.canGetBox=!0},t.prototype.close=function(){this.canGetBox=!1,window.platform.aldSendEvent("关闭误触宝箱",null),App.Timer.remove(this.reduce,this),this.imgGet.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onGet,this),this.btnGet.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onGet,this),App.ControllerManager.applyFunc(EControllerID.PROFIT,EProfitMessage.HIDE_BANNER);var e=App.ViewManager.getView(EViewID.SUCCESS_VIEW);null!=e&&App.Timer.doTimer(1e3,1,e.timeLate,e)},t}(BaseView);__reflect(GoldBoxView.prototype,"GoldBoxView");var LotteryView=function(e){function t(t){var n=e.call(this,t,null,EViewID.LOTTERY_VIEW)||this;return n.setLayer(EViewLayer.NORMAL),n.setSkinName("resource/ui/profit/lottery.exml"),n}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.closebtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.closeSelf,this),this.moneyGroup.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onMoneyGroup,this),this.energyGroup.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onEnergyGroup,this),this.lab_info.visible=1==App.GlobalConfigure.GetNumber("tt_safeMode")},t.prototype.add=function(){this.fun_0=this.refresh.bind(this,0),this.fun_1=this.refresh.bind(this,1),this.fun_2=this.refresh.bind(this,2),this.box_0.addEventListener(egret.TouchEvent.TOUCH_TAP,this.fun_0,this),this.box_1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.fun_1,this),this.box_2.addEventListener(egret.TouchEvent.TOUCH_TAP,this.fun_2,this)},t.prototype.onMoneyGroup=function(){App.ViewManager.open(EViewID.MONEY_VIEW)},t.prototype.onEnergyGroup=function(){App.ViewManager.open(EViewID.ENERGY_VIEW)},t.prototype.refresh=function(e){for(var t=App.ControllerManager.getControllerModel(EControllerID.PROFIT),n=t.rewardArray,o=0;3>o;o++){var i=this.getChildByName("item"+o),r=i.getChildByName("imagebg"),s=i.getChildByName("icon"),a=i.getChildByName("confirm"),l=i.getChildByName("btn"),p=i.getChildByName("label"),h=i.getChildByName("mouth");if(o==e)if(this["box_"+o].visible=!1,r.visible=!0,s.visible=!0,s.width=s.height=150,a.visible=!0,l.visible=!1,n[o]<150){if(1==t.skinType){var c=RES.getRes("skin_json"),u=HmSkinTable.Instance.getEntryByIndex(n[o]+1),d=PlayerObj.Instance.getHeadBitmapByName(c.role[u.model].head);if(this.applyControllerFunc(EControllerID.BAG,EBagMessage.SKIN_GET,n[o]),PlayerObj.Instance.changeSkin(u.model),null!=d&&(s.source=d.texture,s.width=d.width,s.height=d.height),"null"!=u.mouth){var y=PlayerObj.Instance.getHeadBitmapByName(u.mouth);h.visible=!0,h.width=y.width,h.height=y.height,h.source=y.texture}App.ControllerManager.getController(EControllerID.BAG).skinId=n[o],egret.localStorage.setItem("skinId",n[o]+"")}else{var f=HmGunTable.Instance.getEntryByIndex(n[o]+1),g=PlayerObj.Instance.getHeadBitmapByName("gun/"+f.model);PlayerObj.Instance.changeGun(f.model),null!=g&&(s.source=g.texture,s.width=g.width,s.height=g.height),this.applyControllerFunc(EControllerID.BAG,EBagMessage.GUN_GET,n[o]),App.ControllerManager.getController(EControllerID.BAG).skinGunId=n[o],egret.localStorage.setItem("skinGunId",n[o]+""),h.visible=!1}App.Sound.playEffect("reload.mp3")}else this.changeMoney(n[o]),p.visible=!0,h.visible=!1,p.text="+"+n[o],s.width=s.height=90,s.source="money",this.applyControllerFunc(EControllerID.MAIN,EMainMessage.CHANGE_REWARD,EProfitType.GOLD,n[o],0,!1);else this["box_"+o].visible=!0,this["box_"+o].y=35,r.visible=!1,s.visible=!1,a.visible=!1,p.visible=!1,l.visible=!0,h.visible=!1,l.onClick2(this.onGet,this,o)}App.Sound.playEffect("openbox.mp3"),this.remove()},t.prototype.onGet=function(e){this.num=e;var t=App.ControllerManager.getControllerModel(EControllerID.PROFIT);1==t.canUseVideo()?this.applyControllerFunc(EControllerID.PROFIT,EProfitMessage.VIEW_ADVERT,this.onViewSuc,this.onViewFai,this,"99抽奖视频"):this.applyControllerFunc(EControllerID.PROFIT,EProfitMessage.SHARE,this.onViewSuc,this.onViewFai,this,"抽奖分享")},t.prototype.onViewSuc=function(){for(var e=0;3>e;e++)if(e==this.num){console.log(this.num);var t=this.getChildByName("item"+e),n=t.getChildByName("imagebg"),o=t.getChildByName("icon"),i=t.getChildByName("confirm"),r=t.getChildByName("btn"),s=t.getChildByName("label"),a=t.getChildByName("mouth"),l=App.ControllerManager.getControllerModel(EControllerID.PROFIT),p=l.rewardArray;if(this["box_"+e].visible=!1,n.visible=!0,o.visible=!0,i.visible=!0,r.visible=!1,p[e]<150){if(o.width=o.height=150,1==l.skinType){var h=RES.getRes("skin_json"),c=HmSkinTable.Instance.getEntryByIndex(p[e]+1),u=PlayerObj.Instance.getHeadBitmapByName(h.role[c.model].head);if(this.applyControllerFunc(EControllerID.BAG,EBagMessage.SKIN_GET,p[e]),PlayerObj.Instance.changeSkin(c.model),null!=u&&(o.source=u.texture,o.width=u.width,o.height=u.height),"null"!=c.mouth){var d=PlayerObj.Instance.getHeadBitmapByName(c.mouth);a.visible=!0,a.width=d.width,a.height=d.height,a.source=d.texture}App.ControllerManager.getController(EControllerID.BAG).skinId=p[e],egret.localStorage.setItem("skinId",p[e]+"")}else{var y=HmGunTable.Instance.getEntryByIndex(p[e]+1),f=PlayerObj.Instance.getHeadBitmapByName("gun/"+y.model);PlayerObj.Instance.changeGun(y.model),o.source=f.texture,null!=f&&(o.source=f.texture,o.width=f.width,o.height=f.height),this.applyControllerFunc(EControllerID.BAG,EBagMessage.GUN_GET,p[e]),App.ControllerManager.getController(EControllerID.BAG).skinGunId=p[e],egret.localStorage.setItem("skinGunId",p[e]+""),a.visible=!1}App.Sound.playEffect("reload.mp3")}else this.changeMoney(p[e]),s.visible=!0,s.text="+"+p[e],a.visible=!1,o.width=o.height=90,o.source="money",this.applyControllerFunc(EControllerID.MAIN,EMainMessage.CHANGE_REWARD,EProfitType.GOLD,p[e],0,!1)}App.Sound.playEffect("openbox.mp3")},t.prototype.onViewFai=function(){var e=App.ControllerManager.getControllerModel(EControllerID.PROFIT);1==e.canUseVideo()?App.ViewManager.open(EViewID.TIPS_VIEW,"观看完广告才能获得抽奖机会哟！"):App.ViewManager.open(EViewID.TIPS_VIEW,"分享成功才能获得抽奖机会哟！")},t.prototype.remove=function(){this.box_0.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.fun_0,this),this.box_1.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.fun_1,this),this.box_2.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.fun_2,this)},t.prototype.reduction=function(){for(var e=0;3>e;e++){var t=this.getChildByName("item"+e),n=t.getChildByName("imagebg"),o=t.getChildByName("icon"),i=t.getChildByName("confirm"),r=t.getChildByName("btn"),s=t.getChildByName("label"),a=t.getChildByName("mouth");n.visible=!1,o.source="money",o.visible=!1,o.width=o.height=90,i.visible=!1,r.visible=!1,s.visible=!1,a.visible=!1,this["box_"+e].visible=!0,this["box_"+e].y=105,this.skinGroup.scaleX=this.skinGroup.scaleY=1,this.skinGroup.x=293,this.skinGroup.y=-136,this.box_0.x=this.box_2.x=39}},t.prototype.change=function(){for(var e=App.ControllerManager.getControllerModel(EControllerID.PROFIT),t=e.rewardArray,n=0;3>n;n++)if(t[n]>800)this.skinHead.source="money",this.skinHead.width=this.skinHead.height=100,this.moneyLabel.visible=!0,this.skinMouth.visible=!1,this.moneyLabel.text="+"+t[n];else if(t[n]<150&&1==e.skinType){var o=RES.getRes("skin_json"),i=HmSkinTable.Instance.getEntryByIndex(t[n]+1);this.skinHead.width=this.skinHead.height=160,this.moneyLabel.visible=!1;var r=PlayerObj.Instance.getHeadBitmapByName(o.role[i.model].head);if(null!=r&&(this.skinHead.width=r.width,this.skinHead.height=r.height,this.skinHead.source=r.texture),"null"!=i.mouth){var s=PlayerObj.Instance.getHeadBitmapByName(i.mouth);this.skinMouth.visible=!0,this.skinMouth.width=s.width,this.skinMouth.height=s.height,this.skinMouth.source=s.texture}}else if(t[n]<150){var a=HmGunTable.Instance.getEntryByIndex(t[n]+1);this.skinHead.width=this.skinHead.height=160,this.moneyLabel.visible=!1,this.skinMouth.visible=!1;var l=PlayerObj.Instance.getHeadBitmapByName("gun/"+a.model);this.skinHead.source=l.texture,this.skinHead.height=l.height,this.skinHead.width=l.width}egret.Tween.get(this.skinGroup).to({x:125,y:192},1e3).to({scaleX:0,scaleY:0},500).wait(1500),egret.Tween.get(this.box_0).wait(1500).to({x:314},500).wait(500).to({x:39},500),egret.Tween.get(this.box_2).wait(1500).to({x:-236},500).wait(500).to({x:39},500)},t.prototype.changeMoney=function(e){var t=e/20;App.Timer.doTimer(1e3/t,t,this.refreshMoney,this)},t.prototype.refreshMoney=function(){this.moneyNumber.text=Number(this.moneyNumber.text)+20+""},t.prototype.open=function(){var e=App.ControllerManager.getControllerModel(EControllerID.PROFIT);e.refreshReward(),App.Timer.doTimer(3e3,1,this.add,this),this.change(),this.labelEnergy.text=Energy.Instance.energy+"/"+Energy.Instance.maxEnergy,this.moneyNumber.text=App.LoginInfo.gold,App.Sound.playEffect("entryshop.mp3")},t.prototype.close=function(){this.reduction(),egret.Tween.removeTweens(this.skinGroup),egret.Tween.removeTweens(this.box_0),egret.Tween.removeTweens(this.box_2),App.ViewManager.open(EViewID.SUCCESS_VIEW)},t}(BaseView);__reflect(LotteryView.prototype,"LotteryView");var OtherGames=function(e){function t(){var t=e.call(this)||this;return t.index=-1,t.skinName="resource/ui/profit/othergames.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.trybtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSkip,this)},t.prototype.dataChanged=function(){e.prototype.dataChanged.call(this),this.img.source=this.data.img,this.index=this.data.index;var t=OtherGameView.tmpData[this.index];null!=t&&(this.labelGame.text=t._name_)},t.prototype.onSkipSuc=function(e){window.platform.aldSendEvent("游戏福利跳转成功-appID",e._parent_.appID+""),window.platform.aldSendEvent("游戏福利跳转成功-名字",e._name_+""),SkipController.Instance.model.hideGameNew(e);var t=App.ViewManager.getView(EViewID.OTHERGAME_VIEW);null!=t&&(t.refresh(),t.applyControllerFunc(EControllerID.MAIN,EMainMessage.CHANGE_REWARD,EProfitType.ENERGY,1,0,!1),t.applyControllerFunc(EControllerID.MAIN,EMainMessage.CHANGE_REWARD,EProfitType.GOLD,100,0,!1),App.ViewManager.open(EViewID.TIPS_VIEW,"领取奖励成功！"))},t.prototype.onSkipFai=function(e){window.platform.aldSendEvent("游戏福利跳转失败-appID",e._parent_.appID+""),window.platform.aldSendEvent("游戏福利跳转失败-名字",e._name_+"")},t.prototype.onSkip=function(){var e=OtherGameView.tmpData[this.index];window.platform.aldSendEvent("点击游戏福利跳转",e._name_+""),SkipController.Instance.skipOtherGame(e,this.onSkipSuc,this.onSkipFai)},t}(eui.ItemRenderer);__reflect(OtherGames.prototype,"OtherGames");var OtherGameView=function(e){function t(t){var n=e.call(this,t,null,EViewID.OTHERGAME_VIEW)||this;return n.data=new eui.ArrayCollection,n.setLayer(EViewLayer.NORMAL),n.setSkinName("resource/ui/profit/othergame.exml"),n.percentWidth=n.percentHeight=100,n}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.closebtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.closeSelf,this),this.list.itemRenderer=OtherGames,this.list.dataProvider=this.data,this.scroller.scrollPolicyV=eui.ScrollPolicy.ON},t.prototype.refresh=function(){if(0!=this.isShow()){if(0==SkipController.Instance.model.getDatas(t.tmpData,10))return void this.closeSelf();this.data.removeAll(),this.list.height=0;for(var e=0;e<t.tmpData.length;e++)this.data.addItem({name:t.tmpData[e]._name_,img:t.tmpData[e]._parent_.getSkinByData(t.tmpData[e]._subIndex_+1),index:e}),this.list.height+=187;this.data.refresh()}},t.prototype.suc=function(){App.ViewManager.open(EViewID.GOLD_BOX_VIEW),App.bNewPlayer=2},t.prototype.fail=function(){App.ViewManager.open(EViewID.GOLD_BOX_VIEW),App.bNewPlayer=2},t.prototype.open=function(){this.refresh(),window.platform.aldSendEvent("99点击游乐场",null),this.applyControllerFunc(EControllerID.PROFIT,EProfitMessage.SHOW_BANNER)},t.prototype.close=function(){0==this.isShow()&&1==App.bNewPlayer&&this.applyControllerFunc(EControllerID.PROFIT,EProfitMessage.VIEW_ADVERT,this.suc,this.fail,this,"99落地视频")},t.tmpData=[],t}(BaseView);__reflect(OtherGameView.prototype,"OtherGameView");var RequestMessageView=function(e){function t(t){var n=e.call(this,t,null,EViewID.REQUEST_MESSAGE_VIEW)||this;return n.setSkinName("resource/ui/profit/requestmessage.exml"),n.setLayer(EViewLayer.NORMAL),n}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.percentHeight=this.percentWidth=100,this.btnGet.onClick(this.getMessage,this),this.btnClose0.onClick(this.closeSelf,this),this.btnClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.closeSelf,this),this.btnCloseForever.addEventListener(egret.TouchEvent.TOUCH_TAP,this.closeForever,this)},t.prototype.getMessage=function(){this.applyControllerFunc(EControllerID.PROFIT,EProfitMessage.REQUEST_MESSAGE)},t.prototype.closeForever=function(){egret.localStorage.setItem("neverRequestMessage","1"),this.closeSelf()},t.prototype.open=function(){},t.prototype.close=function(){},t}(BaseView);__reflect(RequestMessageView.prototype,"RequestMessageView");var SignView=function(e){function t(t){var n=e.call(this,t,null,EViewID.SIGN_VIEW)||this;n.needShowBanner=!1,n.setLayer(EViewLayer.NORMAL),n.setSkinName("resource/ui/profit/sign.exml"),n.percentWidth=n.percentHeight=100;App.MainSprite.width/App.MainSprite.height;return n.needShowBanner=!0,n}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),App.LoginInfo.sign=parseInt(App.LoginInfo.sign),this.skinRole=new RoleObj,this.skinRole.anim=new PlayerAnim,this.skinRole.init("player09"),this.btnclose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.closeSelf,this),this.buttonGetDouble.onClick(this.onDoubleGet,this),this.buttonGet.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onGet,this),this.lab_info.visible=1==App.GlobalConfigure.GetNumber("tt_safeMode"),this.refreshSignData()},t.prototype.onSafeMode=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return this.buttonGet.visible=!e,e?[4,App.sleep(t)]:[3,2];case 1:n.sent(),this.buttonGet.visible=!0,n.label=2;case 2:return[2]}})})},t.prototype.onDoubleGet=function(){if(this.isGet)App.ViewManager.open(EViewID.TIPS_VIEW,"奖励领完了，请明日再来");else{var e=HmSignTable.Instance.getEntry(this.getEntryDate(App.LoginInfo.sign+1));if(1==App.SafeMode)return void this.onViewSuc();if(0==e.type||1==e.type){var t=App.ControllerManager.getControllerModel(EControllerID.PROFIT);1==t.canUseVideo()?this.applyFunc(EProfitMessage.VIEW_ADVERT,this.onViewSuc,this.onViewFai,this,"99签到视频"):this.applyFunc(EProfitMessage.SHARE,this.onViewSuc,this.onViewFai,this,"签到分享")}else App.ViewManager.open(EViewID.TIPS_VIEW,"该奖励不支持多倍签到")}},t.prototype.onGet=function(){this.isGet?App.ViewManager.open(EViewID.TIPS_VIEW,"奖励领完了，请明日再来"):(window.platform.aldSendEvent("99普通签到",null),this.applyFunc(EProfitMessage.REQUEST_SIGN,this.getSuc,this.getfai,this))},t.prototype.getSuc=function(){var e=HmSignTable.Instance.getEntry(this.getEntryDate(App.LoginInfo.sign));App.LoginInfo.signtime&&(this.isGet=!0),App.ControllerManager.applyFunc(EControllerID.MAIN,EMainMessage.CHANGE_REWARD,e.type,e.value,e.iconid),App.ViewManager.open(EViewID.TIPS_VIEW,"领取奖励成功！"),this.refreshSignData(),this.closeSelf()},t.prototype.getfai=function(){App.ViewManager.open(EViewID.TIPS_VIEW,"签到失败，请重试"),this.openAndopen()},t.prototype.onViewSuc=function(){this.applyFunc(EProfitMessage.REQUEST_SIGN,this.onDoubleSuc,this.onDoubleFai,this)},t.prototype.onViewFai=function(){var e=App.ControllerManager.getControllerModel(EControllerID.PROFIT);1==e.canUseVideo()?App.ViewManager.open(EViewID.TIPS_VIEW,"观看完广告才能获得奖励哟！"):App.ViewManager.open(EViewID.TIPS_VIEW,"分享成功才能获得奖励哟！")},t.prototype.onDoubleSuc=function(){var e=HmSignTable.Instance.getEntry(this.getEntryDate(App.LoginInfo.sign));App.LoginInfo.signtime&&(this.isGet=!0),App.ControllerManager.applyFunc(EControllerID.MAIN,EMainMessage.CHANGE_REWARD,e.type,5*e.value,e.iconid),App.ViewManager.open(EViewID.TIPS_VIEW,"领取奖励成功！"),this.refreshSignData(),this.closeSelf(),this.getChildByName("")},t.prototype.onDoubleFai=function(){App.ViewManager.open(EViewID.TIPS_VIEW,"签到失败，请重试"),this.openAndopen()},t.prototype.refreshSignData=function(){var e=1,n=t.signNum,o=0,i=1,r=this.getDate();for(App.LoginInfo.sign!=t.signNum||App.LoginInfo.signtime?App.LoginInfo.sign==t.signNum&&App.LoginInfo.signtime?(e=1,n=t.signNum):App.LoginInfo.sign>t.signNum&&(e=t.signNum+1,n=2*t.signNum,o=-7):(e=t.signNum+1,n=2*t.signNum,o=-7),e;n>=e;++e)r>=e?this.refreshItem(i,e,!0,!1):e!=r+1||App.LoginInfo.signtime?this.refreshItem(i,e,!1,!1):this.refreshItem(i,e,!1,!0),i++},t.prototype.refreshItem=function(e,t,n,o){var i=this.grpContent.getChildByName("item"+e),r=i.getChildByName("day"),s=i.getChildByName("num"),a=i.getChildByName("icon"),l=i.getChildByName("btn"),p=HmSignTable.Instance.getEntryByIndex(t);if(r.text=e+"",p.type==EProfitType.ENERGY)a.source="energy",s.text="x"+p.value;else if(p.type==EProfitType.GOLD)a.source="money",s.text="x"+p.value;else if(p.type==EProfitType.SKIN){var h=HmSkinTable.Instance.getEntryByIndex(p.value);this.skinRole.changeSkin(h.model),this.addChild(this.skinRole.display),this.skinRole.display.x=700,this.skinRole.display.y=900,this.skinRole.display.scaleX=-2,this.skinRole.display.scaleY=2,s.text=h.name,a.visible=!1}else if(p.type==EProfitType.GUN){var c=RES.getRes("skin_json").playerGuns,u=PlayerObj.Instance.getHeadBitmapByName("gun/"+c[p.value]);null!=u&&(a.source=u.texture,a.width=u.width,a.height=u.height,console.log(a.width,a.height)),s.text="x1"}1==o?(l.source="sign_today",l.scale9Grid=new egret.Rectangle(55,47,17,19)):(l.source="sign_btn",l.scale9Grid=new egret.Rectangle(69,75,24,30)),1==n&&(l.filters=App.MathUtils.grayFilters,a.filters=App.MathUtils.grayFilters,s.filters=App.MathUtils.grayFilters)},t.prototype.getDate=function(){var e=0;return App.LoginInfo.sign<=t.signNum?e=App.LoginInfo.sign:(e=App.LoginInfo.sign%t.signNum,App.LoginInfo.sign%t.signNum!=0||App.LoginInfo.signtime?App.LoginInfo.sign%t.signNum==0&&App.LoginInfo.signtime&&(e=2*t.signNum):e=t.signNum,e<t.signNum&&(e+=t.signNum)),e},t.prototype.getEntryDate=function(e){var n=0;return n=e<=t.signNum?e:(e-t.signNum)%t.signNum+t.signNum},t.prototype.open=function(){e.prototype.open.call(this),App.LoginInfo.signtime&&(this.isGet=!0),1==this.needShowBanner&&this.applyControllerFunc(EControllerID.PROFIT,EProfitMessage.SHOW_BANNER)},t.prototype.close=function(){},t.signNum=7,t}(BaseView);__reflect(SignView.prototype,"SignView");